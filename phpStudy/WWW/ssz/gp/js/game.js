function GetRealPath(e){return ReplacePathMap[e]&&(e=ReplacePathMap[e]),void 0==gFileMd5||null==gFileMd5?e:gFileMd5[e]||e}function ConvertToJson(e){try{return JSON.parse(e||"{}")}catch(e){return{}}}function toDecodeURIComponent(e){try{return decodeURIComponent(e)}catch(t){return e}}function IsNull(e){return null===e||void 0===e}function GenUuid(){for(var e=[],t="0123456789abcdef",r=0;r<36;r++)e[r]=t.substr(Math.floor(16*Math.random()),1);e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-";var a=e.join("");return a}function getTimestamp(){return Date.parse(new Date)/1e3}function saveScreenShot(e,t){var r=cc.director.getWinSize(),a=cc.director.getRunningScene();a.width=r.width,a.height=r.height;var i=(new Date,"screenShot.jpg");if(t){var s=new cc.RenderTexture(parseInt(r.height),parseInt(r.width));a.anchorX=0,a.anchorY=0;var n=a.getRotation();a.setRotation(270);var o=a.x;a.x=r.height,s.begin(),a.visit(),s.end(),s.saveToFile(i,cc.IMAGE_FORMAT_JPEG,!1,function(){a.x=o,a.setRotation(n),a.anchorX=.5,a.anchorY=.5,e&&e()})}else{var s=new cc.RenderTexture(parseInt(r.width),parseInt(r.height));s.begin(),a.visit(),s.end(),s.saveToFile(i,cc.IMAGE_FORMAT_JPEG,!1,e)}return jsb.fileUtils.getWritablePath()+i}function checkPhone(e){var t=/^((1[0-9][0-9]{1})+\d{8})$/;return!!t.test(e)}function gSetMusic(e){e?(cc.audioEngine.pauseMusic(),cc.audioEngine.setMusicVolume(0),cc.sys.localStorage.setItem("musicVolume",0)):(cc.audioEngine.resumeMusic(),cc.audioEngine.setMusicVolume(100),cc.sys.localStorage.setItem("musicVolume",100),playMuisc(lastCacheName))}function gSetMusicEffect(e){if(e)cc.audioEngine.pauseAllEffects(),cc.sys.localStorage.setItem("effectsVolume",0);else{for(var t in cc.audioEngine._audioPool)cc.audioEngine.unloadEffect(t);cc.audioEngine.resumeAllEffects(),cc.sys.localStorage.setItem("effectsVolume",100)}}function RemoveGet(e,t){var r=e[t];return delete e[t],r}function calDate(e){var t=Math.floor(e/86400),r=Math.floor(e%86400/3600),a=Math.floor(e%86400%3600/60),i=e%86400%3600%60;return[t,r,a,i]}function getShareUrl(e,t){var r=getQueryString("test")||0,a="";return ME_D.get_user()&&ME_D.get_user().extend_uid&&(a=ME_D.get_user().extend_uid),SHARE_URL+"ttw/?game_type="+GAME_TYPE+"&desk="+e+"&recordId="+t+"&test="+r+"&extend_uid="+a}function isAgent(){return GAME_TYPE==GAME_TYPE_XX||GAME_TYPE==GAME_TYPE_WZ||GAME_TYPE==GAME_TYPE_DD||GAME_TYPE==GAME_TYPE_QL||GAME_TYPE==GAME_TYPE_DZ||GAME_TYPE==GAME_TYPE_DZ2||GAME_TYPE==GAME_TYPE_Q8||GAME_TYPE==GAME_TYPE_LS||GAME_TYPE==GAME_TYPE_FF}function request4Http(e,t,r,a){var i={method:a||"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+e,data:JSON.stringify(t)};HttpNetworkRequest(i,function(e,t){if(e)return void ModuleMgr.showTipMsg(e);var a=ConvertToJson(t);return a.ret==-1?void ModuleMgr.showTipMsg(a.err_msg):void r(a)})}function requestWaiting4Http(e,t,r,a,i){var s=GAME_WEB_PORT;1==t.ignorePort&&(s="");var n={method:i||"POST",timeout:5e3,url:GAME_WEB_URL+s+e,data:JSON.stringify(t)};a=a||"",ModuleMgr.showWaitMsg(a,0),HttpNetworkRequest(n,function(e,t){if(ModuleMgr.removeWaitMsg(),e)return void ModuleMgr.showTipMsg(e);var a=ConvertToJson(t);return a.ret==-1?void(a.err_msg?ModuleMgr.showTipMsg(a.err_msg):a.error&&ModuleMgr.showTipMsg(a.error)):void r(a)})}function gCalScore(e,t){e=gDeepDup(e),t=t||[];for(var r=[],a=[],i=null,s=null,n=0;n<e.length;n++){var o=e[n];o.score>0?(i||(i=o),o.score>i.score&&(i=o),r.push(o)):o.score<0&&(s||(s=o),s.score<o.score&&(s=o),a.push(o))}if(0==r.length||0==a.length)return t;if(1==r.length){for(var n=0;n<a.length;n++)t.push({win:r[0].id,fail:a[n].id,score:-a[n].score});return t}if(1==a.length){for(var n=0;n<r.length;n++)t.push({win:r[n].id,fail:a[0].id,score:r[n].score});return t}var c=function(e,t){return e.score!=t.score?e.score-t.score:e.id-t.id},l=function(e,t){var r=null,a=function(e,t,i){if(!r)for(var s=0;s<t.length;s++){var i=gDeepDup(i||{});if(!i[s]){if(!(e+t[s].score>0))return e+t[s].score==0?(i[s]=1,e=0,void(r=i)):void 0;i[s]=1,e+=t[s].score,a(e,t,i)}}};return a(e,t),r},g=function(){for(var e=0;e<r.length;e++){var i=l(r[e].score,a);if(i){var s=[];for(var n in i)s.push(n);s.sort(function(e,t){return e-t});for(var o=s.length-1;o>=0;o--){var c=s[o];t.push({win:r[e].id,fail:a[c].id,score:-a[c].score}),a.splice(c,1)}r[e].score=0}}};if(g(),0==a.length)return t;r.sort(c),a.sort(c);var h=r.length-1,u=a.length-1;if(r[h].score+a[u].score>=0&&(t.push({win:r[h].id,fail:a[u].id,score:-a[u].score}),r[h].score=r[h].score+a[u].score,a.splice(u,1)),g(),0==a.length)return t;r.sort(c);var h=r.length-1,d=0;return r[h].score+a[d].score>=0?(t.push({win:r[h].id,fail:a[d].id,score:-a[d].score}),r[h].score=r[h].score+a[d].score,a.splice(d,1)):(t.push({win:r[h].id,fail:a[d].id,score:r[h].score}),a[d].score=a[d].score+r[h].score,r.splice(h,1)),e=r.concat(a),gCalScore(e,t)}function getQueryString(e){if(cc.sys.isNative)try{if(cc.sys.os==cc.sys.OS_ANDROID){if("undefined"==typeof IS_DEV){var t=jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","getQueryString","(Ljava/lang/String;)Ljava/lang/String;",e);return"0"==t?null:t}}else if(cc.sys.os==cc.sys.OS_IOS)return jsb.reflection.callStaticMethod("AppController","getQueryString:",e)}catch(e){return null}if(null==window||null==window.location)return null;var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),a=window.location.search.substr(1).match(r);return null!=a?unescape(a[2]):null}function setScreenSize(){cc.sys.dump();var e=640,t=768,r=1024,a=1136,i=cc.view.getFrameSize();if(cc.sys.isNative){var s=i.width,n=i.height,o=1;i.height<r?(o=r/i.height,n=r):i.height>a&&(o=a/i.height,n=a),1!=o&&(s=o*i.width),s<e&&(o=e/i.width,s=e,n=i.height*o),cc.view.setDesignResolutionSize(s,n,cc.ResolutionPolicy.NO_BORDER)}else if(cc.sys.isMobile){var c=cc.ResolutionPolicy.FIXED_WIDTH;s=e,o=s/i.width,n=o*i.height,n<r&&(o=r/i.height,n=r,s=i.width*o,c=cc.ResolutionPolicy.FIXED_HEIGHT),s>t&&(s=t,c=cc.ResolutionPolicy.SHOW_ALL),n>a&&(n=a,c=cc.ResolutionPolicy.SHOW_ALL),c=cc.ResolutionPolicy.SHOW_ALL,cc.view.setDesignResolutionSize(s,n,c),cc.log("setScreenSize coming the Native")}else cc.view.setDesignResolutionSize(640,1136,cc.ResolutionPolicy.SHOW_ALL),cc.log("setScreenSize coming the not Native")}function initAudio(){var e=cc.sys.localStorage.getItem("musicVolume"),t=cc.sys.localStorage.getItem("effectsVolume");if(null==e){var r=!0;cc.sys.isNative&&(r=!1),gSetMusic(r)}if(null==t){var r=!1;gSetMusicEffect(!1)}}UILayer=ccui.Widget.extend({isControlNode:!1,_listeners:null,_cacheParent:null,_waitPathNum:0,_isCallLoaded:!1,ctor:function(e,t,r){ccui.Widget.prototype.ctor.call(this),this.uiPath=e,this._onSuccessInit(),this.setAnchorPoint(cc.p(0,0)),this._isWaitLoad=!0,this._listeners=[],this._cacheParent=t,this._cacheControlNode=r,this._loadPaths=[];var a=this;a._addWaitPath(e),UIUtils.GetCurJsonData(e,function(r,i){if(!r){var s=UIUtils.CalcNeedLoadImage(i);cc.loader.load(s,function(e,t,r){},function(){if(!a._isWaitLoad)return void a._tryLoaded(e);a._isWaitLoad=!1;var r=UIUtils.GetControlNode(a,t);UIUtils.CocosGenBaseNodeByData(i,a,t,r),cc.eventManager.dispatchCustomEvent("Loaded:"+a.__instanceId),a._subUILoaded(e)})}})},onSuccessInit:function(){},_onSuccessInit:function(){this.onSuccessInit()},_addWaitPath:function(e){this._waitPathNum+=1},_tryLoaded:function(e){return this._waitPathNum<=0&&!this._isCallLoaded&&(this.onLoaded(),this._isCallLoaded=!0,UIUtils.TryNoticeUILoaded({path:this.uiPath},this._cacheControlNode||this._cacheParent)),this._isCallLoaded},_subUILoaded:function(e){return this._waitPathNum-=1,this._tryLoaded(e)},onLoaded:function(){},uiLoaded:function(e){},isWaitLoad:function(){return this._isWaitLoad},isLoaded:function(){return!this._isWaitLoad},eventListener:function(e){var t="";if(e.target&&(t=e.target.getName()||""),t){var r="tap_"+t;if(!this[r])return;"ended"==e.name&&this[r].call(this,e)}},close:function(){this.stopAllActions(),this.removeFromParent(!0)},show:function(){},addListener:function(e,t){var r=cc.eventManager.addCustomListener(e,t);return this._listeners.push(r),r},removeListener:function(e){var t=this._listeners.indexOf(e);t>=0&&this._listeners.splice(t,1),cc.eventManager.removeListener(e)},onExit:function(){ccui.Widget.prototype.onExit.call(this);for(var e=0;e<this._listeners.length;e++)cc.eventManager.removeListener(this._listeners[e])}}),UILayer.canMultiOpen=function(){return!1},UILayer.create=function(e,t,r){return new UILayer(e,t,r)},UIRichText=ccui.RichText.extend({_originConfig:null,_curConfig:null,_text:"",_font:"",ctor:function(e,t,r){ccui.RichText.prototype.ctor.call(this),this.allElement=[],this.initWithConfig(r||{}),this.setContentSize(t.width||100,t.height||100),this.ignoreContentAdaptWithSize(!1),this.setText(e)},initWithConfig:function(e){this._originConfig=UIUtils.merge({color:cc.color.WHITE,fontSize:20,ocolor:cc.color.BLACK,osize:0},e),this._curConfig=UIUtils.dup(this._originConfig)},clearAllElement:function(){for(var e=0;e<this.allElement.length;e++)this.removeElement(this.allElement[e]);this.allElement=[]},setString:function(e){this.setText(e)},setText:function(e){this._text!=e&&(this.clearAllElement(),this._curConfig=UIUtils.dup(this._originConfig),this._text=e||"",this.parseText(this._text),this.formatText())},addNewLineElement:function(){var e=ccui.RichElementNewLine.create(1,this._curConfig.color,255);this.pushBackElement(e),this.allElement.push(e)},addRichElement:function(e){var t=null;if(cc.sys.isNative)t=ccui.RichElementText.create(1,this._curConfig.color,255,e,this._curConfig.font,this._curConfig.fontSize,this._curConfig.osize>0?32:0,"",this._curConfig.ocolor,this._curConfig.osize);else{var r=new cc.FontDefinition({fillStyle:this._curConfig.color,fontName:this._curConfig.font,fontSize:this._curConfig.fontSize,strokeEnabled:this._curConfig.osize>0,strokeStyle:this._curConfig.ocolor,lineWidth:this._curConfig.osize});t=ccui.RichElementText.create(1,r,255,e)}this.pushBackElement(t),this.allElement.push(t)},forceUpdate:function(){this.setText(this._text)},richTextGetRGB:function(e){var t=/c(\d{1,3}):(\d{1,3}):(\d{1,3})/g,r=t.exec(e);return null==r?null:new cc.Color(parseInt(r[1]),parseInt(r[2]),parseInt(r[3]))},parseConfig:function(e){e.length;if("/c"==e)this._curConfig.color=this._originConfig.color;else if("cr"==e)this._curConfig.color=cc.color.RED;else if("cw"==e)this._curConfig.color=cc.color.WHITE;else if("cg"==e)this._curConfig.color=cc.color.GREEN;else if("co"==e)this._curConfig.color=cc.color.ORANGE;else if("cb"==e)this._curConfig.color=cc.color.BLUE;else if("cy"==e)this._curConfig.color=cc.color.YELLOW;else if("c"==e.charAt(0)){var t=this.richTextGetRGB(e);t&&(this._curConfig.color=t)}else if("ocr"==e)this._curConfig.ocolor=cc.color.RED;else if("ocw"==e)this._curConfig.ocolor=cc.color.WHITE;else if("ocg"==e)this._curConfig.ocolor=cc.color.GREEN;else if("co"==e)this._curConfig.ocolor=cc.color.ORANGE;else if("ocb"==e)this._curConfig.ocolor=cc.color.BLUE;else if("ocy"==e)this._curConfig.ocolor=cc.color.YELLOW;else if(0==e.indexOf("oc")){var t=this.richTextGetRGB(e.substring(1));t&&(this._curConfig.color=t)}else 0==e.indexOf("f")?this._curConfig.fontSize=parseInt(e.substring(1)):0==e.indexOf("of")?this._curConfig.osize=parseInt(e.substring(2)):"/f"==e?this._curConfig.fontSize=this._originConfig.fontSize:"/of"==e?this._curConfig.osize=this._originConfig.osize:"br"==e&&this.addNewLineElement()},parseText:function(e){for(var t=!1,r=0,a=0;r<e.length;){var i=e.charAt(r),s=r>0&&"\\"==e.charAt(r-1);if("["==i&&!s){r>a&&(this.addRichElement(e.substring(a,r)),a=r),t=!0;var n=function(t,r){for(r=e.indexOf("]",r);r>0&&"\\"==e.charAt(r-1);)r=e.indexOf("]",r);return r},o=n(e,r+1);if(o<0)break;this.parseConfig(e.substring(r+1,o)),r=o,a=o+1,t=!1}t=!1,r+=1}t||this.addRichElement(e.substring(a))}});var ReplacePathMap={},gFileMd5=gFileMd5||{};RegisterReplacePathMap=function(e,t){ReplacePathMap[e]=t},UIDataUtils={};var CacheDataTable={},MultiLanguageData={},CurrentLanguageSet="Zh",UIPrefix="",JsonLoadCacheCallback={},JsonLoadingFlag={};UIDataUtils.AddJsonLoadedCallback=function(e,t){JsonLoadCacheCallback[e]=JsonLoadCacheCallback[e]||[],JsonLoadCacheCallback[e].push(t)},UIDataUtils.DoJsonLoadedCallback=function(e,t,r){for(var a=JsonLoadCacheCallback[e]||[],i=0;i<a.length;i++)a[i](t,r);JsonLoadCacheCallback[e]=[],JsonLoadingFlag[e]=null},UIDataUtils.GetJsonDataFromFile=function(e,t){e=this.CalcUIPath(e),this.AddJsonLoadedCallback(e,t);var r=this;if(CacheDataTable[e])return void r.DoJsonLoadedCallback(e,null,CacheDataTable[e]);try{if(JsonLoadingFlag[e])return;JsonLoadingFlag[e]=!0,cc.loader.loadJson(e,function(a,i){return a?t(a,i):(CacheDataTable[e]=i,void r.DoJsonLoadedCallback(e,null,i))})}catch(t){r.DoJsonLoadedCallback(e,null,null)}},UIDataUtils.CalcUIPath=function(e){return e?GetRealPath(UIPrefix+e):null},UIDataUtils.SetUIPrefix=function(e,t){UIPrefix=e},UIDataUtils.GetUIPrexifx=function(){return UIPrefix},UIDataUtils.SetLanguagePath=function(e){UIDataUtils.GetJsonDataFromFile(e,function(e,t){e||(MultiLanguageData=t)})},UIDataUtils.SetLanguageData=function(e){MultiLanguageData=e},UIDataUtils.SetCurrentLangSet=function(e){CurrentLanguageSet=e},UIDataUtils.GetLangFromConfig=function(e){return null==MultiLanguageData[e]?null:MultiLanguageData[e][CurrentLanguageSet]||""},UIDataUtils.TryAnalyseLang=function(e){var t={isKey:!1};if(0==e.indexOf("@")){var r=e.substring(1),a=this.GetLangFromConfig(r);null!=a&&(t.value=a,t.isKey=!0,t.key=r)}return t},SCREEN_ORIENTATION_PROTRAIT=1,SCREEN_ORIENTATION_LANDSCAPE=2,SCREEN_ORIENTATION=SCREEN_ORIENTATION_PROTRAIT,SCREEN_CUR_ORIENTATION=SCREEN_ORIENTATION,UIUtils={};var CacheDataTable={},PathTemple={},OrientationPath={};UIUtils.isNum=function(e){return"number"==typeof e},UIUtils.isNull=function(e){return null===e||void 0===e},UIUtils.isValue=function(e){return!UIUtils.isNull(e)},UIUtils.CheckPathRepeat=function(e,t){for(var r=e;r;){if(t==r._path||t==r._sceneSubPath)return!0;r=r.getParent()}return!1},UIUtils.RegisterOrientationPath=function(e){OrientationPath[e]=1},UIUtils.bolOrientationPath=function(e){return OrientationPath[e]},UIUtils.RegisterPathTemple=function(e,t){PathTemple[e]=t},UIUtils.GetPathTemple=function(e){return PathTemple[e]},UIUtils.GetCurJsonData=function(e,t){"string"==typeof e?UIDataUtils.GetJsonDataFromFile(e,t):"object"==typeof e?t(null,e):t(null,{})},UIUtils.TryAddWaitUILoaded=function(e,t,r){if(e.path&&t){for(t.getParent()&&(r=null);r;)r instanceof UILayer&&r._addWaitPath(e.path),r=r.getParent();for(r=t;r;)r instanceof UILayer&&r._addWaitPath(e.path),r=r.getParent()}},UIUtils.TryNoticeUILoaded=function(e,t){if(e.path&&t)for(var r=t;r;)r instanceof UILayer&&(r.uiLoaded(e.path),r._subUILoaded(e.path)),r=r.getParent()},UIUtils.CalcNeedLoadImage=function(e){var t=this.GetNeedLoadImage(e),r=[];for(var a in t)r.push(a);return r},UIUtils.GetNeedLoadImage=function(e,t){t=t||{};var r=function(e){e&&(t[UIDataUtils.CalcUIPath(e)]=!0)};"UIInput"==e.type?r(e.spriteFrame):"UIImage"==e.type?r(e.spriteFrame):"UIScale9"==e.type?r(e.spriteFrame):"UISlider"==e.type?(r(e.barBg),r(e.barProgress),r(e.barNormalBall),r(e.barSelectBall),r(e.barDisableBall)):"UIButton"==e.type?(r(e.bgNormal),r(e.bgSelect),r(e.bgDisable)):"UICheckBox"==e.type?(r(e.back),r(e.backSelect),r(e.active),r(e.backDisable),r(e.activeDisable)):"UITextAtlas"==e.type&&r(e.charMapFile),e.children=e.children||{};for(var a=0;a<e.children.length;a++)UIUtils.GetNeedLoadImage(e.children[a],t);return t},UIUtils.CovertToColor=function(e){return!e||UIUtils.isNull(e[1])?null:cc.color(e[0],e[1],e[2],e[3])},UIUtils.CalcWidth=function(e,t,r){UIUtils.isNull(t)&&e&&(t=e.getContentSize().width),t=""+(t||0);var a=t.indexOf("%");if(!r||a<0)return parseInt(t);var i=t.substring(0,a);return t=r.getContentSize().width*parseFloat(i)/100,parseInt(t)},UIUtils.CalcHeight=function(e,t,r){UIUtils.isNull(t)&&e&&(t=e.getContentSize().height),t=""+(t||0);var a=t.indexOf("%");if(!r||a<0)return parseInt(t);var i=t.substring(0,a);return t=r.getContentSize().height*parseFloat(i)/100,parseInt(t)},UIUtils.GetControlNode=function(e,t){if(e.isControlNode)return e;for(var r=null;t;){if(t instanceof UILayer&&t.isControlNode){r=t;break}t=t.getParent()}return r?r:e},UIUtils.AddTouchEvent=function(e,t,r,a,i){if(r&&a){var s=a;i&&r[i]&&(s=r[i]),t(e,function(e){s.call(r,e)})}},UIUtils.addTouchListenerCallback=function(e,t){e.addTouchEventListener(function(e,r){var a={};0==r?a.name="began":1==r?a.name="moved":2==r?(a.name="ended",playEffect("btn_click.mp3")):a.name="canceled",a.target=e,t(a)})},UIUtils.onSliderEvent=function(e,t){e.addEventListener(function(e,r){var a={};r==ccui.Slider.EVENT_PERCENT_CHANGED&&(a.name="ON_PERCENTAGE_CHANGED"),a.target=e,t(a)})},UIUtils.onCheckBoxEvent=function(e,t){e.addEventListener(function(e,r){var a={};r==ccui.CheckBox.EVENT_SELECTED?a.name="selected":a.name="unselected",a.target=e,t(a)})},UIUtils.onEditboxEvent=function(e,t){var r={},a={editBoxEditingDidBegin:function(e){r.name="begin",r.target=e,t(r)},editBoxEditingDidEnd:function(e){r.name="end",r.target=e,t(r)},editBoxTextChanged:function(e,a){r.name="changed",r.target=e,t(r)},editBoxReturn:function(e){r.name="return",r.target=e,t(r)}};e.setDelegate(a)},UIUtils.CocosGenBaseNodeByData=function(e,t,r,a){if(!e)return null;var i=null,s=!1;e.touchEnabled&&(s=e.touchEnabled);var n=this;if(t);else if(e.path){if(UIUtils.TryAddWaitUILoaded(e,r),this.CheckPathRepeat(r,e.path))return null;var o=this.GetPathTemple(e.path);o||(o=UILayer),t=o.create(e.path,r,a),s&&this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener)}else if("UIImage"==e.type)t=ccui.ImageView.create(),s&&this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener);else if("UIScale9"==e.type)t=ccui.Scale9Sprite.create(UIDataUtils.CalcUIPath(e.spriteFrame));else if("UIText"==e.type)t=ccui.Text.create();else if("UITextAtlas"==e.type)t=ccui.TextAtlas.create();else if("UIArmature"==e.type)e.plistPath&&cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath(e.plistPath),UIDataUtils.CalcUIPath(e.imagePath)),e.configFilePath&&ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath(e.configFilePath)),t=ccs.Armature.create(e.actionName);else if("UIInput"==e.type){var c=UIDataUtils.CalcUIPath(e.spriteFrame)||"",l=this.CalcWidth(t,e.width,r),g=this.CalcHeight(t,e.height,r);t=c?cc.EditBox.create(cc.size(l,g),ccui.Scale9Sprite.create(c)):cc.EditBox.create(cc.size(l,g),ccui.Scale9Sprite.create()),e.isSizeSeted=!0,this.AddTouchEvent(t,this.onEditboxEvent,a,a.eventListener,e.touchListener)}else if("UISlider"==e.type)t=ccui.Slider.create(),this.AddTouchEvent(t,this.onSliderEvent,a,a.eventListener,e.touchListener);else if("UIButton"==e.type)t=ccui.Button.create(),this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener);else if("UICheckBox"==e.type)t=ccui.CheckBox.create(),this.AddTouchEvent(t,this.onCheckBoxEvent,a,a.eventListener,e.touchListener);else if("UIScrollView"==e.type)t=ccui.ScrollView.create(),s&&this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener);else if("UIListView"==e.type)t=ccui.ListView.create(),s&&this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener);else if("UIRichText"==e.type){var h={};e.oriFontSize&&(h.fontSize=e.oriFontSize),e.oriOSize&&(h.osize=e.oriOSize);var i=this.CovertToColor(e.oriColor);i&&(h.color=i),i=this.CovertToColor(e.oriOColor),i&&(h.ocolor=i);var u=e.text||"",d=UIDataUtils.TryAnalyseLang(u);u=d.isKey?d.value:e.text;var l=this.CalcWidth(t,e.width,r),g=this.CalcHeight(t,e.height,r);t=new UIRichText(e.text||"",{width:l,height:g},h)}else t=ccui.Widget.create(),s&&this.AddTouchEvent(t,this.addTouchListenerCallback,a,a.eventListener,e.touchListener);if(r&&!t.getParent()&&r.addChild(t),t._isWaitLoad)var n=this,_=cc.eventManager.addCustomListener("Loaded:"+t.__instanceId,function(){n.SetBaseNodeProp(t,e,r,a),cc.eventManager.removeListener(_)});else this.SetBaseNodeProp(t,e,r,a);e.children=e.children||{};for(var m=0;m<e.children.length;m++){var p=e.children[m];this.CocosGenBaseNodeByData(p,null,t,a)}return t},UIUtils.SetBaseNodeProp=function(e,t,r,a){if("boolean"==typeof t.touchEnabled&&e.setTouchEnabled&&e.setTouchEnabled(t.touchEnabled),t.id&&(e.setName(t.id),a&&(a[t.id]&&console.log("WAINING!!! You have same tag name("+t.id+") node"),a[t.id]=e)),!t.isSizeSeted&&(t.width||t.height)){var i=e.setPreferredSize||e.setContentSize,s=this.CalcWidth(e,t.width,r),n=this.CalcHeight(e,t.height,r);i.call(e,cc.size(s,n))}if(t.autoLayout&&(r&&e!=r?e.setContentSize(r.getContentSize()):e.setContentSize(cc.winSize),SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION)){var o=e.getContentSize();e.setContentSize(cc.size(o.height,o.width))}var c=this.isNull,l=this.CovertToColor;if(!c(t.x)&&(e.x=parseFloat(t.x)),!c(t.y)&&(e.y=parseFloat(t.y)),!c(t.left)&&(e.x=parseFloat(t.left),e.left=t.left),!c(t.right)&&r&&(e.x=r.width-parseFloat(t.right),e.right=t.right),!c(t.horizontal)&&r&&(e.x=r.width/2+t.horizontal,e.horizontal=t.horizontal),!c(t.bottom)&&(e.y=parseFloat(t.bottom),e.bottom=t.bottom),!c(t.top)&&r&&(e.y=r.height-parseFloat(t.top),e.top=t.top),!c(t.vertical)&&r&&(e.y=r.height/2+t.vertical,e.vertical=t.vertical),!c(t.anchorX)&&(e.anchorX=parseFloat(t.anchorX)),!c(t.anchorY)&&(e.anchorY=parseFloat(t.anchorY)),!c(t.scaleX)&&(e.scaleX=parseFloat(t.scaleX)),!c(t.scaleY)&&(e.scaleY=parseFloat(t.scaleY)),!c(t.opacity)&&(e.opacity=parseFloat(t.opacity)),!c(t.rotation)&&(e.rotation=parseFloat(t.rotation)),!c(t.visible)&&e.setVisible(t.visible),l(t.color)&&(e.color=l(t.color)),!c(t.touchListener)&&(e.touchListener=t.touchListener),t.path)t.setCustomData&&t.setCustomData(t);else if("UIText"==t.type){if(t.string){var g=UIDataUtils.TryAnalyseLang(t.string);g.isKey?e.setString(g.value):e.setString(t.string)}t.textAlign&&e.setTextHorizontalAlignment(t.textAlign),t.verticalAlign&&e.setTextVerticalAlignment(t.verticalAlign),t.fontSize&&e.setFontSize(t.fontSize),t.fontName&&e.setFontName(t.fontName),color=l(t.outlineColor),color&&e.enableOutline(color,t.outlineSize||1),(t.boundingWidth||t.boundingHeight)&&e.setTextAreaSize(cc.size(t.boundingWidth||0,t.boundingHeight||0))}else"UIInput"==t.type?(t.string&&e.setString(t.string),color=l(t.fontColor),color&&e.setFontColor(color),t.maxLength&&e.setMaxLength(t.maxLength),t.placeHolder&&e.setPlaceHolder(t.placeHolder),t.placeHolderFontSize&&e.setPlaceholderFontSize(t.placeHolderFontSize),t.placeHolderFontName&&e.setPlaceholderFontName(t.placeHolderFontName),t.inputFlag&&e.setInputFlag(parseInt(t.inputFlag)),t.inputMode&&e.setInputMode(parseInt(t.inputMode)),t.returnType&&e.setReturnType(parseInt(t.returnType))):"UIImage"==t.type?(this.SetNodeBySpriteFrameName(t.spriteFrame,e,e.loadTexture),t.blendSrc&&e.setBlendFunc({src:t.blendSrc,dst:e.getBlendFunc().dst}),t.blendDst&&e.setBlendFunc({src:e.getBlendFunc().src,dst:t.blendDst})):"UIScale9"==t.type?(t.insetLeft&&(e.insetLeft=t.insetLeft),t.insetTop&&(e.insetTop=t.insetTop),t.insetRight&&(e.insetRight=t.insetRight),t.insetBottom&&(e.insetBottom=t.insetBottom)):"UISlider"==t.type?(t.percent&&e.setPercent(t.percent),this.SetNodeBySpriteFrameName(t.barBg,e,e.loadBarTexture),this.SetNodeBySpriteFrameName(t.barProgress,e,e.loadProgressBarTexture),this.SetNodeBySpriteFrameName(t.barNormalBall,e,e.loadSlidBallTextureNormal),this.SetNodeBySpriteFrameName(t.barSelectBall,e,e.loadSlidBallTexturePressed),this.SetNodeBySpriteFrameName(t.barDisableBall,e,e.loadSlidBallTextureDisabled)):"UIButton"==t.type?(t.scale9Enable&&e.setScale9Enabled(t.scale9Enable),this.SetNodeBySpriteFrameName(t.bgNormal,e,e.loadTextureNormal),this.SetNodeBySpriteFrameName(t.bgSelect,e,e.loadTexturePressed),this.SetNodeBySpriteFrameName(t.bgDisable,e,e.loadTextureDisabled),t.titleText&&e.setTitleText(t.titleText),t.fontSize&&e.setTitleFontSize(t.fontSize),t.fontName&&e.setTitleFontName(t.fontName),color=l(t.fontColor),color&&e.setTitleColor(color)):"UICheckBox"==t.type?(this.SetNodeBySpriteFrameName(t.back,e,e.loadTextureBackGround),this.SetNodeBySpriteFrameName(t.backSelect,e,e.loadTextureBackGroundSelected),this.SetNodeBySpriteFrameName(t.active,e,e.loadTextureFrontCross),this.SetNodeBySpriteFrameName(t.backDisable,e,e.loadTextureBackGroundDisabled),this.SetNodeBySpriteFrameName(t.activeDisable,e,e.loadTextureFrontCrossDisabled),t.select&&e.setSelected(t.select),t.enable&&e.setTouchEnabled(t.enable)):"UITextAtlas"==t.type?t.charMapFile&&(e.uiData=t,e.setProperty(t.string,UIDataUtils.CalcUIPath(t.charMapFile),t.itemWidth,t.itemHeight,t.mapStartChar)):"UIArmature"==t.type?e.getAnimation().play("stand",-1,1):"UIScrollView"==t.type||"UIListView"==t.type?(e.setClippingType(1),(t.innerPosX||t.innerPosY)&&e.setInnerContainerPosition(cc.p(t.innerPosX||0,t.innerPosY||0)),(t.innerSizeW||t.innerSizeH)&&e.setInnerContainerSize(cc.size(t.innerSizeW||0,t.innerSizeH||0)),t.direction&&e.setDirection(t.direction),"boolean"==typeof t.scrollBarEnabled&&e.setScrollBarEnabled(t.scrollBarEnabled),"boolean"==typeof t.inertiaScrollEnabled&&e.setInertiaScrollEnabled(t.inertiaScrollEnabled),"boolean"==typeof t.bounceEnabled&&e.setBounceEnabled(t.bounceEnabled)):"UIRichText"==t.type&&(t.textAlign&&e.setTextHorizontalAlignment(t.textAlign),t.verticalAlign&&e.setTextVerticalAlignment(t.verticalAlign));return"UIListView"==t.type&&(t.gravity&&e.setGravity(t.gravity),t.itemsMargin&&e.setItemsMargin(t.itemsMargin)),e},UIUtils.SetNodeBySpriteFrame=function(e,t,r){if(e){e=UIDataUtils.CalcUIPath(e);var a=this.GetSpriteFrameForName(e);a&&r.call(t,a)}},UIUtils.SetNodeBySpriteFrameName=function(e,t,r,a){if(e){e=UIDataUtils.CalcUIPath(e);var i=this.GetSpriteFrameForName(e);i&&r.call(t,e,a||1)}},UIUtils.GetSpriteFrameForName=function(e){if("string"!=typeof e)return null;var t=cc.spriteFrameCache.getSpriteFrame(e);if(!t){var r=cc.textureCache.getTextureForKey(e);r&&(t=cc.SpriteFrame.create(r,cc.rect(0,0,r.getContentSize().width,r.getContentSize().height)),cc.spriteFrameCache.addSpriteFrame(t,e))}return t},UIUtils.GetTextureForName=function(e){if("string"!=typeof e)return null;var t=cc.textureCache.getTextureForKey(e);return t},UIUtils.merge=function(e,t){if("object"!=typeof e||"object"!=typeof t)return e;for(var r in t)e[r]=t[r];return e},UIUtils.dup=function(e){if("object"!=typeof e)return e;var t={};for(var r in e)t[r]=e[r];return t},HEEPAY_META_AGENT_ID=function(){return 1664502},HEEPAY_META_OPTION_IOS=function(){return'{"s":"IOS","n":"拱趴游戏","id":"com.gongpa.hall"}'},HEEPAY_META_OPTION_ANDROID=function(){return'{"s":"Android","n":"拱趴游戏","id":"com.gongpa.hall"}'},HEEPAY_META_OPTION_WAP=function(e){return'{"s":"WAP","n":"拱趴游戏","id":"'+e+'"}";)'},HEEPAY_PAY_WEB=function(e){var t={};this.moeny=e,t.agent_id=HEEPAY_META_AGENT_ID(),t.is_phone=1,t.is_frame=1,t.pay_type=30,t.pay_amt=e,t.return_url=encodeURIComponent(getShareUrl(0,0)),cc.sys.isNative&&(t.return_url="https://"),t.notify_url="unknow",t.user_ip=ME_D.get_user().client_ip,t.is_test=1,t.goods_name=encodeURIComponent(ROOM_CARD_NAME),t.goods_num=this.reward,t.goods_note=encodeURIComponent(this.reward+"x"+ROOM_CARD_NAME),t.pay_code="",t.remark="",t.ownMoney=ME_D.get_user().room_card,t.extendUid=ME_D.get_user().extend_uid,t.userName=ME_D.get_user().name,t.userRid=ME_D.get_user().rid,t.userUid=ME_D.get_user().account_uid,t.detail=GAME_TYPE,cc.sys.isNative?(t.is_frame=0,cc.sys.os===cc.sys.OS_IOS?t.meta_option=encodeURIComponent(HEEPAY_META_OPTION_IOS()):t.meta_option=encodeURIComponent(HEEPAY_META_OPTION_ANDROID())):t.meta_option=encodeURIComponent(HEEPAY_META_OPTION_WAP(t.return_url));var r={method:"POST",timeout:5e3,url:GAME_WEB_URL+":1339/apihfbpay/ApiRequestSign",data:JSON.stringify(t)};ModuleMgr.showWaitMsg("获取订单中",0),HttpNetworkRequest(r,function(e,t){ModuleMgr.removeWaitMsg();var r=ConvertToJson(t);if(r.ret==-1)return ModuleMgr.showTipMsg(r.error);if(cc.sys.isNative){var a="https://pay.Heepay.com/Payment/Index.aspx?";for(var i in r)a+=i+"="+r[i]+"&";cc.sys.openURL(a)}else{var s="";for(var i in r)s+="<input type='hidden' name='"+i+"' value='"+r[i]+"'/>";var n=document.getElementById("wxPay");n.innerHTML=s,n.submit()}})},playEffect=function(e){if(e){var t=cc.sys.localStorage.getItem("effectsVolume");t<=0||cc.audioEngine.playEffect(GetRealPath("res/music/"+e))}};var lastMusicName="",lastCacheName="";playMuisc=function(e){if(e){var t=cc.sys.localStorage.getItem("musicVolume");if(t<=0)return void(lastCacheName=e);if(lastMusicName!=e){lastMusicName=e,lastAudio=cc.audioEngine.playMusic(GetRealPath("res/music/"+e),1);var r=cc.sys.localStorage.getItem("musicVolume")||0;gSetMusic(r<=0)}}},Array.prototype.remove=function(e){if(isNaN(e)||e>this.length)return!1;for(var t=0,r=0;t<this.length;t++)this[t]!=this[e]&&(this[r++]=this[t]);this.length-=1},gDup=function(e){if("object"!=typeof e)return e;if(void 0!=e.length){for(var t=[],r=0;r<e.length;r++)t[r]=e[r];return t}var a={};for(var i in e)a[i]=e[i];return a},gDeepDup=function(e){if("object"!=typeof e)return e;if(void 0!=e.length){for(var t=[],r=0;r<e.length;r++)t[r]=gDeepDup(e[r]);return t}var a={};for(var i in e)a[i]=gDeepDup(e[i]);return a},ModuleMgr={},g_dlgLayer=null;var g_scene=null,DLG_ZORDER=100,MSG_ZORDER=200,GUILD_ZORDER=900,WAIT_MSG_TAG=-200,CONFIRM_MSG_TAG=-201,clsMap={},loadGameMap={};ModuleMgr.runScene=function(e,t){function r(e,t){var r=clsMap[e];if(!r)return void console.log("========can not find the scene == "+e+"====");var a=r.create(t);cc.director.runScene(a),g_scene=a,g_scene.name=e,g_dlgLayer=cc.Node.create(),g_dlgLayer.setContentSize(cc.winSize),g_scene.addChild(g_dlgLayer)}g_scene&&g_scene.name==e||(!loadGameMap[e]&&ModuleLoadGame[e]?cc.loader.loadJs(ModuleLoadGame[e],function(){loadGameMap[e]=!0,r(e,t)}):r(e,t))},ModuleMgr.enterGameScene=function(){var e={all_effect_xml:"res/fla/all_effect.xml",all_effect_png:"res/fla/all_effect.png",all_effect_plist:"res/fla/all_effect.plist",score_blue:"res/uires/game/score_blue.png",score_yellow:"res/uires/game/score_yellow.png",img_red5_1:"res/uires/game/img_red5_1.png",pocker_png:"res/plist/pocker.png",pocker_plist:"res/plist/pocker.plist",game_bg:"res/uires/game/bg.jpg"};GAME_TYPE==GAME_TYPE_LS?(e.game_txt_png="res/uires/luosong/game_txt.png",e.game_txt_plist="res/uires/luosong/game_txt.plist"):(e.game_txt_png="res/plist/game_txt.png",e.game_txt_plist="res/plist/game_txt.plist");var t=[];for(var r in e)t.push(GetRealPath(e[r]));cc.log("start loading"),cc.loader.load(t,function(e,t,r){ModuleMgr.showWaitMsg("努力加载中"+parseInt(100*r/t)+"%",0)},function(){cc.log("end loading"),ModuleMgr.removeWaitMsg(),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/pocker.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/game_txt.plist")),cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("fla/all_effect.plist")),ccs.armatureDataManager.addArmatureFileInfo(UIDataUtils.CalcUIPath("fla/all_effect.xml")),GAME_TYPE==GAME_TYPE_LS?cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("uires/luosong/game_txt.plist")):cc.spriteFrameCache.addSpriteFrames(UIDataUtils.CalcUIPath("plist/game_txt.plist")),ModuleMgr.runScene("GameScene")})},ModuleMgr.runDlg=function(){function e(e,t,r,a){function i(){n.setAnchorPoint(.5,.5),n.setPositionX(cc.winSize.width/2),n.setPositionY(cc.winSize.height/2),a&&a(n)}var s=clsMap[e];if(!s)return void console.log("========can not find the dlg == "+e+"====");if(ModuleMgr.getDlg(e)&&(!s.canMultiOpen||!s.canMultiOpen()))return void console.log("========try to open the same the dlg == "+e+"====");var n=s.create(t,r);if(n.setName(e),n.setLocalZOrder(DLG_ZORDER),n.isLoaded())i();else var o=cc.eventManager.addCustomListener("Loaded:"+n.__instanceId,function(){i(),cc.eventManager.removeListener(o)});n.setRotation(ModuleMgr.getScreenRotation()),n.getParent()||r.addChild(n)}var t,r,a,i;t=arguments[0],2==arguments.length&&(i=arguments[1]),arguments.length>=3&&(r=arguments[1],a=arguments[2],i=arguments[3]),a=a||g_dlgLayer,"function"==typeof r&&(i=r,r=null),!loadGameMap[t]&&ModuleLoadGame[t]?cc.loader.loadJs(ModuleLoadGame[t],function(){
loadGameMap[t]=!0,e(t,r,a,i)}):e(t,r,a,i)},ModuleMgr.runNode=function(){function e(e,t,r){function a(){i&&i(n),n.release()}var s=clsMap[e];if(!s)return void console.log("========can not find the dlg == "+e+"====");var n=s.create(t,r);if(n.setName(e),n.retain(),n.attr({x:0,y:0,anchorX:0,anchorY:0}),n.isLoaded())a();else var o=cc.eventManager.addCustomListener("Loaded:"+n.__instanceId,function(){a(),cc.eventManager.removeListener(o)});r&&!n.getParent()&&r.addChild(n)}var t,r,a,i;t=arguments[0],2==arguments.length&&(i=arguments[1]),arguments.length>=3&&(r=arguments[1],a=arguments[2],i=arguments[3]),"function"==typeof r&&(i=r,r=null,a=null),!loadGameMap[t]&&ModuleLoadGame[t]?cc.loader.loadJs(ModuleLoadGame[t],function(){loadGameMap[t]=!0,e(t,r,a)}):e(t,r,a)},ModuleMgr.createNode=function(){function e(){i&&i(s),s.release()}var t,r,a,i;t=arguments[0],2==arguments.length&&(i=arguments[1]),arguments.length>=3&&(r=arguments[1],a=arguments[2],i=arguments[3]);var s=t.create(r,a);if(s.retain(),a&&!s.getParent()&&a.addChild(s),s.isLoaded())e();else var n=cc.eventManager.addCustomListener("Loaded:"+s.__instanceId,function(){e(),cc.eventManager.removeListener(n)});return s},ModuleMgr.createTouchDlg=function(e){var t=cc.LayerColor.create(cc.color(0,0,0,155)),r=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,a){return e&&e()&&cc.eventManager.removeListener(r),!0}});return t.onExit=function(){cc.LayerColor.prototype.onExit.call(t),cc.eventManager.removeListener(r)},cc.eventManager.addListener(r,t),t},ModuleMgr.removeAllDlg=function(){g_dlgLayer.removeAllChildren()},ModuleMgr.getDlg=function(e){return g_dlgLayer.getChildByName(e)},ModuleMgr.runOrientationDlg=function(){var e=arguments[0];SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&(e="L_"+e),arguments[0]=e,ModuleMgr.runDlg.apply(this,arguments)},ModuleMgr.closeOrientationDlg=function(e){SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&(e="L_"+e),ModuleMgr.closeDlg(e)},ModuleMgr.closeDlg=function(e){var t=ModuleMgr.getDlg(e);t&&t.close()},ModuleMgr.getScreenRotation=function(){if(SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION){if(0==cc.sys.isNative&&__BrowserGetter){var e=__BrowserGetter.availWidth(cc.EGLView._getInstance()._frame),t=__BrowserGetter.availHeight(cc.EGLView._getInstance()._frame);if(e>t)return-90}return 90}return 0},ModuleMgr.registerModule=function(e,t){clsMap[e]=t},ModuleMgr.showTipMsg=function(e,t){var r=e,a={};a.type=MsgMgr.MSG_TYPE.TIP,a.text=r,a.strArr=t,ModuleMgr.showMsg(a)},ModuleMgr.showConfirmCancelMsg=function(e,t,r,a){var i={};i.type=MsgMgr.MSG_TYPE.CONFIRM,i.text=e,i.okFunc=t,i.cancelFunc=r,i.time=a,ModuleMgr.showMsg(i)},ModuleMgr.showConfirmTxtMsg=function(e,t){var r={};r.type=MsgMgr.MSG_TYPE.CONFIRM,r.text=e,null==t&&(t=function(){}),r.okFunc=t;var a=ModuleMgr.showMsg(r);a.hideCancel()},ModuleMgr.waitView=null,ModuleMgr.showWaitMsg=function(e,t,r){if(ModuleMgr.waitView)return void ModuleMgr.waitView.updateTxt(e||"");null==r&&(r=!0),ModuleMgr.removeWaitMsg(),null==t?SGMsgWait.waitTime=2:SGMsgWait.waitTime=t;var a={};a.type=MsgMgr.MSG_TYPE.WAIT,a.text=e||"",a.black=r;var i=ModuleMgr.showMsg(a);i.setTag(WAIT_MSG_TAG),ModuleMgr.waitView=i},ModuleMgr.removeWaitMsg=function(){ModuleMgr.waitView&&(ModuleMgr.waitView.close(),ModuleMgr.waitView=null)},ModuleMgr.showMsg=function(e){var t=MsgMgr.showMsg(e);if(console.log("msg object = "+t),t)return t.setLocalZOrder(MSG_ZORDER),t.setTag(MSG_ZORDER),g_dlgLayer.addChild(t),t.setRotation(ModuleMgr.getScreenRotation()),t},ModuleLoadGame={},MsgMgr={},MsgMgr.MSG_TYPE={TIP:1,WAIT:2,CONFIRM:3},MsgMgr.msgList={},MsgMgr.registerMsg=function(e,t){this.msgList[e]||(this.msgList[e]=t)},MsgMgr.showMsg=function(e){var t=e.type,r=e.text,a=(e.func,e.id,this.msgList[t]);if(!a)return void console.log("===================== can not find then msg type  "+t);e.text=r;var i=a.create();if(i.isLoaded())i.setData(e),i.show();else var s=cc.eventManager.addCustomListener("Loaded:"+i.__instanceId,function(){i.setData(e),i.show(),cc.eventManager.removeListener(s)});return i},QPLayer=UILayer.extend({isControlNode:!1,_textTempMap:{},onExit:function(){this.unscheduleUpdate(),UILayer.prototype.onExit.call(this)},setText:function(){var e=arguments[0],t=this[e];if(t){var r=this._textTempMap[e];r||(this._textTempMap[e]=t.getString(),r=this._textTempMap[e]),r||(r="");for(var a="",i=[],s=1;s<arguments.length;s++)i.push(arguments[s]);for(var n=r.split("%s"),s=0;s<n.length;s++)a+=n[s],i[s]&&(a+=i[s]);t.setString(a)}},sortGrp:function(e,t,r,a){var e=e,r=r||0,t=t||0,a=a||0,s=this[e];if(s){var n=s.getChildren()||[],o=0,c=0;for(i=0;i<n.length;i++){var l=n[i];if(l&&l.isVisible()){var g=l.getContentSize(),h=g.width*l.getScaleX(),u=g.height*l.getScaleY();0==r?(o=o+h+t,u>c&&(c=u)):(c=c+u+t,h>o&&(o=h))}}0==r?o-=t:c-=t,s.setContentSize(cc.size(o,c));var d=0;for(1==r&&(d=c),1==a&&(d=o),i=0;i<n.length;i++){var l=n[i];if(l&&l.isVisible()){var g=l.getContentSize(),h=g.width*l.getScaleX(),u=g.height*l.getScaleY();0==r?1==a?(l.setAnchorPoint(1,0),l.setPositionY(0),l.setPositionX(d),d=d-h-t):(l.setAnchorPoint(0,0),l.setPositionY(0),l.setPositionX(d),d=d+h+t):(l.setAnchorPoint(0,1),l.setPositionX(0),l.setPositionY(d),d=d-u-t)}}return s}},refreshList:function(e){var t=this,r=e.name,a=e.itemCell||t[r+"_item"],i=e.list,s=e.selectId||0,n=e.async||!1;if(i&&a){var o=t[r];if(o){o.setClippingType(ccui.Layout.CLIPPING_STENCIL),o.setBounceEnabled(!0);var c=0;ModuleMgr.createNode(a,function(e){function l(e,t){d=a.create();var r=d.getContentSize();d.setAnchorPoint(.5,.5),d.setPositionX(r.width/2),d.setPositionY(r.height/2),d.setTouchEnabled(!0),o.pushBackCustomItem(d),d.setTag(t),d.setData&&d.setData(e),s==t?d.setSelect&&d.setSelect():d.setNormal&&d.setNormal()}function g(e,r,a){t.scheduleOnce(function(){l(e,r)},a)}var h=o.getItems()||[];for(m=0;m<i.length;m++){var u=i[m],d=h[m];d?(d.setTag(m),d.setData&&d.setData(u),s==m?d.setSelect&&d.setSelect():d.setNormal&&d.setNormal()):n?(c+=.01,g(u,m,c)):l(u,m)}if(i.length<h.length)for(var _=h.length,m=i.length;m<_;m++)o.removeLastItem();o.addEventListener(function(e,a){cc.log("select eventType = "+a),cc.log("select child index = "+e.getCurSelectedIndex());var i=e.getCurSelectedIndex();if(0==a){var s="tap_begin_"+r;t[s]&&t[s](i)}else{var s="tap_end_"+r;t[s]&&t[s](i);for(var n=e.getItems(),o=0;o<n.length;o++){var c=n[o];o==i?c.setSelect&&c.setSelect():c.setNormal&&c.setNormal()}}},t)})}}}}),QPLayer.create=function(e,t,r){return new QPLayer(e,t,r)},QPDlg=QPLayer.extend({isTouchClose:!1,isAllLoaded:!1,isDlgActionEnd:!1,ctor:function(e,t,r){QPLayer.prototype.ctor.call(this,e,t,r)},onSuccessInit:function(){QPLayer.prototype.onSuccessInit.call(this);var e=this,t=cc.LayerColor.create(cc.color(0,0,0,150));t.setContentSize(cc.size(3*cc.winSize.width,3*cc.winSize.height)),t.setPosition(cc.p(-cc.winSize.width,-cc.winSize.height));var r=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,t){return!0},onTouchEnded:function(t,r){e.isTouchClose&&e.close()}});t.onExit=function(){cc.LayerColor.prototype.onExit.call(t),cc.eventManager.removeListener(r)},cc.eventManager.addListener(r,t),e.addChild(t),e.scale=.1;var a=function(t){e.isDlgActionEnd=!0,e.isAllLoaded&&e.dlgActionEnd()},i=cc.Sequence.create(cc.ScaleTo.create(.15,1.05),cc.ScaleTo.create(.1,1),cc.CallFunc.create(a));this.runAction(i)},dlgActionEnd:function(){},onLoaded:function(){this.isAllLoaded=!0,this.isDlgActionEnd&&this.dlgActionEnd()},tap_btn_close:function(e){this.close()}}),QPDlg.create=function(e,t,r){return new QPDlg(e,t,r)},QPListItem=QPLayer.extend({_isSeclet:!1,onLoaded:function(){this._onNormal()},setData:function(e){},setSelect:function(){this._isSeclet||(this._isSeclet=!0,this._onSelect())},setNormal:function(){this._isSeclet&&(this._isSeclet=!1,this._onNormal())},_onSelect:function(){},_onNormal:function(){}}),QPListItem.create=function(e,t,r){return new QPListItem(e,t,r)},WaitMgr={},WaitMgr.msgKeyMap={},WaitMgr.showWait=function(e,t,r){this.msgKeyMap[e]=(this.msgKeyMap[e]||0)+1,ModuleMgr.showWaitMsg(t,r)},WaitMgr.hideWait=function(e){this.msgKeyMap[e]>0&&(this.msgKeyMap[e]=this.msgKeyMap[e]-1,this.msgKeyMap[e]<=0&&(this.msgKeyMap[e]=0));var t=!0;for(var r in this.msgKeyMap)if(this.msgKeyMap[r]>0){t=!1;break}t&&ModuleMgr.removeWaitMsg()},GAME_PAY_TYPE_HEEPAY=0,GAME_PAY_TYPE_JTPAY=1,GAME_PAY_TYPE=GAME_PAY_TYPE_HEEPAY;var gameTypeMap={};RegisterGameType=function(e){gameTypeMap[e]=e},GetGameType=function(e){return gameTypeMap[e]},GAME_TYPE_GP="thirteen-water",GAME_TYPE_XX="ttw_xx",GAME_TYPE_WZ="ttw_wz",GAME_TYPE_LS="ttw_ls",GAME_TYPE_DD="ttw_dd",GAME_TYPE_QL="ttw_ql",GAME_TYPE_DZ="ttw_dz",GAME_TYPE_DZ2="ttw_dz2",GAME_TYPE_Q8="ttw_q8",GAME_TYPE_FF="ttw_ff",GAME_TYPE=GAME_TYPE_GP,RegisterGameType(GAME_TYPE_GP),RegisterGameType(GAME_TYPE_XX),RegisterGameType(GAME_TYPE_WZ),RegisterGameType(GAME_TYPE_LS),RegisterGameType(GAME_TYPE_DD),RegisterGameType(GAME_TYPE_QL),RegisterGameType(GAME_TYPE_DZ),RegisterGameType(GAME_TYPE_DZ2),RegisterGameType(GAME_TYPE_Q8),RegisterGameType(GAME_TYPE_FF),MUSIC_TYPE="man_speed",MUSIC_CHAT_TYPE="man_speed",GAME_NAME="[拱趴十三水]",GAME_AREA_NAME_1="福州玩法",GAME_AREA_NAME_2="南平玩法",ROOM_CARD_NAME="茶叶",GAME_SHOW_CARD_SPEED=1,MAX_ROLE_NUM=7,EVENT_ENTER_GAME="EVENT_ENTER_GAME",EVENT_ENTER_ROOM="EVENT_ENTER_ROOM",EVENT_ENTER_DESK="EVENT_ENTER_DESK",EVENT_DESK_INFO="EVENT_DESK_INFO",EVENT_ROOM_DETAIL="EVENT_ROOM_DETAIL",EVENT_ROOM_MSG_RECEIVE="EVENT_ROOM_MSG_RECEIVE",EVENT_CONNECTION_LOST="EVENT_CONNECTION_LOST",HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_gp/wf_1.png"),GetRealPath("res/uires/wanfa_gp/wf_2.png"),GetRealPath("res/uires/wanfa_gp/wf_3.png"),GetRealPath("res/uires/wanfa_gp/wf_4.png")],FORMATION_TIME=90,GUN_ROTAION=[[0,-45,45,90],[-45,0,0,45],[45,0,0,-45],[-90,45,-45,0]],GUN_SCALEX=[[1,-1,1,1],[1,1,1,1],[-1,-1,-1,-1],[1,-1,1,1]];var chatCfgList=["还不出牌，我都快去吃锅边糊了","嗨呀，我家里老人都比你打的快","嗨呀，打牌打的我都困了","哎，你快慢慢找，我先去西湖逛一下","快一点呀，等你想好我厕所都上一趟了","你这在干嘛，这么慢","嗨呀，最近在忙什么，很久没见了","来快来，三缺一呀","来来来，赶紧坐下来打一圈","跟你们这些高手打我会紧张，让我一点","蛮玩到天亮，输了可以让你们先欠着"],chatVoiceCfgList=["CHAT1.mp3","CHAT2.mp3","CHAT3.mp3","CHAT4.mp3","CHAT5.mp3","CHAT6.mp3","CHAT7.mp3","CHAT8.mp3","CHAT9.mp3","CHAT10.mp3","CHAT11.mp3"];ROOM_CARD_COST=[{round:5,cost:1},{round:10,cost:2},{round:20,cost:3}],getNativeDownUrl=function(){var e=new Date;return GAME_TYPE==GAME_TYPE_XX?SHARE_URL+GAME_TYPE+"/index.html?time="+e.getTime():GAME_TYPE==GAME_TYPE_WZ?SHARE_URL+GAME_TYPE+"/index.html?time="+e.getTime():GAME_TYPE==GAME_TYPE_Q8?"http://fir.im/u7xc":GAME_TYPE==GAME_TYPE_DZ?"http://fir.im/ckh9":GAME_TYPE==GAME_TYPE_QL?"http://fir.im/tn1m":GAME_TYPE==GAME_TYPE_LS?"http://fir.im/zlgc":GAME_TYPE==GAME_TYPE_DD?"http://fir.im/2s5f":SHARE_URL+"/index.html?time="+e.getTime()},IS_TEST_CARD=1,H5_FOCUS_PUBLIC_URL="http://mp.weixin.qq.com/s/7ankBO1vIrxLZtXAUSgIig",GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"做庄玩法"},{type:2,txt:"   ● 做庄玩法是在普通玩法的基础上改变了比牌方式，即庄家和闲家进行比牌，闲家之间不另外进行比牌，庄家由房主担任，其他玩家为闲家。"},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"    [c255:124:102]同花顺[/c]（同一花色的顺子）[br]    [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}:[/c]同一种花色，A到K各一张的十三张牌型。  "},{type:2,txt:"   ● [c255:217:102]十三水{一条龙}:[/c]不同花色，A到K各一张的是十三张牌型。 "},{type:2,txt:"   ● [c255:217:102]报道{六对半}:[/c]十三张牌由六个对子加一张其他单排组成。 "},{type:2,txt:"   ● [c255:217:102]报道{三顺子}:[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。"},{type:2,txt:"   ● [c255:217:102]报道{三同花}:[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                    [c142:255:102]+1[/c]分[br] ◇ 同一道大于其他玩家"},{type:2,txt:"   ● 输一道                    [c142:255:102]-1[/c]分[br] ◇ 同一道小于其他玩家"},{type:2,txt:"   ● 打和                      [c142:255:102]+0[/c]分[br] ◇ 同一道和其他玩家相同"},{type:2,txt:"   ● 打枪                      [c142:255:102]×2[/c]分[br] ◇ 比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。"},{type:2,txt:"   ● 全垒打                    [c142:255:102]×2[/c]分[br] ◇ 比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）"},{type:2,txt:"   ● 冲三                      [c142:255:102]+3[/c]分[br] ◇ 头道为三条，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。"},{type:2,txt:"   ● 中墩葫芦                  [c142:255:102]+2[/c]分[br] ◇ 中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。"},{type:2,txt:"   ● 铁支                 \t [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]  ◇ 中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。"},{type:2,txt:"   ● 同花顺                    [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br] ◇ 中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。"},{type:2,txt:"   ● 五同                      [c142:255:102]+7[/c]或[c142:255:102]+14[/c]分[br] ◇ 中道为五同，且大于对手，赢家可获得1分外，再加12分，总计赢13分，输家则输13分。尾道为同花顺，且大于对手，赢家可获得1分外，再加6分，总计赢7分，输家则输7分。"},{type:2,txt:"   ● 三同花                    [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 三顺子       \t\t  [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 六对半                    [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 一条龙                    [c142:255:102]+52[/c]分[br] ◇ 若大于其他玩家，赢取每家52分。"},{type:2,txt:"   ● 清龙                 \t  [c142:255:102]+52[/c]分[br] ◇ 若大于其他玩家，赢取每家52分。"},{type:1,txt:"玩法类型"},{type:2,txt:"   ● 普通场 \t"},{type:2,txt:"      ◇⋯ 轻松休闲 ⋯◇"},{type:2,txt:"   ● 疯狂场  "},{type:2,txt:"      ◇⋯ 精彩刺激 ⋯◇"},{type:2,txt:"   ● 买马玩法"},{type:2,txt:"      ◇手中有马牌的玩家与其他玩家比牌计分基础×2，其他玩家对比不翻倍"},{type:2,txt:"   ● 福州玩法"},{type:2,txt:"      ◇福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块。"},{type:2,txt:"   ● 南平玩法"},{type:2,txt:"      ◇南平玩法中双方同花顺大小一样时不比花色大小。"},{type:2,txt:"   ● 有鬼"},{type:2,txt:"      ◇牌型中加入大小鬼王,大小鬼王可替代任意牌。"},{type:2,txt:"   ● 无鬼"},{type:2,txt:"      ◇牌型中无大小鬼王。"},{type:1,txt:"模式选择"},{type:2,txt:"   ● 房卡消耗"},{type:2,txt:"      ◇房主付:该局结束时，由房主支付房卡。"},{type:2,txt:"      ◇赢家付:该局结束时，由本局赢得积分最多的支付房卡。"},{type:2,txt:"      ◇平摊模式:该局结束时，平摊支付房卡。"},{type:2,txt:"      ◇赢家付模式遇倒同分情况或平躺模式中平摊不均时根据具体情况进行计算。"},{type:2,txt:"   ● 加色玩法"},{type:2,txt:"      ◇不加色:52张牌（无大小王）。 "},{type:2,txt:"      ◇加一色:52张牌（无大小王）附加一组 黑桃A-K 且支持5位玩家共同体验。"},{type:2,txt:"      ◇加二色:52张牌（无大小王）附加一组 黑桃A-K,红桃A-K 且支持6位玩家共同体验。"},{type:2,txt:"      ◇加三色:52张牌（无大小王）附加一组 黑桃A-K,红桃A-K,梅花A-K 且支持7位玩家共同体验。 "}],CMD_INTERNAL_AUTH="cmd_internal_auth",CMD_LOGIN="cmd_login",CMD_USER_LIST="cmd_user_list",MSG_USER_LIST="msg_user_list",CMD_CREATE_USER="cmd_create_user",MSG_CREATE_USER="msg_create_user",CMD_SELECT_USER="cmd_select_user",MSG_ENTER_GAME="msg_enter_game",MSG_LOGIN_NOTIFY_STATUS="msg_login_notify_status",NEW_CLIENT_INIT="new_client_init",LOSE_CLIENT="lose_client",CMD_COMMON_OP="cmd_common_op",MSG_COMMON_OP="msg_common_op",MSG_OBJECT_UPDATED="msg_object_updated",MSG_PROPERTY_LOADED="msg_property_loaded",MSG_BONUS="msg_bonus",CMD_SALE_OBJECT="cmd_sale_object",MSG_SALE_OBJECT="msg_sale_object",MSG_PROPERTY_DELETE="msg_property_delete",CMD_CHAT="cmd_chat",MSG_CHAT="msg_chat",CMD_LEAVE_ROOM="cmd_leave_room",MSG_DB_RESULT="msg_db_result",CMD_ROOM_MESSAGE="cmd_room_message",CMD_ENTER_DESK="cmd_enter_desk",MSG_ENTER_DESK="msg_enter_desk",CMD_CREATE_DESK="cmd_create_desk",MSG_CREATE_DESK="msg_create_desk",CMD_BIND_EXTEND="cmd_bind_extend",MSG_BIND_EXTEND="msg_bind_extend",CMD_SHARE_GAME="cmd_share_game",MSG_SHARE_GAME="msg_share_game",MSG_NEW_DAY="msg_new_day",CMD_SHARE_AWARD="cmd_share_award",MSG_SHARE_AWARD="msg_share_award",CMD_SUB_TURN_TIMES="cmd_sub_turn_times",MSG_SUB_TURN_TIMES="msg_sub_turn_times",CMD_CHECK_HEART="cmd_check_heart",MSG_CHECK_HEART="msg_check_heart",CMD_BIND_BROCAST="cmd_bind_brocast",MSG_BIND_BROCAST="msg_bind_brocast",HTTP_IFACE_WECHAT_LOGIN="/apiwechatlogin",HTTP_IFACE_GUEST_LOGIN="/apiguestlogin",HTTP_IFACE_API_LOGIN="/apilogin",HTTP_BIND_PHONE="/apibindtele",HTTP_TURN_ACTIVITY="/apiactivity",HTTP_TURN_DO="/apiactivity/doTurn",HTTP_IFACE_GET_RECORD="/apigame/getRecord",HTTP_IFACE_GET_ONE_RECORD="/apigame/getonerecord",HTTP_IFACE_GET_NEWS="/apinews?gameType="+GAME_TYPE,HTTP_IFACE_GET_SCROLL="/apinews/getScroll?gameType="+GAME_TYPE,NetMsg={},NetMsg.msg_check_heart=function(e){e.timestamp&&DataMgr.timeCtrl.setServerTime(e.timestamp)},NetMsg.msg_login_notify_status=function(e){console.log("info = ",e),e.ret&&ModuleMgr.removeWaitMsg()},NetMsg.msg_user_list=function(e){console.log("list = ",e)},NetMsg.msg_close_reason=function(e){LOGIN_D.reason=e.reason},NetMsg.msg_create_user=function(e){console.log("list = ",e)},NetMsg.msg_enter_game=function(e){if(ME_D.me_updated(e),DataMgr.timeCtrl.initData(e.time_map),DataMgr.gameCtrl.deskIdx=e.user.desk_idx,DataMgr.gameCtrl.gameType=e.user.game_type,0!=DataMgr.gameCtrl.deskIdx)null==NetMsg.firstEnterRoom&&(NetMsg.firstEnterRoom=!0),ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:e.user.desk_idx,oncestr:e.user.oncestr});else if(NetMsg.firstEnterRoom=!1,0==cc.sys.isNative&&1!=NetMsg.hasQuery){NetMsg.hasQuery=!0;var t=parseInt(getQueryString("desk")),r=getQueryString("oncestr");t>0&&ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:t,oncestr:r})}},NetMsg.msg_room_oper=function(e,t){"detail_room"==e&&DataMgr.roomCtrl.setRoomList(t.map_list)},NetMsg.msg_create_desk=function(e){ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:e.desk_idx})},NetMsg.msg_enter_room=function(e){},NetMsg.msg_object_updated=function(e,t){if(e==ME_D.get_rid()){t.desk_idx&&(DataMgr.gameCtrl.deskIdx=t.desk_idx);for(var r in t)ME_D.get_user()[r]=t[r];cc.eventManager.dispatchCustomEvent("userChange")}},NetMsg.msg_enter_desk_err=function(e){if(e.ret==-3)return void ModuleMgr.showConfirmTxtMsg(e.err_msg,function(){ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:e.desk_idx})});if(1==NetMsg.firstEnterRoom){var t=parseInt(getQueryString("desk"));t>0&&ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:t})}else ModuleMgr.showConfirmTxtMsg(e.err_msg);DataMgr.gameCtrl.deskIdx=0,NetMsg.firstEnterRoom=!1},NetMsg.msg_enter_desk=function(e){},NetMsg.msg_bind_extend=function(e){if(e.ret==-1&&e.err_msg)return void ModuleMgr.showTipMsg(e.err_msg);ME_D.get_user().extend_uid=e.extend_uid,cc.eventManager.dispatchCustomEvent("SuccessBind");var t="您已成功绑定 \n代理Id:"+e.extend_uid+" 代理名字:"+e.name+"\n前往充值";ModuleMgr.showConfirmTxtMsg(t,function(){cc.sys.isNative?ModuleMgr.runDlg("MallDlg"):ModuleMgr.showConfirmCancelMsg("请下载客户端充值",function(){cc.sys.openURL(getNativeDownUrl())})})},NetMsg.msg_room_message=function(e,t){if(t.ret==-1&&t.err_msg)return ModuleMgr.showTipMsg(t.err_msg),void("show_card"==e&&(DataMgr.gameCtrl.startTime=getTimestamp(),DataMgr.gameCtrl.runFormation()));if("success_enter_desk"==e){DataMgr.gameCtrl.online[t.wheel_idx]=!0;var r=DataMgr.gameCtrl.addPlayer(t);t.info&&t.rid!=ME_D.get_rid()&&(r?ModuleMgr.showTipMsg(t.info.name+"加入游戏"):ModuleMgr.showTipMsg(t.info.name+"重新连接")),cc.eventManager.dispatchCustomEvent("SuccessEnterDesk",r)}else if("success_leave_desk"==e)if(DataMgr.gameCtrl.online[t.wheel_idx]=!1,t.wheel_idx!=DataMgr.gameCtrl.myWheelIdx){var a=DataMgr.gameCtrl.players[t.wheel_idx];0==t.is_playing?(DataMgr.gameCtrl.removePlayer(t.wheel_idx),cc.eventManager.dispatchCustomEvent("SuccessLeaveDesk",!0),a&&a.info&&ModuleMgr.showTipMsg(a.info.name+"离开游戏")):(cc.eventManager.dispatchCustomEvent("SuccessLeaveDesk",!1),a&&a.info&&ModuleMgr.showTipMsg(a.info.name+"掉线了"))}else 0==DataMgr.gameCtrl.isOwer()&&(DataMgr.gameCtrl.deskIdx=0),cc.eventManager.dispatchCustomEvent("SuccessOwnLeaveDesk",!1);else if("desk_info"==e){DataMgr.gameCtrl.deskInfo=t;for(var i={},s=0;s<t.users.length;s++){var n=t.users[s];i[n.rid]=n}t.users=i,DataMgr.gameCtrl.players=[],DataMgr.gameCtrl.deskIdx=t.desk_idx,DataMgr.gameCtrl.roundScore=t.cur_round_score,DataMgr.gameCtrl.curScore=t.cur_score,DataMgr.gameCtrl.online={},DataMgr.gameCtrl.dissovle=[],ZeroMemory(DataMgr.gameCtrl.dissovle,5);for(var o={},s=0;s<t.wheels.length;s++)o[t.wheels[s].rid]=s+1;for(var s=0;s<t.details.length;s++)if(t.details[s].rid){var c={};c.info=t.details[s],c.rid=t.details[s].rid,c.wheel_idx=o[c.rid],DataMgr.gameCtrl.addPlayer(c);var l=t.users[t.details[s].rid];l&&null==l.last_logout_time?DataMgr.gameCtrl.online[l.idx]=!0:DataMgr.gameCtrl.online[s+1]=!1}if(t.desk_dissolve_info)for(var s=0;s<t.desk_dissolve_info.length;s++)1==t.desk_dissolve_info[s].agree&&(DataMgr.gameCtrl.dissovle[s+1]=1);DataMgr.gameCtrl.deskStatus=t.desk_status,DataMgr.gameCtrl.deskTime=t.desk_status_time;for(var s=0;s<t.wheels.length;s++)t.wheels[s].rid==ME_D.get_rid()&&(DataMgr.gameCtrl.myWheelInfo=t.wheels[s]),DataMgr.gameCtrl.wheelInfos[s+1]=t.wheels[s];DataMgr.gameCtrl.myWheelInfo&&1!=IS_TEST_CARD&&(DataMgr.gameCtrl.myCards=DataMgr.gameCtrl.myWheelInfo.poker_list),DataMgr.gameCtrl.sortPlayers(),ModuleMgr.enterGameScene()}else if("success_start_game"==e)cc.eventManager.dispatchCustomEvent("SuccessPreStartGame",t);else if("poker_init"==e)1!=IS_TEST_CARD&&(DataMgr.gameCtrl.myCards=t.poker_list),cc.eventManager.dispatchCustomEvent("SuccessStartGame",t);else if("do_select"==e)DataMgr.gameCtrl.wheelInfos[t.idx].compare_score=t.compare_score,cc.eventManager.dispatchCustomEvent("SuccessRefreshRoomState",t);else if("success_kick_user"==e)t.rid==ME_D.get_user().rid&&(NetMsg.is_kicked=!0);else if("success_user_ready"==e)cc.eventManager.dispatchCustomEvent("SuccessUserReady",t);else if("dissolve_success"==e)DataMgr.gameCtrl.deskIdx=0,cc.eventManager.dispatchCustomEvent("SuccessDissolve",t),ModuleMgr.getDlg("GameDissolve")&&ModuleMgr.getDlg("GameDissolve").close();else if("user_apply_dissolve"==e)DataMgr.gameCtrl.dissovle=[],ZeroMemory(DataMgr.gameCtrl.dissovle,5),DataMgr.gameCtrl.dissovle[t.idx]=1,DataMgr.gameCtrl.deskTime=getTimestamp(),ModuleMgr.runDlg("GameDissolve");else if("user_agree_dissolve"==e)DataMgr.gameCtrl.dissovle[t.idx]=1,cc.eventManager.dispatchCustomEvent("AGREE_DISSOLVE");else if("user_refuse_dissolve"==e){DataMgr.gameCtrl.dissovle[t.idx]=2,cc.eventManager.dispatchCustomEvent("REFUSE_DISSOLVE");var a=DataMgr.gameCtrl.players[t.idx];a&&a.info&&ModuleMgr.showTipMsg(a.info.name+"拒绝解散")}else if("room_create"==e)DataMgr.gameCtrl.deskInfo.cur_round=0,DataMgr.gameCtrl.deskInfo.desk_own_rid=t.desk_own_rid,cc.eventManager.dispatchCustomEvent("SUCCECES_ROOM_CREATE");else if("round_change"==e)DataMgr.gameCtrl.deskInfo&&(DataMgr.gameCtrl.deskInfo.cur_round=t.cur_round,cc.eventManager.dispatchCustomEvent("SuccessRoundChange"));else if("ttw_show_card"==e){var g=DataMgr.gameCtrl.getChairIdByWheelIdx(t.idx),h=DataMgr.gameCtrl.wheelInfos[t.idx];h&&(h.is_show_card=1,h.is_compare_end=1),cc.eventManager.dispatchCustomEvent("SuccessShowCard",g)}else if("ttw_user_score"==e)DataMgr.gameCtrl.roundScore=t.score,DataMgr.gameCtrl.curScore=t.cur_score,DataMgr.gameCtrl.allPockerList=t.all_poker_list;else if("ttw_compare_end"==e)cc.eventManager.dispatchCustomEvent("SuccessCompareEnd",t);else if("new_ttw_record"==e)t.dlgType=2,DataMgr.recordCtrl.showRecordDetail(t);else if("chat"==e){var u=DataMgr.gameCtrl.getChairIdxByRid(t.rid);if(t.txt)return void cc.eventManager.dispatchCustomEvent("SuccessPlayChatTxt",{chair:u,txt:t.txt});if(t.faceId)return void cc.eventManager.dispatchCustomEvent("SuccessPlayChatFace",{chair:u,faceId:t.faceId});if(DataMgr.gameCtrl.deskChat[t.media_id]=u,t.rid==ME_D.get_rid())return;cc.sys.isNative?"html5"!=t.platform&&platform.downRecord(t.media_id):"html5"==t.platform?platform.downRecord(t.media_id):"native"==t.platform&&cc.loader.load(t.media_id,function(e){if(cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",t.media_id),e=cc.loader.getRes(t.media_id),e&&e.cloneNode){e=e.cloneNode(),e.setVolume(1),e.play(),document.addEventListener("WeixinJSBridgeReady",function(){e.play()},!1);var r=setInterval(function(){0==e.getPlaying()&&(cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",t.media_id),window.clearInterval(r))},10)}})}else"step_change"==e&&("show_finish"==t.cur_step?cc.eventManager.dispatchCustomEvent("SuccessCompareCard"):"do_select"==t.cur_step?cc.eventManager.dispatchCustomEvent("SuccessDoSelect"):"compare_end"==t.cur_step||"game_end"==t.cur_step&&cc.eventManager.dispatchCustomEvent("SuccessGameEnd"),DataMgr.gameCtrl.deskInfo.cur_step=t.cur_step)},NetMsg.msg_new_day=function(e){DataMgr.timeCtrl.newData()},NetMsg.msg_share_game=function(e){DataMgr.timeCtrl.addTodayShareTime(1),cc.eventManager.dispatchCustomEvent("SuccessShareGame")},NetMsg.msg_share_award=function(e){ModuleMgr.showTipMsg("领取成功");var t=DataMgr.timeCtrl.getShareStatusList();t[e.idx-1]=1,DataMgr.timeCtrl.setShareStatusList(t),cc.eventManager.dispatchCustomEvent("SuccessShareAward")},NetMsg.msg_sub_turn_times=function(e){DataMgr.timeCtrl.subLeftTurnTimes(1)},NetMsg.msg_common_op=function(e){"receive_native"==e.oper&&(ModuleMgr.showTipMsg("领取成功"),DataMgr.timeCtrl.setReceiveNativeRewards(GAME_TYPE),cc.eventManager.dispatchCustomEvent("success_receive_native_rewards"))},NetMsg.msg_bind_brocast=function(e){ME_D.get_user().brocast_uid=e.brocast_uid},TimeCtrl=cc.Class.extend({timeInfo:null,offSetTime:0,ctor:function(e){console.log(e)},initData:function(e){this.timeInfo=e},getServerTime:function(){return(new Date).getTime()/1e3+offSetTime},setServerTime:function(e){offSetTime=e-(new Date).getTime()/1e3},calcStepTime:function(e){var t=(this.getServerTime(),Math.floor(Math.max(e-this.getServerTime(),0))),r=Math.floor(t/60),a=t%60;return{min:r,sec:a}},newData:function(){this.timeInfo.today_share_times=0,this.timeInfo.left_turn_times=1,this.timeInfo.share_status_list=JSON.stringify([0,0,0])},addTodayShareTime:function(e){this.timeInfo.today_share_times=(this.timeInfo.today_share_times||0)+e},getTodayShareTime:function(){return this.timeInfo.today_share_times||0},getShareStatusList:function(){return this.timeInfo.share_status_list?ConvertToJson(this.timeInfo.share_status_list):[0,0,0]},setShareStatusList:function(e){this.timeInfo.share_status_list=JSON.stringify(e)},getLeftTurnTimes:function(){return this.timeInfo.left_turn_times||0},subLeftTurnTimes:function(e){this.timeInfo.left_turn_times=(this.timeInfo.left_turn_times||0)-e,this.timeInfo.left_turn_times=this.timeInfo.left_turn_times>0?this.timeInfo.left_turn_times:0},getReceiveNativeRewards:function(){return this.timeInfo.receive_native_rewards?ConvertToJson(this.timeInfo.receive_native_rewards):{}},setReceiveNativeRewards:function(e){var t=this.getReceiveNativeRewards();t[e]=1,this.timeInfo.receive_native_rewards=JSON.stringify(t)}}),CT_INVALID=0,CT_SINGLE=1,CT_ONE_DOUBLE=2,CT_FIVE_TWO_DOUBLE=3,CT_THREE=4,CT_FIVE_MIXED_FLUSH_NO_A=5,CT_FIVE_MIXED_FLUSH_FIRST_A=6,CT_FIVE_MIXED_FLUSH_BACK_A=7,CT_FIVE_FLUSH=8,CT_FIVE_THREE_DEOUBLE=9,CT_FIVE_FOUR_ONE=10,CT_FIVE_STRAIGHT_FLUSH_NO_A=11,CT_FIVE_STRAIGHT_FLUSH_FIRST_A=12,CT_FIVE_STRAIGHT_FLUSH_BACK_A=13,CT_FIVE=14,CT_FIVE_MID_THREE_DEOUBLE=100,CT_THIRTEEN_FLUSH=26,CT_THIRTEEN=25,CT_TWELVE_KING=24,CT_THREE_STRAIGHTFLUSH=23,CT_THREE_BOMB=22,CT_ALL_BIG=21,CT_ALL_SMALL=20,CT_SAME_COLOR=19,CT_FOUR_THREESAME=18,CT_FIVEPAIR_THREE=17,CT_SIXPAIR=16,CT_THREE_FLUSH=15,CT_THREE_STRAIGHT=14,LX_ONEPARE=13,LX_TWOPARE=14,LX_THREESAME=15,LX_STRAIGHT=16,LX_FLUSH=17,LX_GOURD=18,LX_FOURSAME=19,LX_STRAIGHTFLUSH=20,LOGIC_MASK_COLOR=240,LOGIC_MASK_VALUE=15,tagAnalyseData=cc.Class.extend({bOneCount:0,bTwoCount:0,bThreeCount:0,bFourCount:0,bFiveCount:0,bOneFirst:null,bTwoFirst:null,bThreeFirst:null,bFourFirst:null,bFiveFirst:null,bStraight:!1,bFlush:!1,ctor:function(){this.bOneFirst=[],this.bTwoFirst=[],this.bThreeFirst=[],this.bFourFirst=[],this.bFiveFirst=[]}}),tagCardForamtion=cc.Class.extend({third_list:null,second_list:null,first_list:null,third_type:0,second_type:0,first_type:0,totaltype:0,ctor:function(){this.third_list=[],this.second_list=[],this.first_list=[]},getListByStep:function(e){return 1==e?this.third_list:2==e?this.second_list:this.first_list},reset:function(){this.third_type=0,this.second_type=0,this.first_type=0,ZeroMemory(this.third_list,this.third_list.length),ZeroMemory(this.second_list,this.second_list.length),ZeroMemory(this.first_list,this.first_list.length)}}),tagAnalyseResult=cc.Class.extend({cbFourCount:0,cbThreeCount:0,cbDoubleCount:0,cbSignedCount:0,cbFourCardData:null,cbThreeCardData:null,cbDoubleCardData:null,cbSignedCardData:null,ctor:function(){this.cbFourCardData=[],this.cbThreeCardData=[],this.cbDoubleCardData=[],this.cbSignedCardData=[]}}),tagAnalyseType=cc.Class.extend({bOnePare:0,bTwoPare:0,bThreeSame:0,bStraight:0,bFlush:0,bFourSame:0,bStraightFlush:0,cbOnePare:[],cbTwoPare:[],cbThreeSame:[],cbStraight:[],cbFlush:[],cbGourd:[],cbFourSame:[],cbStraightFlush:[],cbFiveSame:[],bbOnePare:[],bbTwoPare:[],bbThreeSame:[],bbStraight:[],bbFlush:[],bbGourd:[],bbFourSame:[],bbStraightFlush:[],btOnePare:0,btThreeSame:0,btTwoPare:0,btStraight:0,btFlush:0,btGourd:0,btFourSame:0,btStraightFlush:0,btFiveSame:0,ctor:function(){this.cbOnePare=[],this.cbTwoPare=[],this.cbThreeSame=[],this.cbStraight=[],this.cbFlush=[],this.cbGourd=[],this.cbFourSame=[],this.cbStraightFlush=[],this.cbFiveSame=[],this.bbOnePare=[],this.bbTwoPare=[],this.bbThreeSame=[],this.bbStraight=[],this.bbFlush=[],this.bbGourd=[],this.bbFourSame=[],this.bbStraightFlush=[]}}),enDescend=1,enAscend=2,enColor=3,CopyMemory=function(e,t,r,a,i){void 0==a&&(a=0),void 0==i&&(i=0);for(var s=0;s<r;s++)e[s+a]=t[s+i]},rand=function(){return parseInt(100*Math.random())},sizeof=function(e){return e.length},ZeroMemory=function(e,t){memset(e,0,t)},memset=function(e,t,r){for(var a=0;a<r;a++)e[a]=t},ALL_CARDS=[1,2,3,4,5,6,7,8,9,10,11,12,13,17,18,19,20,21,22,23,24,25,26,27,28,29,33,34,35,36,37,38,39,40,41,42,43,44,45,49,50,51,52,53,54,55,56,57,58,59,60,61,78,79],GameCtrl=cc.Class.extend({myCards:null,gameData:null,deskInfo:{},players:null,desk_idx:0,game_type:"",deskPlayers:null,dissovle:null,myWheelIdx:0,wheelInfos:{},myWheelInfo:null,roundScore:null,allPockerList:null,curScore:null,deskChat:null,onlineWheelIdx:null,clearData:function(){this.myCards=[],this.deskChat={},this.gameData=null,this.deskInfo={},this.players=[],this.desk_idx=0,this.game_type="",this.deskPlayers=null,this.dissovle=[],this.myWheelIdx=0,this.wheelInfos={},this.myWheelInfo=null,this.online={},this.randMyCard()},saveSceenOrientation:function(e){SCREEN_CUR_ORIENTATION=e,cc.sys.localStorage.setItem(GAME_TYPE+"sceen_orientation",e)},getSceenOrientation:function(){return cc.sys.localStorage.getItem(GAME_TYPE+"sceen_orientation")||SCREEN_ORIENTATION_PROTRAIT},getPokerName:function(e){var t="";if(78==e)return"小王";if(79==e)return"大王";var r=e&LOGIC_MASK_COLOR;0==r?t="方块":16==r?t="梅花":32==r?t="红桃":48==r&&(t="黑桃");var a=e&LOGIC_MASK_VALUE;return t+=13==a?"K":12==a?"Q":11==a?"J":1==a?"A":a},getMaRatio:function(e,t){var r=e&LOGIC_MASK_COLOR;return 1==t&&48==r?"双码":(2!=t||48!=r&&32!=r)&&(3!=t||48!=r&&32!=r&&16!=r)?"单码":"双码"},runFormation:function(){this.isFormationHandle()?ModuleMgr.runOrientationDlg("GameCardFormationHandle"):ModuleMgr.runOrientationDlg("GameCardFormation")},isFormationHandle:function(){var e=cc.sys.localStorage.getItem("handle");return 1==e},setFormationHandle:function(e){cc.sys.localStorage.setItem("handle",e)},randMyCard:function(){var e=[50,19,5,37,54,55,24,25,58,11,28,29,79];IS_TEST_CARD=0,1==IS_TEST_CARD&&(FORMATION_TIME=3e3),CopyMemory(this.myCards,e,13)},ctor:function(){
this.clearData(),this.randMyCard()},getRoomCardCost:function(e){var t=0;if(GAME_TYPE==GAME_TYPE_XX||GAME_TYPE==GAME_TYPE_WZ||GAME_TYPE==GAME_TYPE_DD||GAME_TYPE==GAME_TYPE_DZ||GAME_TYPE==GAME_TYPE_DZ2||GAME_TYPE==GAME_TYPE_QL||GAME_TYPE==GAME_TYPE_FF){var r=e.crazyLv||0,a=e.hasJoker||0,i=e.round,s=e.curColor||0,n={1:1,5:15,10:20,20:50},o={1:1,5:15,10:25,20:50},c={1:1,5:3,10:3,20:6},l=[{1:0,5:0,10:0,20:0},{1:0,5:5,10:7,20:14},{1:0,5:10,10:15,20:30},{1:0,5:15,10:25,20:50}];t=n[i]||0,2==r&&(t=t+o[i]||0),1==a&&(t=t+c[i]||0);var g=l[s];return g&&(t=t+g[i]||0),t}if(GAME_TYPE==GAME_TYPE_Q8){var r=e.crazyLv||0,a=e.hasJoker||0,i=e.round,s=e.curColor||0,n={1:1,5:16,10:32,20:64},o={1:1,5:0,10:0,20:0},c={1:1,5:0,10:0,20:0},l=[{1:0,5:0,10:0,20:0},{1:0,5:4,10:8,20:16},{1:0,5:8,10:16,20:32},{1:0,5:12,10:24,20:48}];t=n[i]||0,2==r&&(t=t+o[i]||0),1==a&&(t=t+c[i]||0);var g=l[s];return g&&(t=t+g[i]||0),t}for(var i=e.round,h=0;h<ROOM_CARD_COST.length;h++)if(ROOM_CARD_COST[h].round==i){t=ROOM_CARD_COST[h].cost+e.curColor;break}return t},randCard:function(e,t){var r=new Array(ALL_CARDS.length);CopyMemory(r,ALL_CARDS,ALL_CARDS.length);var a=0,i=0;do i=rand()%(t-a),e[a++]=r[i],r[i]=r[t-a];while(a<t)},removePlayer:function(e){var t=DataMgr.gameCtrl.players[e];if(t){var r=this.getChairIdxByRid(t.rid);DataMgr.gameCtrl.deskPlayers[r]=null}DataMgr.gameCtrl.players[e]=null},isOwer:function(){return DataMgr.gameCtrl.deskInfo.desk_own_rid==ME_D.get_rid()},addPlayer:function(e){var t=DataMgr.gameCtrl.players[e.wheel_idx];return DataMgr.gameCtrl.players[e.wheel_idx]=e,null==t},getChairIdxByRid:function(e){if(null==this.deskPlayers)return-1;for(var t=1;t<=MAX_ROLE_NUM;t++)if(this.deskPlayers[t]&&this.deskPlayers[t].rid==e)return t;return-1},getAreaName:function(e){return 1==e?GAME_AREA_NAME_1:GAME_AREA_NAME_2},getIsSpecialName:function(e){return 0==e?"无特殊牌型":"特殊牌型"},getJoke:function(e){return 1==e?"有鬼":"无鬼"},getRedFive:function(e,t){return e>0?this.getPokerName(e)+this.getMaRatio(e,t):"不买马"},getAutoPoker:function(e){return 1==e?"超时出牌":""},getCrazyName:function(e){return e>1?"疯狂场":"普通场"},getWinName:function(e){return 0==e?"房主扣":1==e?"赢者扣":2==e?"平摊":""},getMasterName:function(e){return 0==e?"不坐庄":"坐庄"},getColor:function(e){var t="";return t=0==e?"不加色":"加"+e+"色",t=1==DataMgr.gameCtrl.deskInfo.has_more_color?" 5人"+t:2==DataMgr.gameCtrl.deskInfo.has_more_color?" 6人"+t:3==DataMgr.gameCtrl.deskInfo.has_more_color?" 7人"+t:" 4人"+t},getPlayerByRid:function(e){for(var t=1;t<=MAX_ROLE_NUM;t++)if(this.deskPlayers[t]&&this.deskPlayers[t].rid==e)return this.deskPlayers[t];return null},checkSpeicalCard:function(e,t,r,a){var i=this,s=function(){i.onSendSpecialCard(t,e),a&&a.call()},n=function(){r&&r.call()},o=DataMgr.gameCtrl.getSpecialName(e),c=getTimestamp()-DataMgr.gameCtrl.startTime;ModuleMgr.showConfirmCancelMsg("是否按特殊牌型["+o+"]出牌?\n（取消后点左下角可再报道）",s,n,FORMATION_TIME-c)},onSendSpecialCard:function(e,t){var r=[],a=[],i=[];if(t==CT_THREE_FLUSH)CopyMemory(r,e,3,0,10),CopyMemory(a,e,5,0,5),CopyMemory(i,e,5,0,0);else if(t==CT_THREE_STRAIGHT||t==CT_THREE_STRAIGHTFLUSH){CopyMemory(r,e,3,0,10),CopyMemory(a,e,5,0,5),CopyMemory(i,e,5,0,0);var s=DataMgr.gameCtrl.GetCardType5(a),n=DataMgr.gameCtrl.GetCardType5(i);r=DataMgr.gameCtrl.SortForamtion(r),a=DataMgr.gameCtrl.SortForamtion(a),i=DataMgr.gameCtrl.SortForamtion(i),DataMgr.gameCtrl.SortFormationA(i,n),DataMgr.gameCtrl.SortFormationA(a,s),DataMgr.gameCtrl.SortFormation3A(r),r.reverse(),a.reverse(),i.reverse()}else{var o=[];CopyMemory(o,DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length),DataMgr.gameCtrl.SortCardList(o,o.length,enAscend),CopyMemory(r,o,3,0,0),CopyMemory(a,o,5,0,3),CopyMemory(i,o,5,0,8)}var c={};c.spec_type=t,c.first_list=r,c.second_list=a,c.third_list=i,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"show_card",poker:c}),DataMgr.gameCtrl.viewCards=c},getChairIdByWheelIdx:function(e){return null==this.players[e]?-1:this.getChairIdxByRid(this.players[e].rid)},getPlayerNum:function(){for(var e=0,t=1;t<=DataMgr.gameCtrl.players.length;t++)DataMgr.gameCtrl.players[t]&&e++;return e},sortPlayers:function(){this.deskPlayers=new Array(MAX_ROLE_NUM);for(var e=[],t=null,r=1;r<=this.players.length;r++)this.players[r]&&this.players[r].rid==ME_D.get_rid()?t=this.players[r]:e.push(this.players[r]);this.deskPlayers[MAX_ROLE_NUM]=t,t&&(this.myWheelIdx=t.wheel_idx);for(var r=1;r<=MAX_ROLE_NUM-1;r++)this.deskPlayers[r]=e[r-1]},getSpecialName:function(e){var t="";switch(e){case CT_THIRTEEN_FLUSH:t="同花十三水";break;case CT_THIRTEEN:t="十三水";break;case CT_TWELVE_KING:t="十二皇族";break;case CT_THREE_STRAIGHTFLUSH:t="三同花顺";break;case CT_THREE_BOMB:t="三炸弹";break;case CT_ALL_BIG:t="全大";break;case CT_ALL_SMALL:t="全小";break;case CT_SAME_COLOR:t="凑一色";break;case CT_FOUR_THREESAME:t="四套冲三";break;case CT_FIVEPAIR_THREE:t="五对冲三";break;case CT_SIXPAIR:t="六对半";break;case CT_THREE_FLUSH:t="三同花";break;case CT_THREE_STRAIGHT:t="三顺子"}return t},getFormationType:function(e,t){var r="";switch(e){case CT_SINGLE:r=1;break;case CT_ONE_DOUBLE:r=2;break;case CT_FIVE_TWO_DOUBLE:r=3;break;case CT_THREE:r=1==t?11:4;break;case CT_FIVE_MIXED_FLUSH_NO_A:r=5;break;case CT_FIVE_MIXED_FLUSH_FIRST_A:r=5;break;case CT_FIVE_MIXED_FLUSH_BACK_A:r=5;break;case CT_FIVE_FLUSH:r=6;break;case CT_FIVE_THREE_DEOUBLE:r=2==t?22:7;break;case CT_FIVE_FOUR_ONE:r=8;break;case CT_FIVE_STRAIGHT_FLUSH_NO_A:r=9;break;case CT_FIVE_STRAIGHT_FLUSH_FIRST_A:r=9;break;case CT_FIVE_STRAIGHT_FLUSH_BACK_A:r=9;break;case CT_FIVE:r=10}return r},getTypeImage:function(e,t){var r=this.getFormationType(e,t);return r<10?"game/poker_type0"+r+".png":"game/poker_type"+r+".png"}}),gCalScoreTest=function(){for(var e=0;e<1e6;e++){for(var t=1+Math.ceil(5*Math.random()),r=[],a=0,i=0;i<t;i++){var s=-1e3+Math.ceil(2e3*Math.random());a+=s,r.push({id:i,score:s})}r.push({id:r.length,score:-a}),console.log(r);for(var n=gCalScore(r),a=0,i=0;i<r.length;i++)r[i].score>0&&(a+=r[i].score);for(var i=0;i<n.length;i++)a-=n[i].score;if(console.log(n),0!=a){console.log("ERROR===============");break}console.log("SUCCESE==============="+e)}},AccountCtrl=cc.Class.extend({isGuest:!1,lastAccount:null,lastPass:null,wechatAccount:null,wechatPass:null,lastLoginTime:null,guestAccount:null,guestPsw:null,apiUid:null,apiSign:null,apiServer:null,timestamp:0,enterGameInfo:null,bolLogOut:!1,deskInfo:{},ctor:function(){this.lastAccount=cc.sys.localStorage.getItem("last_account")||"",this.lastPass=cc.sys.localStorage.getItem("last_pass")||"",this.wechatAccount=cc.sys.localStorage.getItem("wechat_account")||"",this.wechatPass=cc.sys.localStorage.getItem("wechat_pass")||"",this.lastLoginTime=cc.sys.localStorage.getItem("last_login_time")||0,this.guestAccount=cc.sys.localStorage.getItem("guest_account")||"",this.guestPsw=cc.sys.localStorage.getItem("guest_pass")||""},setEnterGameInfo:function(e){this.enterGameInfo=gDeepDup(e)},bolFromHall:function(){return!!this.enterGameInfo},setDeskInfo:function(e){if(e){var t=e.gameType||"",r=e.deskIdx||0;r<=0?this.deskInfo.gameType==t&&(this.deskInfo.deskIdx=r):(this.deskInfo.gameType=t,this.deskInfo.deskIdx=r)}},saveAccount:function(){cc.sys.localStorage.setItem("last_account",this.lastAccount||""),cc.sys.localStorage.setItem("last_pass",this.lastPass||""),cc.sys.localStorage.setItem("wechat_account",this.wechatAccount||""),cc.sys.localStorage.setItem("wechat_pass",this.wechatPass||""),cc.sys.localStorage.setItem("last_login_time",this.lastLoginTime||""),cc.sys.localStorage.setItem("guest_account",this.guestAccount||""),cc.sys.localStorage.setItem("guest_pass",this.guestPsw||"")},clearAccount:function(){this.isGuest?(this.guestAccount="",this.guestPsw=""):(this.wechatAccount="",this.wechatPass=""),this.saveAccount()},getCurServer:function(){return this.apiServer},apiWechatLogin:function(e,t,r){var a="";GAME_TYPE==GAME_TYPE_XX?a="wx61ec7eb2e0716576":GAME_TYPE==GAME_TYPE_DD?a="wxa3ec09c4575c9c4a":GAME_TYPE==GAME_TYPE_Q8?a="wx28422891fefe6838":GAME_TYPE==GAME_TYPE_DZ?a="wx04ad67dd882e53c4":GAME_TYPE==GAME_TYPE_QL?a="wx6102b60ec7438206":GAME_TYPE==GAME_TYPE_LS&&(a="wx31cdc00a2969f117"),isHall&&(a="wx1a580094a69c3721");var i={channel:"wechat",code:t,id:a,isOpen:e};i.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_WECHAT_LOGIN,i,function(e){r(e)},"登录验证中")},apiGuestLogin:function(e){var t={channel:"ywt"};t.ignorePort=!0,requestWaiting4Http(HTTP_IFACE_GUEST_LOGIN,t,function(t){e(t)},"登录验证中")},apilogin:function(e,t,r){var a={method:"POST",timeout:5e3,url:GAME_WEB_URL+"/apilogin",data:JSON.stringify({channel:"ywt",user:e,password:t})},i=this;HttpNetworkRequest(a,function(a,s){if(ModuleMgr.removeWaitMsg(),a)return void ModuleMgr.showTipMsg(a);var n=ConvertToJson(s);if(0!=n.ret)r(n.error,n),i.clearAccount();else{i.lastAccount=e,i.lastPass=t,i.saveAccount();var o=ConvertToJson(n.baseinfo);i.nickname=o.nickname,i.headimgurl=o.headimgurl,i.wechat=n.wechat,i.telephone=n.telephone,i.bindTeleTime=n.bindTeleTime,i.timestamp=n.timestamp,i.apiUid=n.uid,i.apiSign=n.sign,i.apiServer=n.server,r(null,n)}})}}),RecordCtrl=cc.Class.extend({scrollNoticeList:null,ctor:function(e){console.log(e)},getRecord:function(e){var t={};t.rid=ME_D.get_rid(),t.sign=DataMgr.accountCtrl.apiSign,t.timestamp=DataMgr.accountCtrl.timestamp,t.user=DataMgr.accountCtrl.lastAccount,t.uid=DataMgr.accountCtrl.apiUid,t.game_type=GAME_TYPE,requestWaiting4Http(HTTP_IFACE_GET_RECORD,t,function(t){e(t)},"请求战绩中")},getOneRecord:function(e,t){var r={};r.rid=e,r.game_type=GAME_TYPE,requestWaiting4Http(HTTP_IFACE_GET_ONE_RECORD,r,function(e){t(e)},"请求战绩中")},getOwnerInfo:function(e){var t=e.desk_own_rid,r=ConvertToJson(e.record_detail),a=r.users;if(a)for(var i=0;i<a.length;i++){var s=a[i];if(s.rid==t)return s}return null},showRecordDetail:function(e){if(e){var t={};t.deskId=e.desk_no,null==t.deskId&&(t.deskId=DataMgr.gameCtrl.deskIdx),t.round=e.full_round,t.creatTime=e.create_time;var r=this.getOwnerInfo(e);r&&(t.ownerName=r.name),t.ownerRid=e.desk_own_rid,t.dlgType=e.dlgType||1,t.recordId=e.rid,t.crazyLv=e.crazy_lv,t.players=[];for(var a=ConvertToJson(e.record_detail),i=a.score,s=a.users||[],n=0;n<s.length;n++){var o=n+1,c=s[n];if(c.rid){var l={headUrl:c.headimgurl,score:i["idx"+o],name:c.name,rid:c.rid,account_uid:c.account_uid};t.players.push(l)}}ModuleMgr.runOrientationDlg("RecordDetail",t,null,null)}},getNews:function(e){var t=this,r=function(r){var a={};requestWaiting4Http(HTTP_IFACE_GET_NEWS+"&area="+encodeURIComponent(r),a,function(a){e(t.parseDataList(a,r))},"请求新闻中","GET")};DataMgr.getCityCallback(r)},parseDataList:function(e,t){for(var r=[],a=[],i=0;i<e.list.length;i++)"common"==e.list[i].area?r.push(e.list[i]):e.list[i].area==t&&a.push(e.list[i]);return 0==a.length?e.list=r:e.list=a,e},getScrollNotice:function(e){var t={},r=this;if(this.scrollNoticeList&&this.scrollNoticeList.length>0)e(r.scrollNoticeList);else{var a=function(a){request4Http(HTTP_IFACE_GET_SCROLL+"&area="+encodeURIComponent(a),t,function(t){r.scrollNoticeList=r.parseDataList(t,a).list,e(r.scrollNoticeList)},"GET")};DataMgr.getCityCallback(a)}}}),ActivityCtrl=cc.Class.extend({ctor:function(e){console.log(e)},getBindPhone:function(e,t,r){var a={};a.rid=ME_D.get_rid(),a.sign=DataMgr.accountCtrl.apiSign,a.timestamp=DataMgr.accountCtrl.timestamp,a.user=DataMgr.accountCtrl.lastAccount,a.uid=DataMgr.accountCtrl.apiUid,a.wechat=t,a.telephone=e,requestWaiting4Http(HTTP_BIND_PHONE,a,function(e){r(e)},"修改中")},getTurnActivity:function(e){if(this.turnData)return void e(this.turnData);var t=this,r={};requestWaiting4Http(HTTP_TURN_ACTIVITY,r,function(r){t.turnData=r.result,e(this.turnData)},"请求数据中")},doTurn:function(e){var t={};t.rid=ME_D.get_rid(),t.sign=DataMgr.accountCtrl.apiSign,t.timestamp=DataMgr.accountCtrl.timestamp,t.user=DataMgr.accountCtrl.lastAccount,t.uid=DataMgr.accountCtrl.apiUid,requestWaiting4Http(HTTP_TURN_DO,t,function(t){e(t.getItem)},"")}}),Platform=cc.Class.extend({curPlatform:null,weixinTimeOut:1728e3,ctor:function(){1==cc.sys.isNative?cc.sys.os==cc.sys.OS_ANDROID?this.curPlatform=new AndroidPlatform:cc.sys.os==cc.sys.OS_IOS?this.curPlatform=new IosPlatform:this.curPlatform=new BasePlatform:this.curPlatform=new Html5Platform},login:function(){return getTimestamp()-DataMgr.accountCtrl.lastLoginTime<platform.weixinTimeOut?void this.doWechatLogin():(ModuleMgr.showWaitMsg("微信授权中",0),this.curPlatform.login())},loginCallback:function(e){return this.curPlatform.loginCallback(e)},pay:function(e,t,r){return this.curPlatform.pay(e,t,r)},isInstalled:function(){return this.curPlatform.isInstalled()},share:function(e,t,r,a,i){return this.curPlatform.share(e,t,r,a,i)},shareImage:function(e,t){return this.curPlatform.shareImage(e,t)},doWechatLogin:function(){return this.curPlatform.doWechatLogin()},init:function(){return this.curPlatform.init()},startRecord:function(){return this.curPlatform.startRecord()},stopRecord:function(){return this.curPlatform.stopRecord()},downRecord:function(e){return this.curPlatform.downRecord(e)},enterHall:function(){return this.curPlatform.enterHall()}}),BasePlatform=cc.Class.extend({isInstalled:function(){return!1},login:function(){},loginCallback:function(e){},init:function(){},shareImage:function(e,t){},share:function(e,t,r){},pay:function(e,t){},startRecord:function(){},stopRecord:function(){},downRecord:function(){},doWechatLogin:function(){DataMgr.accountCtrl.isGuest=!1,DataMgr.accountCtrl.apilogin(DataMgr.accountCtrl.wechatAccount,DataMgr.accountCtrl.wechatPass,function(e,t){e?(ModuleMgr.showTipMsg(e),DataMgr.accountCtrl.lastLoginTime=0,DataMgr.accountCtrl.saveAccount()):(DataMgr.accountCtrl.lastLoginTime=getTimestamp(),DataMgr.accountCtrl.saveAccount(),cc.log(DataMgr.accountCtrl.nickname),cc.log(DataMgr.accountCtrl.headimgurl),cc.log("fuck"),LOGIN_D.login(null,null))})},enterHall:function(){}}),IosPlatform=BasePlatform.extend({isInstalled:function(){return jsb.reflection.callStaticMethod("AppController","isWXInstalled")},login:function(){return jsb.reflection.callStaticMethod("AppController","login")},shareImage:function(e,t){return jsb.reflection.callStaticMethod("AppController","shareImg:type:",e,t)},loginCallback:function(e){var t=this,r=function(e){DataMgr.accountCtrl.wechatAccount=e.user,DataMgr.accountCtrl.wechatPass=e.password,t.doWechatLogin()};DataMgr.accountCtrl.apiWechatLogin(1,e,r)},share:function(e,t,r,a){return jsb.reflection.callStaticMethod("AppController","share:andContent:andLink:type:",e,t,r,a)},startRecord:function(){return jsb.reflection.callStaticMethod("AppController","startRecord:rid:",DOWN_RECORD_SERVER+"/apiupload",ME_D.get_rid())},stopRecord:function(){return jsb.reflection.callStaticMethod("AppController","stopRecord")},downRecord:function(e){return jsb.reflection.callStaticMethod("AppController","downRecord:",e)},pay:function(e,t,r){return jsb.reflection.callStaticMethod("AppController","pay:type:data:",e,t,r)},enterHall:function(){jsb.UpdateZipMgr.Instance().enterHall()}}),AndroidPlatform=BasePlatform.extend({isInstalled:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","isWXInstalled","()Z")},login:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","login","()V")},share:function(e,t,r,a,i){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","share","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;I)V",e,t,r,a)},startRecord:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","startRecord","(Ljava/lang/String;Ljava/lang/String;)V",DOWN_RECORD_SERVER+"/apiupload",ME_D.get_rid())},downRecord:function(e){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","downRecord","(Ljava/lang/String;)V",e)},stopRecord:function(){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","stopRecord","()V")},pay:function(e,t,r){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","pay","(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V",""+e,""+t,""+r)},loginCallback:function(e){var t=this,r=function(e){DataMgr.accountCtrl.wechatAccount=e.user,DataMgr.accountCtrl.wechatPass=e.password,t.doWechatLogin()};DataMgr.accountCtrl.apiWechatLogin(1,e,r)},shareImage:function(e,t){return jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity","shareImg","(Ljava/lang/String;I)V",e,t)},enterHall:function(){jsb.UpdateZipMgr.Instance().enterHall()}}),Html5Platform=BasePlatform.extend({isInstalled:function(){return!0},login:function(){var e="",t="";GAME_TYPE==GAME_TYPE_GP?(e="wx7e64ae1f617edec1",t="http://www.gongpaa.com"):GAME_TYPE==GAME_TYPE_DD?(e="wxc86b190ff7525769",t="http://ywt.gongpaa.com"):GAME_TYPE==GAME_TYPE_LS?(e="wx0b0eccebbec72a79",t="http://ywt.gongpaa.com"):GAME_TYPE==GAME_TYPE_QL?(e="wxb2ff48b9a336d2d9",t="http://ywt2.gongpaa.com"):GAME_TYPE==GAME_TYPE_Q8?(e="wxea0629066ce2dc89",t="http://ywt2.gongpaa.com"):GAME_TYPE==GAME_TYPE_DZ?(e="wx7b0bcf06922fe9b6",t="http://ywt2.gongpaa.com"):GAME_TYPE==GAME_TYPE_DZ2?(e="wxbe06674deb64d426",t="http://ywt2.gongpaa.com"):(e="wx4e36ccf533d95b62",t="http://ywt.gongpaa.com");var r=getQueryString("brocast_uid")||"",a=getQueryString("extend_uid")||"",i=getQueryString("desk")||0,s=getQueryString("test")||0,n=getQueryString("game_type")||0;cc.sys.openURL("https://open.weixin.qq.com/connect/oauth2/authorize?appid="+e+"&redirect_uri="+encodeURIComponent(t+"/apipubliclogin/dowechat?desk="+i+"&test="+s+"&game_type="+n+"&id="+e+"&brocast_uid="+r+"&extend_uid="+a)+"%26real_redirect%3d"+encodeURIComponent(SHARE_URL+"ttw")+"%26real_wechat%3d"+encodeURIComponent(SHARE_URL+"apipubliclogin")+"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect")},init:function(){var e=this;"undefined"!=typeof wx&&wx.onVoiceRecordEnd({complete:function(t){e.uploadVoice(t.localId)}})},share:function(e,t,r,a,i){null!=wx&&(null==i&&0==cc.sys.isNative&&(i=SHARE_URL+"ttw/res/icon/icon3.png"),wx.ready(function(){wx.onMenuShareAppMessage({title:e,desc:t,link:r,imgUrl:i,success:function(){sdk_share_callback(1),cc.eventManager.dispatchCustomEvent("SuccessShareReturn",0)},cancel:function(){cc.eventManager.dispatchCustomEvent("SuccessShareReturn",-1)}}),wx.onMenuShareTimeline({title:t,link:r,imgUrl:i,success:function(){sdk_share_callback(1),cc.eventManager.dispatchCustomEvent("SuccessShareReturn",0)},cancel:function(){cc.eventManager.dispatchCustomEvent("SuccessShareReturn",-1)}}),3!=a&&ModuleMgr.runDlg("WxShareDlg",{type:a},null,null)}))},startRecord:function(){wx.startRecord({success:function(){},cancel:function(){ModuleMgr.showTipMsg("你取消了录音")}})},stopRecord:function(){var e=this;wx.stopRecord({success:function(t){e.uploadVoice(t.localId)},fail:function(e){ModuleMgr.showTipMsg(JSON.stringify(e))}})},downToMyServer:function(e){var t={method:"POST",timeout:2e4,url:DOWN_RECORD_SERVER+"/apiupload/newWechatMedia",data:JSON.stringify({rid:ME_D.get_rid(),mediaId:e})};HttpNetworkRequest(t,function(e,t){if(e)return void ModuleMgr.showTipMsg(e);var r=ConvertToJson(t);ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:DOWN_RECORD_SERVER+"/apidown?file="+r.name,platform:"html5_native"})})},uploadVoice:function(e){var t=this;wx.uploadVoice({localId:e,isShowProgressTips:0,success:function(e){platform.isUploadRecord=!1,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:e.serverId,platform:"html5"}),t.downToMyServer(e.serverId)}})},downRecord:function(e){wx.onVoicePlayEnd({success:function(t){t.localId;cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",e)}}),wx.downloadVoice({serverId:e,isShowProgressTips:0,success:function(t){cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",e),wx.playVoice(t)}})},enterHall:function(){cc.sys.openURL("../")}}),sdk_login_callback=function(e){platform.retCode=e},sdk_record_end_play_callback=function(e){platform.retRecordEndPlay=e},sdk_record_start_play_callback=function(e){platform.retRecordStartPlay=e},sdk_record_uploaded_callback=function(e){platform.retRecordUploaded=e,platform.isUploadRecord=!1},sdk_record_uploaded_json_callback=function(e){var t=ConvertToJson(e);sdk_record_uploaded_callback(t.name)},sdk_record_ipa_pay_callback=function(e){var t=GAME_WEB_PORT;GAME_TYPE==GAME_TYPE_GP&&(t=":1338");var r={method:"POST",timeout:5e3,url:GAME_WEB_URL+t+"/ApiApplyPay",data:JSON.stringify({receipt:e,uid:ME_D.get_user().account_uid})};HttpNetworkRequest(r,function(e,t){})},sdk_share_callback=function(e){ME_D.send_message_waiting(CMD_SHARE_GAME,{})},sdk_login_err_callback=function(){ModuleMgr.removeWaitMsg()},platform=new Platform,platform.init(),doMainShare=function(){platform.share("开房间玩"+GAME_NAME,"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~",getShareUrl(0,0),3)},getShareInfo=function(e){var t=DataMgr.gameCtrl.getCrazyName(DataMgr.gameCtrl.deskInfo.crazy_lv),r=(DataMgr.gameCtrl.getAreaName(DataMgr.gameCtrl.deskInfo.area),DataMgr.gameCtrl.getJoke(DataMgr.gameCtrl.deskInfo.has_joker)),a=DataMgr.gameCtrl.getColor(DataMgr.gameCtrl.deskInfo.has_more_color),i=DataMgr.gameCtrl.getMasterName(DataMgr.gameCtrl.deskInfo.is_master_mode),s=DataMgr.gameCtrl.getRedFive(DataMgr.gameCtrl.deskInfo.check_maker_poker,DataMgr.gameCtrl.deskInfo.has_more_color),n=DataMgr.gameCtrl.getWinName(DataMgr.gameCtrl.deskInfo.is_win_cost_mode);return" "+GAME_NAME+" "+i+", "+t+", "+s+", "+r+", "+n+", "+a+", "+DataMgr.gameCtrl.deskInfo.full_round+"局  点击直接进入房间"},doGameShare=function(){var e=DataMgr.gameCtrl.getMasterName(DataMgr.gameCtrl.deskInfo.is_master_mode),t=DataMgr.gameCtrl.getWinName(DataMgr.gameCtrl.deskInfo.is_win_cost_mode);platform.share("房号:"+DataMgr.gameCtrl.deskIdx+" 模式:"+e+" 房费:"+t,getShareInfo(),getShareUrl(DataMgr.gameCtrl.deskIdx,0)+"&oncestr="+DataMgr.gameCtrl.deskInfo.oncestr,3,SHARE_URL+"ttw/res/icon/invite3.png")},"undefined"==typeof DataMgr&&(DataMgr={}),DataMgr.accountCtrl||(DataMgr.accountCtrl=new AccountCtrl),DataMgr.gameCtrl=new GameCtrl,DataMgr.timeCtrl=new TimeCtrl,DataMgr.recordCtrl=new RecordCtrl,DataMgr.activityCtrl=new ActivityCtrl;var remote_ip_info=remote_ip_info||{city:""};DataMgr.clearData=function(){this.accountCtrl.clearData(),this.gameCtrl.clearData()},DataMgr.getCityCallback=function(e){if(cc.sys.isNative){if(DataMgr.curCity)return void e(DataMgr.curCity);var t={method:"GET",timeout:5e3,url:"http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json",data:JSON.stringify({})};HttpNetworkRequest(t,function(t,r){var a=ConvertToJson(r);DataMgr.curCity=a.city,e(a.city)})}else e(remote_ip_info.city)},DataMgr.registerReplacePathMap=function(){GAME_TYPE==GAME_TYPE_XX?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/xinxin/logo_1.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/xinxin/zuanshi.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/xinxin/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/xinxin/poker_backview_xinxin.png"),RegisterReplacePathMap("res/uires/activity/btn_xiaziajianli.png","res/uires/xinxin/btn_xiaziajianli.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_WZ?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/wanzhe/logo_1.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/wanzhe/zuanshi.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/wanzhe/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/wanzhe/poker_backview_xinxin.png"),RegisterReplacePathMap("res/uires/activity/btn_xiaziajianli.png","res/uires/wanzhe/btn_xiaziajianli.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_LS?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/luosong/logo_1.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/luosong/zuanshi.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/luosong/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/luosong/poker_backview_xinxin.png"),RegisterReplacePathMap("res/uires/activity/btn_xiaziajianli.png","res/uires/luosong/btn_xiaziajianli.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/ls.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_ls/wf_1.png"),GetRealPath("res/uires/wanfa_ls/wf_2.png"),GetRealPath("res/uires/wanfa_ls/wf_3.png"),GetRealPath("res/uires/wanfa_ls/wf_4.png")]):GAME_TYPE==GAME_TYPE_DD?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/dingding/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/dingding/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/dingding/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/dingding/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_DZ?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/douzhen/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/douzhen/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/douzhen/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/douzhen/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),RegisterReplacePathMap("res/uires/login/hall_bg .jpg","res/uires/login/hall_bg_2.jpg"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_DZ2?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/douzhen2/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/douzhen2/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/douzhen2/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/douzhen2/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_QL?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/qilin/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/qilin/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/qilin/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/qilin/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_Q8?(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/q8/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/q8/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/q8/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/q8/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),RegisterReplacePathMap("res/uires/login/hall_bg .jpg","res/uires/login/hall_bg_3.jpg"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")]):GAME_TYPE==GAME_TYPE_FF&&(RegisterReplacePathMap("res/uires/login/logo.png","res/uires/ff/logo_1.png"),RegisterReplacePathMap("res/uires/game/logo_fangjian.png","res/uires/ff/logo_2.png"),RegisterReplacePathMap("res/uires/game/poker_backview.png","res/uires/ff/poker_backview.png"),RegisterReplacePathMap("res/uires/main/fangka.png","res/uires/ff/zuanshi.png"),RegisterReplacePathMap("res/uires/wanfa/gp.png","res/uires/wanfa/xx.png"),HELP_IMG_CFG=[GetRealPath("res/uires/wanfa_xx/wf_1.png"),GetRealPath("res/uires/wanfa_xx/wf_2.png"),GetRealPath("res/uires/wanfa_xx/wf_3.png"),GetRealPath("res/uires/wanfa_xx/wf_4.png")])},DataMgr.registerModule=function(){GAME_TYPE==GAME_TYPE_XX||GAME_TYPE==GAME_TYPE_WZ||GAME_TYPE==GAME_TYPE_DZ||GAME_TYPE==GAME_TYPE_DZ2||GAME_TYPE==GAME_TYPE_DD||GAME_TYPE==GAME_TYPE_Q8||GAME_TYPE==GAME_TYPE_QL||GAME_TYPE==GAME_TYPE_FF?ModuleMgr.registerModule("CreateRoomDlg",CreateRoomXxDlg):GAME_TYPE==GAME_TYPE_LS?ModuleMgr.registerModule("CreateRoomDlg",CreateRoomLsDlg):ModuleMgr.registerModule("CreateRoomDlg",CreateRoomDlg)},DataMgr.registerConst=function(){GAME_TYPE==GAME_TYPE_XX?(GAME_NAME="[欣欣十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"
}]):GAME_TYPE==GAME_TYPE_FF?(GAME_NAME="[发发十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_DD?(GAME_NAME="[丁丁十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,MUSIC_TYPE="man_speed",MUSIC_CHAT_TYPE="man_ls",GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,chatCfgList=["还不出牌，我到外面兜风都已经兜了一圈了","嗨呀，我家里老人都比你打的快","嗨呀，打牌打的我都困了","哎，你快慢慢找，我先去西湖逛一下","快一点呀，等你想好黄花菜都要凉了","你这在干嘛，这么慢","最近在忙什么，很久没见了","来快来，三缺一呀","来来来，赶紧坐下来打一圈","跟你们这些高手过招我会紧张，让着我一点","不要跑，我们决战到天亮"],GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_QL?(GAME_NAME="[麒麟十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_Q8?(GAME_NAME="[Q8十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",MUSIC_TYPE="man_speed",MUSIC_CHAT_TYPE="man_ls",GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,chatCfgList=["还不出牌，我到外面兜风都已经兜了一圈了","嗨呀，我家里老人都比你打的快","嗨呀，打牌打的我都困了","哎，你快慢慢找，我先去西湖逛一下","快一点呀，等你想好黄花菜都要凉了","你这在干嘛，这么慢","最近在忙什么，很久没见了","来快来，三缺一呀","来来来，赶紧坐下来打一圈","跟你们这些高手过招我会紧张，让着我一点","不要跑，我们决战到天亮"],GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_WZ?(GAME_NAME="[王者十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_DZ?(GAME_NAME="[斗阵十三水]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_DZ2?(GAME_NAME="[斗阵十三张]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="钻石",GAME_SHOW_CARD_SPEED=1.8,FORMATION_TIME=180,GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>铁支>葫芦>同花>[br]顺子>三条>两对>对子>乌龙。{注释：福州玩法中双方同花顺大小一样时比花色大小：黑桃>红心>梅花>方块}"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全垒打：比牌结束后，其他三家被一位玩家打枪，则为全垒打。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>铁支>葫芦>同花>顺子>三条>两对>对子>乌龙 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"     [c255:124:102]同花顺[/c]（同一花色的顺子）[br]        [c255:124:102]铁支[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]乌龙[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}：[/c]同一种花色，A到K各一张的十三张牌型。[br]   ● [c255:217:102]十三水{一条龙}：[/c]不同花色，A到K各一张的是十三张牌型。[br]   ● [c255:217:102]报道{六对半}：[/c]十三张牌由六个对子加一张其他单排组成。[br]   ● [c255:217:102]报道{三顺子}：[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。[br]   ● [c255:217:102]报道{三同花}：[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。[br]"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                   [c142:255:102]+1[/c]分[br]        同一道大于其他玩家[br]   ● 输一道                    [c142:255:102]-1[/c]分[br]同一道小于其他玩家[br]   ● 打和                       [c142:255:102]+0[/c]分[br]同一道和其他玩家相同[br]   ● 打枪                       [c142:255:102]×2[/c]分[br]比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。[br]   ● 全垒打                   [c142:255:102]×2[/c]分[br]比牌结束后，如果一个玩家全垒打，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）[br]   ● 冲三                      [c142:255:102]+3[/c]分[br]头道为三条，且大于对手，赢家可获得1分外，再加2分，总计赢3分，输家则输3分。[br]   ● 中墩葫芦                [c142:255:102]+2[/c]分[br]中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。[br]   ● 铁支                 \t     [c142:255:102]+4[/c]或[c142:255:102]+8[/c]分[br]中道为铁支，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为铁支，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。[br]   ● 同花顺                   [c142:255:102]+5[/c]或[c142:255:102]+10[/c]分[br]中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。[br]   ● 三同花                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 三顺子                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 六对半                   [c142:255:102]+6[/c]分[br]若大于其他玩家，赢取每家6分。[br]   ● 一条龙                  [c142:255:102]+52[/c]分[br]若大于其他玩家，赢取每家52分。[br]   ● 清龙                 \t   [c142:255:102]+104[/c]分[br]若大于其他玩家，赢取每家104分。[br]"}]):GAME_TYPE==GAME_TYPE_LS?(GAME_NAME="[罗松十三道]",GAME_AREA_NAME_1="比花色",GAME_AREA_NAME_2="不比花色",ROOM_CARD_NAME="茶叶",GAME_SHOW_CARD_SPEED=1.5,FORMATION_TIME=60,MUSIC_TYPE="man_ls",MUSIC_CHAT_TYPE="man_ls",GAME_PAY_TYPE=GAME_PAY_TYPE_JTPAY,chatCfgList=["还不出牌，我到外面兜风都已经兜了一圈了","嗨呀，我家里老人都比你打的快","嗨呀，打牌打的我都困了","哎，你快慢慢找，我先去西湖逛一下","快一点呀，等你想好黄花菜都要凉了","你这在干嘛，这么慢","最近在忙什么，很久没见了","来快来，三缺一呀","来来来，赶紧坐下来打一圈","跟你们这些高手过招我会紧张，让着我一点","不要跑，我们决战到天亮"],ROOM_CARD_COST=[{round:10,cost:2},{round:20,cost:4}],GAME_HELP_LIST=[{type:1,txt:"普通玩法"},{type:2,txt:"   ● 游戏使用52张牌（无大小王），每名玩家分配13张牌。"},{type:2,txt:"   ● 13张牌分别为三道牌（头道：3张牌 中道：5张牌尾道：5张牌）。"},{type:2,txt:"   ● 头道必须小于中道，中道必须小于尾道，否则为【相公】。"},{type:2,txt:"   ● 牌型大小，十三水>报道>同花顺>炸弹>葫芦>同花>[br]顺子>三条>两对>对子>散花。"},{type:2,txt:"   ● 同一道若牌型相同，则比点数大小。"},{type:2,txt:"   ● 同一道若点数相同，则视为大小相同，不比花色。 "},{type:1,txt:"做庄玩法"},{type:2,txt:"   ● 做庄玩法是在普通玩法的基础上改变了比牌方式，即庄家和闲家进行比牌，闲家之间不另外进行比牌，庄家由房主担任，其他玩家为闲家。"},{type:1,txt:"术语解析"},{type:2,txt:"   ● 道数：玩家手中十三张牌按照三张、五张、分为三组，分别成为头、中、尾道，之后与其他三家对比牌型、牌面，较大的则为赢一分。特殊牌型没有额外的墩数计算。"},{type:2,txt:"   ● 比牌：全部玩家理牌结束后、按照头、中、尾道的顺序比大小的过程称为比牌。游戏中每墩的比牌过程会由最小的先显示，最大的后显示。"},{type:2,txt:"   ● 打枪：普通比牌结束后，其中一位玩家三道都大于其他玩家，则为打枪。 "},{type:2,txt:"   ● 全红：比牌结束后，其他三家被一位玩家打枪，则为全红。"},{type:1,txt:"普通牌型"},{type:2,txt:"   ● 十三张游戏牌型分为普通牌型、特殊牌型普通牌型的牌型大小：十三水>报道>同花顺>炸弹>葫芦>同花>顺子>三条>两对>对子>散花 牌型顺序分别是从大到小依次往下排："},{type:2,txt:"    [c255:124:102]同花顺[/c]（同一花色的顺子）[br]    [c255:124:102]炸弹[/c]（四张相同+单张）[br]    [c255:124:102]葫芦[/c]（三张相同+一对）[br]    [c255:124:102]同花[/c]（花色相同）[br]    [c255:124:102]顺子[/c]（花色不一样的顺子）[br]    [c255:124:102]三条[/c]（三张相同+单张）[br]    [c255:124:102]两队[/c]（两个对子+单张）[br]    [c255:124:102]对子[/c]（一个对子+三张单）[br]    [c255:124:102]散花[/c]（无法组成以上牌型）"},{type:1,txt:"特殊牌型"},{type:2,txt:"   ● [c255:217:102]十三水{清龙}:[/c]同一种花色，A到K各一张的十三张牌型。  "},{type:2,txt:"   ● [c255:217:102]十三水{一条龙}:[/c]不同花色，A到K各一张的是十三张牌型。 "},{type:2,txt:"   ● [c255:217:102]报道{六对半}:[/c]十三张牌由六个对子加一张其他单排组成。 "},{type:2,txt:"   ● [c255:217:102]报道{三顺子}:[/c]第二墩、第三墩为顺子，第一墩为三张连续的牌。"},{type:2,txt:"   ● [c255:217:102]报道{三同花}:[/c]第二墩、第三年墩为同花，第一墩为三张同花色的牌，并且三墩牌型的花色都不同，才能算做三同花。"},{type:1,txt:"计分规则"},{type:2,txt:"   ● 赢一道                    [c142:255:102]+1[/c]分[br] ◇ 同一道大于其他玩家"},{type:2,txt:"   ● 输一道                    [c142:255:102]-1[/c]分[br] ◇ 同一道小于其他玩家"},{type:2,txt:"   ● 打和                      [c142:255:102]+0[/c]分[br] ◇ 同一道和其他玩家相同"},{type:2,txt:"   ● 打枪                      [c142:255:102]×2[/c]分[br] ◇ 比赛结束后，如果其他一个玩家三分全部胜过另一个玩家，称为打枪。赢家获得双倍分数，输家则扣相应的分数。"},{type:2,txt:"   ● 全红                      [c142:255:102]×2[/c]分[br] ◇ 比牌结束后，如果一个玩家全红，算上原来打枪的分数外，赢家还要每家分数乘二倍。（房间满4人才会出现）"},{type:2,txt:"   ● 三冲头                    [c142:255:102]+3[/c]分[br] ◇ 头道为三条，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。"},{type:2,txt:"   ● 中墩葫芦                  [c142:255:102]+2[/c]分[br] ◇ 中道为葫芦，且大于对手，赢家可获得1分外，再加1分，总计赢2分，输家则输2分。"},{type:2,txt:"   ● 炸弹                 \t [c142:255:102]+5[/c]或[c142:255:102]+9[/c]分[br]  ◇ 中道为炸弹，且大于对手，赢家可获得1分外，再加7分，总计赢8分，输家则输8分。[br]尾道为炸弹，且大于对手，赢家可获得1分外，再加3分，总计赢4分，输家则输4分。"},{type:2,txt:"   ● 同花顺                    [c142:255:102]+6[/c]或[c142:255:102]+10[/c]分[br] ◇ 中道为同花顺，且大于对手，赢家可获得1分外，再加9分，总计赢10分，输家则输10分。尾道为同花顺，且大于对手，赢家可获得1分外，再加4分，总计赢5分，输家则输5分。"},{type:2,txt:"   ● 五同                      [c142:255:102]+6[/c]或[c142:255:102]+12[/c]分[br] ◇ 中道为五同，且大于对手，赢家可获得1分外，再加13分，总计赢14分，输家则输14分。尾道为同花顺，且大于对手，赢家可获得1分外，再加6分，总计赢7分，输家则输7分。"},{type:2,txt:"   ● 三同花                    [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 三顺子       \t\t     [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 六对半                    [c142:255:102]+6[/c]分[br] ◇ 若大于其他玩家，赢取每家6分。"},{type:2,txt:"   ● 一条龙                    [c142:255:102]+52[/c]分[br] ◇ 若大于其他玩家，赢取每家52分。"},{type:2,txt:"   ● 清龙                 \t [c142:255:102]+104[/c]分[br] ◇ 若大于其他玩家，赢取每家104分。"},{type:1,txt:"玩法类型"},{type:2,txt:"   ● 普通场 \t"},{type:2,txt:"      ◇… 轻松休闲 …◇"},{type:2,txt:"   ● 疯狂场  "},{type:2,txt:"      ◇… 精彩刺激 …◇"},{type:2,txt:"   ● 红5玩法"},{type:2,txt:"      ◇手抓红5者与其他玩家比牌计分基础×2，其他玩家对比不翻倍"},{type:2,txt:"   ● 有鬼"},{type:2,txt:"      ◇牌型中加入大小鬼王,大小鬼王可替代任意牌。"},{type:2,txt:"   ● 无鬼"},{type:2,txt:"      ◇牌型中无大小鬼王。"},{type:1,txt:"模式选择"},{type:2,txt:"   ● 房卡消耗"},{type:2,txt:"      ◇房主付:该局结束时，由房主支付房卡。"},{type:2,txt:"      ◇赢家付:该局结束时，由本局赢得积分最多的支付房卡。"},{type:2,txt:"      ◇平摊模式:该局结束时，平摊支付房卡。"},{type:2,txt:"      ◇赢家付模式遇倒同分情况或平躺模式中平摊不均时根据具体情况进行计算。"},{type:2,txt:"   ● 加色玩法"},{type:2,txt:"      ◇不加色:52张牌（无大小王）。 "},{type:2,txt:"      ◇加一色:52张牌（无大小王）附加一组 黑桃A-K 且支持5位玩家共同体验。"}]):GAME_SHOW_CARD_SPEED=1.5},DataMgr.calGameType=function(){DataMgr.registerModule(),DataMgr.registerConst(),DataMgr.registerReplacePathMap()},DataMgr.setGameType=function(){var e=getQueryString("game_type");console.log("game_type = ",e),GetGameType(e)&&(GAME_TYPE=e),DataMgr.calGameType&&DataMgr.calGameType()},DataMgr.gameCtrl.GetTypeHandle_GetFour=function(e,t){for(var r=e.length,a=0;a<r;a++)for(var i=a+1;i<r;i++)for(var s=i+1;s<r;s++)for(var n=s+1;n<r;n++){var o=[e[a],e[i],e[s],e[n]],c=1e6*e[a]+1e4*e[i]+100*e[s]+e[n];if(1!=t[c]){t[c]=1;var l=DataMgr.gameCtrl.GetCardType5(o);if(l==CT_FIVE_FOUR_ONE)return o}}return null},DataMgr.gameCtrl.GetTypeHandle_GetTwoPair=function(e,t){for(var r=e.length,a=0;a<r;a++)for(var i=a+1;i<r;i++)for(var s=i+1;s<r;s++)for(var n=s+1;n<r;n++){var o=[e[a],e[i],e[s],e[n]],c=1e6*e[a]+1e4*e[i]+100*e[s]+e[n];if(1!=t[c]){t[c]=1;var l=DataMgr.gameCtrl.GetCardType5(o);if(l==CT_FIVE_TWO_DOUBLE)return o}}return null},DataMgr.gameCtrl.GetTypeHandle_GetOnePair=function(e,t){for(var r=e.length,a=0;a<r;a++)for(var i=a+1;i<r;i++){var s=[e[a],e[i]],n=100*e[a]+e[i];if(1!=t[n]){t[n]=1;var o=DataMgr.gameCtrl.GetCardType3(s);if(o==CT_ONE_DOUBLE)return s}}return null},DataMgr.gameCtrl.GetTypeHandle_GetThree=function(e,t){for(var r=e.length,a=0;a<r;a++)for(var i=a+1;i<r;i++)for(var s=i+1;s<r;s++){var n=[e[a],e[i],e[s]],o=1e4*e[a]+100*e[i]+e[s];if(1!=t[o]){t[o]=1;var c=DataMgr.gameCtrl.GetCardType3(n);if(c==CT_THREE)return n}}return null},DataMgr.gameCtrl.GetTypeHandle=function(e,t){var r={},a={},i={},s={},n={},o=this,c=function(t){var c=1e8*e[l]+1e6*e[g]+1e4*e[h]+100*e[u]+e[d];if(1!=a[c]){a[c]=1;var _=1;_=3==t.length?DataMgr.gameCtrl.GetCardType3(t):DataMgr.gameCtrl.GetCardType5(t),1!=_&&(_!=CT_FIVE_MIXED_FLUSH_FIRST_A&&_!=CT_FIVE_MIXED_FLUSH_BACK_A||(_=CT_FIVE_MIXED_FLUSH_NO_A),_!=CT_FIVE_STRAIGHT_FLUSH_FIRST_A&&_!=CT_FIVE_STRAIGHT_FLUSH_BACK_A||(_=CT_FIVE_STRAIGHT_FLUSH_NO_A),(_==CT_FIVE_FLUSH||_==CT_FIVE_MIXED_FLUSH_NO_A||_==CT_FIVE_STRAIGHT_FLUSH_NO_A)&&t.length<5||(null==r[_]&&(r[_]=[]),_==CT_FIVE_FOUR_ONE&&(t=o.GetTypeHandle_GetFour(t,i)),_==CT_THREE&&(t=o.GetTypeHandle_GetThree(t,s)),_==CT_FIVE_TWO_DOUBLE&&(t=o.GetTypeHandle_GetTwoPair(t,n)),_==CT_ONE_DOUBLE&&(t=o.GetTypeHandle_GetOnePair(t,n)),t&&r[_].push(t)))}};if(t>=5)for(var l=0;l<t;l++)for(var g=l+1;g<t;g++)for(var h=g+1;h<t;h++)for(var u=h+1;u<t;u++)for(var d=u+1;d<t;d++){var _=[e[l],e[g],e[h],e[u],e[d]];c(_)}else if(4==t)for(var l=0;l<t;l++)for(var g=l+1;g<t;g++)for(var h=g+1;h<t;h++)for(var u=h+1;u<t;u++){var _=[e[l],e[g],e[h],e[u]];c(_)}else if(3==t)for(var l=0;l<t;l++)for(var g=l+1;g<t;g++)for(var h=g+1;h<t;h++){var _=[e[l],e[g],e[h]];c(_)}else if(2==t)for(var l=0;l<t;l++)for(var g=l+1;g<t;g++){var _=[e[l],e[g]];c(_)}return r},DataMgr.gameCtrl.ChangeCards=function(e,t,r){var a=e.pop();r[a]=t},DataMgr.gameCtrl.GetCardType5=function(e,t,r){null==t&&(t={});var a=this,i=this.getRandCards(e),s=this.GetRemainCard(e,i),n=new tagAnalyseData;if(this.AnalyseCard(s,s.length,n,!0),i.length>0&&1==n.bFourCount){var o=s[n.bFourFirst[0]];return this.ChangeCards(i,o,t),CT_FIVE}if(1==n.bThreeCount&&2==i.length){for(var c=i.length,l=0;l<c;l++){var o=s[n.bThreeFirst[0]];this.ChangeCards(i,o,t)}return CT_FIVE}if(1==n.bFiveCount)return CT_FIVE;if(n.bFlush){var g=[],h=new Array(i.length);CopyMemory(h,i,i.length);var u={},d=this.getStraightFlushCard(s,g,5,h,u);if(0==d.length){for(var _ in u)t[_]=u[_];return 14==this.GetCardLogicValue(g[0])||14==this.GetCardLogicValue(g[4])?10==this.GetCardLogicValue(g[4])?CT_FIVE_STRAIGHT_FLUSH_BACK_A:CT_FIVE_STRAIGHT_FLUSH_FIRST_A:CT_FIVE_STRAIGHT_FLUSH_NO_A}if(14==a.GetCardLogicValue(s[0])){CopyMemory(h,i,i.length);var u={},m=new Array(s.length);CopyMemory(m,s,s.length);var p=m.shift();m.push(p);var d=this.getStraightFlushCard(m,g,5,h,u);if(0==d.length){for(var _ in u)t[_]=u[_];return 14==this.GetCardLogicValue(g[0])||14==this.GetCardLogicValue(g[4])?10==this.GetCardLogicValue(g[4])?CT_FIVE_STRAIGHT_FLUSH_BACK_A:CT_FIVE_STRAIGHT_FLUSH_FIRST_A:CT_FIVE_STRAIGHT_FLUSH_NO_A}}}var f=function(){if(n.bFlush){for(var e=(i.length,a.GetCardColor(s[0]));i.length>0;)a.ChangeCards(i,a.GetCardValue(s[0])+16*e,t);return CT_FIVE_FLUSH}return-1},C=!1,M=function(){var e=f();if(e!=-1)return e;if(1!=C){C=!0;var r=[],n=new Array(i.length);CopyMemory(n,i,i.length);var o={},c=a.getStraightCard(s,r,5,n,o);if(0==c.length){for(var l in o)t[l]=o[l];return 14==a.GetCardLogicValue(r[0])||14==a.GetCardLogicValue(r[4])?10==a.GetCardLogicValue(r[4])?CT_FIVE_MIXED_FLUSH_BACK_A:CT_FIVE_MIXED_FLUSH_FIRST_A:CT_FIVE_MIXED_FLUSH_NO_A}if(14==a.GetCardLogicValue(s[0])){CopyMemory(n,i,i.length);var o={},g=new Array(s.length);CopyMemory(g,s,s.length);var h=g.shift();g.push(h);var c=a.getStraightCard(g,r,5,n,o);if(0==c.length){for(var l in o)t[l]=o[l];return 14==a.GetCardLogicValue(r[0])||14==a.GetCardLogicValue(r[4])?10==a.GetCardLogicValue(r[4])?CT_FIVE_MIXED_FLUSH_BACK_A:CT_FIVE_MIXED_FLUSH_FIRST_A:CT_FIVE_MIXED_FLUSH_NO_A}}return-1}};if(1==n.bFourCount&&1==n.bOneCount)return CT_FIVE_FOUR_ONE;if(4==e.length&&1==n.bFourCount)return CT_FIVE_FOUR_ONE;if(1==n.bThreeCount){var c=i.length;if(c>0){var o=s[n.bThreeFirst[0]];return this.ChangeCards(i,o,t),CT_FIVE_FOUR_ONE}if(1==n.bTwoCount)return CT_FIVE_THREE_DEOUBLE;if(2==n.bOneCount){var E=M();return E!=-1?E:CT_THREE}}if(2==n.bTwoCount){var c=i.length;if(i.length>0){for(l=0;l<c;l++){var o=s[n.bTwoFirst[0]];this.ChangeCards(i,o,t)}if(1==c)return CT_FIVE_THREE_DEOUBLE;if(2==c)return CT_FIVE_FOUR_ONE}else if(1==n.bOneCount){var E=M();if(E!=-1)return E}return CT_FIVE_TWO_DOUBLE}if(1==n.bTwoCount){var c=i.length;if(i.length>0){for(l=0;l<c;l++){var o=s[n.bTwoFirst[0]];this.ChangeCards(i,o,t)}if(1==c){var E=M();return E!=-1?E:CT_THREE}if(2==c)return CT_FIVE_FOUR_ONE}else if(3==n.bOneCount){var E=M();return E!=-1?E:CT_ONE_DOUBLE}}var E=M();if(E!=-1)return E;if(!(i.length>0))return CT_SINGLE;for(var c=i.length,l=0;l<c;l++){var o=s[0];this.ChangeCards(i,o,t)}return 1==c?CT_ONE_DOUBLE:2==c?CT_THREE:void 0},DataMgr.gameCtrl.GetCardType3=function(e,t){null==t&&(t={});var r=this.getRandCards(e),a=this.GetRemainCard(e,r),s=new tagAnalyseData;
if(this.AnalyseCard(a,a.length,s,!0),1==s.bThreeCount)return CT_THREE;if(1==s.bTwoCount){if(r.length>0){var n=a[s.bTwoFirst[0]];return this.ChangeCards(r,n,t),CT_THREE}return CT_ONE_DOUBLE}if(r.length>0){var o=r.length;for(i=0;i<o;i++){var n=a[s.bOneFirst[0]];null==n&&(n=1),this.ChangeCards(r,n,t)}return 2==o?CT_THREE:CT_ONE_DOUBLE}return CT_SINGLE},DataMgr.gameCtrl.isRandCard=function(e){return 78==e||79==e||e>255},DataMgr.gameCtrl.getRandValue=function(e){return e>255?parseInt(e/256):e},DataMgr.gameCtrl.getRandCards=function(e){for(var t=[],r=0;r<e.length;r++)this.isRandCard(e[r])&&t.push(this.getRandValue(e[r]));return t},DataMgr.gameCtrl.GetType=function(e,t){var r=new tagAnalyseType;if(0==t)return r;this.SortCardList(e,t,enDescend);var a=this.getRandCards(e),i=this.GetRemainCard(e,a),s=new Array(t),n=0,o=1,c=new Array(9);ZeroMemory(c,c.length);var l=this.GetCardLogicValue(i[0]);s[n++]=i[0];for(var g=1;g<t;g++)l==this.GetCardLogicValue(i[g])&&i[g]&&(o++,s[n++]=i[g]),l==this.GetCardLogicValue(i[g])&&g!=t-1||(1==o||(2==o?(r.bOnePare=!0,r.cbOnePare[c[0]++]=s[o-2],r.cbOnePare[c[0]++]=s[o-1],r.btOnePare++):3==o?(r.bOnePare=!0,r.cbOnePare[c[0]++]=s[o-3],r.cbOnePare[c[0]++]=s[o-2],r.btOnePare++,r.bThreeSame=!0,r.cbThreeSame[c[2]++]=s[o-3],r.cbThreeSame[c[2]++]=s[o-2],r.cbThreeSame[c[2]++]=s[o-1],r.btThreeSame++):4==o?(r.bOnePare=!0,r.cbOnePare[c[0]++]=s[o-4],r.cbOnePare[c[0]++]=s[o-3],r.btOnePare++,r.bThreeSame=!0,r.cbThreeSame[c[2]++]=s[o-4],r.cbThreeSame[c[2]++]=s[o-3],r.cbThreeSame[c[2]++]=s[o-2],r.btThreeSame++,r.bFourSame=!0,r.cbFourSame[c[6]++]=s[o-4],r.cbFourSame[c[6]++]=s[o-3],r.cbFourSame[c[6]++]=s[o-2],r.cbFourSame[c[6]++]=s[o-1],r.btFourSame++):o>=5&&(r.bOnePare=!0,r.cbOnePare[c[0]++]=s[o-4],r.cbOnePare[c[0]++]=s[o-3],r.btOnePare++,r.bThreeSame=!0,r.cbThreeSame[c[2]++]=s[o-4],r.cbThreeSame[c[2]++]=s[o-3],r.cbThreeSame[c[2]++]=s[o-2],r.btThreeSame++,r.bFourSame=!0,r.cbFourSame[c[6]++]=s[o-4],r.cbFourSame[c[6]++]=s[o-3],r.cbFourSame[c[6]++]=s[o-2],r.cbFourSame[c[6]++]=s[o-1],r.btFourSame++,r.bFiveSame=!0,r.cbFiveSame[c[7]++]=s[o-5],r.cbFiveSame[c[7]++]=s[o-4],r.cbFiveSame[c[7]++]=s[o-3],r.cbFiveSame[c[7]++]=s[o-2],r.cbFiveSame[c[7]++]=s[o-1],r.btFiveSame++)),n=0,ZeroMemory(s,sizeof(s)),s[n++]=i[g],o=1,l=this.GetCardLogicValue(i[g]));var h=c[0]/2,u=c[2]/3;if(h>=2){r.bTwoPare=!0;for(var g=0;g<h;g++)for(var d=g+1;d<h;d++)r.cbTwoPare[c[1]++]=r.cbOnePare[2*g],r.cbTwoPare[c[1]++]=r.cbOnePare[2*g+1],r.cbTwoPare[c[1]++]=r.cbOnePare[2*d],r.cbTwoPare[c[1]++]=r.cbOnePare[2*d+1],r.btTwoPare++}if(h>0&&u>0)for(var g=0;g<u;g++)for(var d=0;d<h;d++)this.GetCardLogicValue(r.cbThreeSame[3*g])!=this.GetCardLogicValue(r.cbOnePare[2*d])&&(r.cbGourd[c[5]++]=r.cbThreeSame[3*g],r.cbGourd[c[5]++]=r.cbThreeSame[3*g+1],r.cbGourd[c[5]++]=r.cbThreeSame[3*g+2],r.cbGourd[c[5]++]=r.cbOnePare[2*d],r.cbGourd[c[5]++]=r.cbOnePare[2*d+1],r.btGourd++);this.getCardType_findFive(c,a,r);for(var _=0,m=0,p=0,f=0,g=0;g<4;g++)14==this.GetCardLogicValue(i[g])&&_++;var C=new Array,M=new Array,E=new Array;if(t>=5){var _=this.getANum(i);if(a=this.getCardType_findStraightFlush(i,t,M,a),_>0){var y=this.MoveAToFront(i);a=this.getCardType_findStraightFlush(y,t,M,a)}if(this.getCardType_findFour(c,a,r),this.getCardType_findGourd(c,a,r),a=this.getCardType_findFlush(i,t,E,a),a=this.getCardType_findStraight(i,t,C,a),_>0){var y=this.MoveAToFront(i);a=this.getCardType_findStraight(y,t,C,a)}this.getCardType_findThree(c,a,r);var T=function(e,t){return 1e3*e[0]+10*e[1]-1e3*t[0]+10*t[1]};C.sort(T),this.removeSameStraight(C),C=this.removeNullItem(C),M.sort(T),this.removeSameStraight(M),M=this.removeNullItem(M),E.sort(T),this.removeSameStraight(E),E=this.removeNullItem(E);for(var g=0;g<C.length;g++){r.btStraight++;for(var S=0;S<5;S++)r.cbStraight[m++]=C[g][S]}for(var g=0;g<M.length;g++){r.btStraightFlush++;for(var S=0;S<5;S++)r.cbStraightFlush[p++]=M[g][S]}for(var g=0;g<E.length;g++){r.btFlush++;for(var S=0;S<5;S++)r.cbFlush[f++]=E[g][S]}}return r},DataMgr.gameCtrl.getCardType_findStraightFlush=function(e,t,r,a){t=e.length;for(var i=new Array(t),s=t,n=0;n<s;n++){memset(i,-1,t),CopyMemory(i,e,t,0,n);var o=new Array(5),c={},l=new Array(a.length);CopyMemory(l,a,a.length);var g=this.getStraightFlushCard(i,o,5,l,c);if(g.length!=i.length)return r.push(o),this.repaceRandCard(o,c),l}return a},DataMgr.gameCtrl.getCardType_findStraight=function(e,t,r,a){t=e.length;for(var i=new Array(t),s=t,n=0;n<s;n++){memset(i,-1,t),CopyMemory(i,e,t,0,n);var o=new Array(5),c={},l=new Array(a.length);CopyMemory(l,a,a.length);var g=this.getStraightCard(i,o,5,l,c);if(g.length!=i.length)return r.push(o),this.repaceRandCard(o,c),l}return a},DataMgr.gameCtrl.repaceRandCard=function(e,t){for(var r=0;r<e.length;r++)t[e[r]]&&(e[r]=this.mergeRandNum(e[r],t[e[r]]))},DataMgr.gameCtrl.getCardType_findFlush=function(e,t,r,a){var i=new Array(t),s=new Array(t);CopyMemory(s,e,t),this.SortCardList(s,t,enColor);for(var n=t,o=0;o<n;o++){var c=n-o;memset(i,-1,i.length),CopyMemory(i,s,c,0,o);var l=new Array(5),g={},h=new Array(a.length);CopyMemory(h,a,a.length);var u=this.getFlushCard(i,l,5,h,g);if(u.length!=i.length)return r.push(l),this.repaceRandCard(l,g),h}return a},DataMgr.gameCtrl.mergeRandNum=function(e,t){return 16*e*16+t},DataMgr.gameCtrl.getCardType_findGourd=function(e,t,r){t.length>0&&(2==r.btOnePare&&(r.cbGourd[e[5]++]=r.cbOnePare[0],r.cbGourd[e[5]++]=r.cbOnePare[1],r.cbGourd[e[5]++]=this.mergeRandNum(t.pop(),r.cbOnePare[0]),r.cbGourd[e[5]++]=r.cbOnePare[2],r.cbGourd[e[5]++]=r.cbOnePare[3],r.btGourd++),1==r.btThreeSame&&2==t.length&&(r.cbGourd[e[5]++]=r.cbThreeSame[0],r.cbGourd[e[5]++]=r.cbThreeSame[1],r.cbGourd[e[5]++]=r.cbThreeSame[2],r.cbGourd[e[5]++]=this.mergeRandNum(t.pop(),1),r.cbGourd[e[5]++]=this.mergeRandNum(t.pop(),1),r.btGourd++))},DataMgr.gameCtrl.getCardType_findThree=function(e,t,r){t.length>0&&r.btOnePare>=1&&(r.cbThreeSame[e[2]++]=r.cbOnePare[0],r.cbThreeSame[e[2]++]=r.cbOnePare[1],r.cbThreeSame[e[2]++]=this.mergeRandNum(t.pop(),r.cbOnePare[0]),r.btThreeSame++)},DataMgr.gameCtrl.getCardType_findFour=function(e,t,r){t.length>0&&(1==r.btThreeSame?(r.cbFourSame[e[6]++]=r.cbThreeSame[0],r.cbFourSame[e[6]++]=r.cbThreeSame[1],r.cbFourSame[e[6]++]=r.cbThreeSame[2],r.cbFourSame[e[6]++]=this.mergeRandNum(t.pop(),r.cbThreeSame[0]),r.btFourSame++):t.length>=2&&r.btOnePare>=1&&(r.cbFourSame[e[6]++]=r.cbOnePare[0],r.cbFourSame[e[6]++]=r.cbOnePare[1],r.cbFourSame[e[6]++]=this.mergeRandNum(t.pop(),r.cbOnePare[0]),r.cbFourSame[e[6]++]=this.mergeRandNum(t.pop(),r.cbOnePare[0]),r.btFourSame++))},DataMgr.gameCtrl.getCardType_findFive=function(e,t,r){t.length>0&&(1==r.btFourSame?(r.cbFiveSame[e[8]++]=r.cbFourSame[0],r.cbFiveSame[e[8]++]=r.cbFourSame[1],r.cbFiveSame[e[8]++]=r.cbFourSame[2],r.cbFiveSame[e[8]++]=r.cbFourSame[3],r.cbFiveSame[e[8]++]=this.mergeRandNum(t.pop(),r.cbFourSame[0]),r.btFiveSame++):2==t.length&&1==r.btThreeSame&&(r.cbFiveSame[e[8]++]=r.cbThreeSame[0],r.cbFiveSame[e[8]++]=r.cbThreeSame[1],r.cbFiveSame[e[8]++]=r.cbThreeSame[2],r.cbFiveSame[e[8]++]=this.mergeRandNum(t.pop(),r.cbThreeSame[0]),r.cbFiveSame[e[8]++]=this.mergeRandNum(t.pop(),r.cbThreeSame[0]),r.btFiveSame++))},DataMgr.gameCtrl.removeNullItem=function(e){for(var t=new Array,r=0;r<e.length;r++)e[r]&&t.push(e[r]);return t},DataMgr.gameCtrl.removeSameStraight=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r)for(var a=t+1;a<e.length;a++){var i=e[a];i&&r[0]==i[0]&&r[r.length-1]==i[i.length-1]&&(e[a]=null)}}},DataMgr.gameCtrl.getFlushCard=function(e,t,r,a,i){null==a&&(a=[]),null==i&&(i={});var s=this.GetCardColor(e[0]),n=0,o=e.length,c=new Array(o);c[n++]=e[0];for(var l=1;l<o;l++)if(null!=e[l]){var g=this.GetCardColor(e[l]);if(s==g)c[n++]=e[l],s=g;else if(s!=g){if(!(a.length>0))continue;var h=a.pop();i[h]=this.GetCardValue(e[0])+16*g,c[n++]=this.mergeRandNum(h,i[h])}if(n>=5)break}if(n<r&&a.length>0){var h=a.pop();i[h]=this.GetCardValue(e[0])+16*g,c[n++]=this.mergeRandNum(h,i[h])}if(n<3)return e;var u=!1;return 5==r&&5==n?(this.SortCardList(c,5),CopyMemory(t,c,5),u=!0):3==r&&(this.SortCardList(c,5),CopyMemory(t,c,3),u=!0),0==u?e:this.GetRemainCard(e,t)},DataMgr.gameCtrl.getStraightCard=function(e,t,r,a,i){null==a&&(a=[]),null==i&&(i={});var s=this.GetCardLogicValue(e[0]),n=0,o=e.length,c=new Array(o),l=!1;c[n++]=e[0];for(var g=this.GetCardColor(e[0]),h=!0,u=1;u<o;u++){var d=this.GetCardLogicValue(e[u]);if(s==d+1||2==s&&14==d)c[n++]=e[u],s=d,14==d&&(l=!0);else if(a.length>0){var _=a.pop();2==s?(s=14,l=!0):s--,i[_]=s+16*g,c[n++]=this.mergeRandNum(_,i[_]),u--}else if(s!=d){h=!1;break}if(n>=5)break}if(h)for(;a.length>0;){var _=a.pop(),m=this.GetCardLogicValue(c[0]),p=this.GetCardLogicValue(c[c.length-1]),f=0;2==p||1==a.length&&3==p||14==m?(f=p-1,i[_]=16*_*16+f+16*g,c.push(i[_]),1==f&&(l=!0)):(f=m+1,14==f&&(f=1),i[_]=16*_*16+f+16*g,c.unshift(i[_])),14==f&&(l=!0),n++}if(n<3)return e;var C=!1;return 5==r&&5==n?(l&&this.SortCardList(c,5),CopyMemory(t,c,5),C=!0):3==r&&(l&&this.SortCardList(c,3),CopyMemory(t,c,3),C=!0),0==C?e:this.GetRemainCard(e,t)},DataMgr.gameCtrl.getStraightFlushCard=function(e,t,r,a,i){null==a&&(a=[]),null==i&&(i={});var s=this.GetCardLogicValue(e[0]),n=this.GetCardColor(e[0]),o=0,c=e.length,l=new Array(c),g=!1,h=!0;l[o++]=e[0];for(var u=1;u<c;u++){var d=this.GetCardLogicValue(e[u]),_=this.GetCardColor(e[u]),m=s==d+1||2==s&&14==d;if(m&&n==_)l[o++]=e[u],s=d,14==d&&(g=!0);else{if(m&&n!=_)continue;if(a.length>0){var p=a.pop();2==s?(s=14,g=!0):s--,i[p]=s+16*_,l[o++]=this.mergeRandNum(p,i[p]),u--}else if(s!=d){h=!1;break}}if(o>=5)break}if(h)for(;a.length>0;){var p=a.pop(),f=this.GetCardLogicValue(l[0]),C=this.GetCardLogicValue(l[l.length-1]),M=0;2==C||1==a.length&&3==C||14==f?(M=C-1,i[p]=16*p*16+M+16*_,l.push(i[p]),1==M&&(g=!0)):(M=f+1,14==M&&(M=1),i[p]=16*p*16+M+16*_,l.unshift(i[p])),14==M&&(g=!0),o++}if(o<3)return e;var E=!1;return 5==r&&5==o?(g&&this.SortCardList(l,5),CopyMemory(t,l,5),E=!0):3==r&&(g&&this.SortCardList(l,3),CopyMemory(t,l,3),E=!0),0==E?e:this.GetRemainCard(e,t)},DataMgr.gameCtrl.GetCardLogicValue=function(e){var t=this.GetCardValue(e);return 1==t?t+13:t},DataMgr.gameCtrl.GetCardValue=function(e){return e&LOGIC_MASK_VALUE},DataMgr.gameCtrl.GetCardColor=function(e){return(e&LOGIC_MASK_COLOR)>>4},DataMgr.gameCtrl.RemoveCard=function(e,t,r,a){var i=0,s=new Array(13);if(a>s.length)return!1;CopyMemory(s,r,a);for(var n=0;n<t;n++)for(var o=0;o<a;o++)if(e[n]==s[o]){i++,s[o]=0;break}if(i!=t)return!1;for(var c=0,n=0;n<a;n++)0!=s[n]&&(r[c++]=s[n]);return!0},DataMgr.gameCtrl.SortCardList=function(e,t,r){null==r&&(r=enDescend);for(var a=new Array(t),i=0;i<t;i++)a[i]=this.GetCardLogicValue(e[i]);if(enDescend==r){var s,n=!0,o=t-1;do{n=!0;for(var i=0;i<o;i++)(a[i]<a[i+1]||a[i]==a[i+1]&&e[i]<e[i+1])&&(s=e[i],e[i]=e[i+1],e[i+1]=s,s=a[i],a[i]=a[i+1],a[i+1]=s,n=!1);o--}while(0==n)}else if(enAscend==r){var s,n=!0,o=t-1;do{n=!0;for(var i=0;i<o;i++)(a[i]>a[i+1]||a[i]==a[i+1]&&e[i]>e[i+1])&&(s=e[i],e[i]=e[i+1],e[i+1]=s,s=a[i],a[i]=a[i+1],a[i+1]=s,n=!1);o--}while(0==n)}else if(enColor==r){for(var s,n=!0,o=t-1,c=new Array(13),i=0;i<t;i++)c[i]=this.GetCardColor(e[i]);do{n=!0;for(var i=0;i<o;i++)(c[i]<c[i+1]||c[i]==c[i+1]&&this.GetCardLogicValue(e[i])<this.GetCardLogicValue(e[i+1]))&&(s=e[i],e[i]=e[i+1],e[i+1]=s,s=c[i],c[i]=c[i+1],c[i+1]=s,n=!1);o--}while(0==n)}},DataMgr.gameCtrl.SortFormation3A=function(e){if(14==this.GetCardLogicValue(e[0])&&2==this.GetCardLogicValue(e[e.length-1])){for(var t=e[0],r=1;r<e.length;r++)e[r-1]=e[r];e[e.length-1]=t}},DataMgr.gameCtrl.SortFormationA=function(e,t){if((t==CT_FIVE_MIXED_FLUSH_FIRST_A||t==CT_FIVE_STRAIGHT_FLUSH_FIRST_A)&&14==this.GetCardLogicValue(e[0])){for(var r=e[0],a=1;a<e.length;a++)e[a-1]=e[a];e[e.length-1]=r}},DataMgr.gameCtrl.ParseFormation=function(e,t,r){for(var a=[],i=0;i<r.third_list.length;i++)0!=r.third_list[i]&&a.push(r.third_list[i]);for(var i=0;i<r.second_list.length;i++)0!=r.second_list[i]&&a.push(r.second_list[i]);for(var i=0;i<r.first_list.length;i++)0!=r.first_list[i]&&a.push(r.first_list[i]);for(var s=this.GetRemainCard(e,a),n=0,i=0;i<5;i++)null!=r.third_list[i]&&0!=r.third_list[i]||(r.third_list[i]=s[n],n++);for(var i=0;i<5;i++)null!=r.second_list[i]&&0!=r.second_list[i]||(r.second_list[i]=s[n],n++);for(var i=0;i<3;i++)null!=r.first_list[i]&&0!=r.first_list[i]||(r.first_list[i]=s[n],n++);return r.third_type=DataMgr.gameCtrl.GetCardType5(r.third_list),r.second_type=DataMgr.gameCtrl.GetCardType5(r.second_list),r.first_type=DataMgr.gameCtrl.GetCardType3(r.first_list),r.totaltype=1e4*this.getRealType(r.third_type)+100*this.getRealType(r.second_type)+this.getRealType(r.first_type),r.third_list=DataMgr.gameCtrl.SortForamtion(r.third_list),r.second_list=DataMgr.gameCtrl.SortForamtion(r.second_list),r.first_list=DataMgr.gameCtrl.SortForamtion(r.first_list),r},DataMgr.gameCtrl.isSameFormation=function(e,t){return this.getRealType(e.third_type)==this.getRealType(t.third_type)&&this.getRealType(e.second_type)==this.getRealType(t.second_type)&&this.getRealType(e.first_type)==this.getRealType(t.first_type)},DataMgr.gameCtrl.removeSameFormation=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r)for(var a=t+1;a<e.length;a++){var i=e[a];i&&this.isSameFormation(r,i)&&(e[a]=null)}}},DataMgr.gameCtrl.getRealType=function(e){return e==CT_FIVE_MIXED_FLUSH_NO_A||e==CT_FIVE_MIXED_FLUSH_FIRST_A||e==CT_FIVE_MIXED_FLUSH_BACK_A?CT_FIVE_MIXED_FLUSH_NO_A:e==CT_FIVE_STRAIGHT_FLUSH_NO_A||e==CT_FIVE_STRAIGHT_FLUSH_FIRST_A||e==CT_FIVE_STRAIGHT_FLUSH_BACK_A?CT_FIVE_STRAIGHT_FLUSH_NO_A:e},DataMgr.gameCtrl.bigThanCard=function(e,t){for(var r=0;r<e.length&&r<t.length;r++){if(this.GetCardLogicValue(e[r])>this.GetCardLogicValue(t[r]))return 1;if(this.GetCardLogicValue(e[r])<this.GetCardLogicValue(t[r]))return-1}return 0},DataMgr.gameCtrl.isLegalForamtion=function(e){var t=e.third_type,r=e.second_type,a=e.first_type;if(t==r&&t==CT_FIVE_FLUSH){var i=new tagAnalyseData;this.AnalyseCard(e.second_list,e.second_list.length,i,!0);var s=new tagAnalyseData;if(this.AnalyseCard(e.third_list,e.third_list.length,s,!0),i.bThreeCount>s.bThreeCount)return!1;if(i.bThreeCount<s.bThreeCount)return!0;if(i.bTwoCount>s.bTwoCount)return!1;if(i.bTwoCount<s.bTwoCount)return!0;if(0!=i.bThreeCount){var n=this.GetCardLogicValue(e.second_list[i.bThreeFirst[0]]),o=this.GetCardLogicValue(e.third_list[s.bThreeFirst[0]]);return!(n>o)}if(0!=i.bTwoCount){var n=this.GetCardLogicValue(e.second_list[i.bTwoFirst[0]]),o=this.GetCardLogicValue(e.third_list[s.bTwoFirst[0]]);if(n>o)return!1;if(n<o)return!0}}if(t==r&&DataMgr.gameCtrl.bigThanCard(e.third_list,e.second_list)<0)return!1;if(t<r)return!1;if(r==a&&DataMgr.gameCtrl.bigThanCard(e.second_list,e.first_list)<0)return!1;if(r<a)return!1;if(1==DataMgr.gameCtrl.deskInfo.area&&t==r&&(t==CT_FIVE_STRAIGHT_FLUSH_NO_A||t==CT_FIVE_STRAIGHT_FLUSH_FIRST_A||t==CT_FIVE_STRAIGHT_FLUSH_BACK_A)){if(this.GetCardLogicValue(e.third_list[0])<this.GetCardLogicValue(e.second_list[0]))return!1;if(this.GetCardLogicValue(e.third_list[0])==this.GetCardLogicValue(e.second_list[0])&&this.GetCardColor(e.third_list[0])<this.GetCardColor(e.second_list[0]))return!1}return!0},DataMgr.gameCtrl.GetCardForamtion=function(e,t,r){var a=[];CopyMemory(a,e,t);var i=[],s=new tagCardForamtion;this.AnalyseForamtion(CT_FIVE,100,100,a,a.length,1,i,s,[]),a=[];for(var n=0;n<i.length;n++){var o=i[n];o&&(o=this.ParseFormation(e,t,o),o&&this.isLegalForamtion(o)&&a.push(o))}a.sort(function(e,t){return t.totaltype-e.totaltype}),this.removeSameFormation(a);for(var n=0;n<a.length&&r.length<6;n++){var o=a[n];o&&r.push(o)}return a},DataMgr.gameCtrl.GetRemainCard=function(e,t){for(var r=[],a=[],i=0;i<t.length;i++)a.push(t[i]);for(var i=0;i<e.length;i++){for(var s=!1,n=0;n<a.length;n++)if(this.getRandValue(e[i])==this.getRandValue(a[n])){a.splice(n,1),s=!0;break}0==s&&r.push(e[i])}return r},DataMgr.gameCtrl.AnalyseForamtionRet=function(e,t,r,a,i,s,n,o,c){for(var a=this.GetRemainCard(a,c),l=s;l<=3;l++){var g=3==l?3:5;ZeroMemory(o.getListByStep(l),g)}CopyMemory(o.getListByStep(s),c,c.length),3!=s&&(s++,this.AnalyseForamtion(e,t,r,a,a.length,s,n,o))},DataMgr.gameCtrl.AnalyseForamtion=function(e,t,r,a,i,s,n,o){var c=DataMgr.gameCtrl.GetType(a,i),l=!1;if(e>=CT_FIVE&&s<3)for(var g=0;g<c.btFiveSame;g++){var h=c.cbFiveSame[5*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<t||h==t&&firstColor<r||e!=CT_FIVE){for(var u=[],d=0;d<5;d++)u.push(c.cbFiveSame[5*g+d]);this.AnalyseForamtionRet(CT_FIVE,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_STRAIGHT_FLUSH_NO_A&&s<3)for(var g=0;g<c.btStraightFlush;g++){var h=c.cbStraightFlush[5*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<t||h==t&&firstColor<r||e!=CT_FIVE_STRAIGHT_FLUSH_NO_A){for(var u=[],d=0;d<5;d++)u.push(c.cbStraightFlush[5*g+d]);this.AnalyseForamtionRet(CT_FIVE_STRAIGHT_FLUSH_NO_A,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_FOUR_ONE&&s<3)for(var g=0;g<c.btFourSame;g++){var h=c.cbFourSame[4*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_FOUR_ONE){for(var u=[],d=0;d<4;d++)u.push(c.cbFourSame[4*g+d]);this.AnalyseForamtionRet(CT_FIVE_FOUR_ONE,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_THREE_DEOUBLE&&s<3)for(var g=0;g<c.btGourd;g++){var h=c.cbGourd[5*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_THREE_DEOUBLE){for(var u=[],d=0;d<5;d++)u.push(c.cbGourd[5*g+d]);this.AnalyseForamtionRet(CT_FIVE_THREE_DEOUBLE,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_FLUSH&&s<3)for(var g=0;g<c.btFlush;g++){var h=c.cbFlush[5*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_FLUSH){for(var u=[],d=0;d<5;d++)u.push(c.cbFlush[5*g+d]);this.AnalyseForamtionRet(CT_FIVE_FLUSH,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_MIXED_FLUSH_NO_A&&s<3)for(var g=0;g<c.btStraight;g++){var h=c.cbStraight[5*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_MIXED_FLUSH_NO_A){for(var u=[],d=0;d<5;d++)u.push(c.cbStraight[5*g+d]);this.AnalyseForamtionRet(CT_FIVE_MIXED_FLUSH_NO_A,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_THREE)for(var g=0;g<c.btThreeSame;g++){var h=c.cbThreeSame[3*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_THREE){for(var u=[],d=0;d<3;d++)u.push(c.cbThreeSame[3*g+d]);this.AnalyseForamtionRet(CT_THREE,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_FIVE_TWO_DOUBLE&&s<3)for(var g=0;g<c.btTwoPare;g++){var h=c.cbTwoPare[4*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_TWO_DOUBLE){for(var u=[],d=0;d<4;d++)u.push(c.cbTwoPare[4*g+d]);this.AnalyseForamtionRet(CT_FIVE_TWO_DOUBLE,h,firstColor,a,i,s,n,o,u),l=!0}}if(e>=CT_ONE_DOUBLE&&0==l)for(var g=0;g<c.btOnePare;g++){var h=c.cbOnePare[2*g];if(h=this.GetCardLogicValue(h),firstColor=this.GetCardColor(h),h<=t||e!=CT_FIVE_TWO_DOUBLE){for(var u=[],d=0;d<2;d++)u.push(c.cbOnePare[2*g+d]);this.AnalyseForamtionRet(CT_ONE_DOUBLE,h,firstColor,a,i,s,n,o,u),l=!0}}if(3==s||2==s&&0==l){var _=new tagCardForamtion;n.push(_),CopyMemory(_.third_list,o.third_list,o.third_list.length),CopyMemory(_.second_list,o.second_list,o.second_list.length),CopyMemory(_.first_list,o.first_list,o.first_list.length)}},DataMgr.gameCtrl.AnalyseCard=function(e,t,r){this.SortCardList(e,t,enDescend);for(var a=1,i=0,s=1,n=0,o=this.GetCardLogicValue(e[0]),c=this.GetCardColor(e[0]),l=1;l<t;l++){if(i=this.GetCardLogicValue(e[l]),i==o&&a++,i!=o||l==t-1)switch(a){case 1:break;case 2:r.bTwoFirst[r.bTwoCount]=n,r.bTwoCount++;break;case 3:r.bThreeFirst[r.bThreeCount]=n,r.bThreeCount++;break;case 4:r.bFourFirst[r.bFourCount]=n,r.bFourCount++;break;case 5:r.bFiveFirst[r.bFourCount]=n,r.bFiveCount++}i!=o&&(1==a?l!=t-1?(r.bOneFirst[r.bOneCount]=n,r.bOneCount++):(r.bOneFirst[r.bOneCount]=n,r.bOneCount++,r.bOneFirst[r.bOneCount]=l,r.bOneCount++):l==t-1&&(r.bOneFirst[r.bOneCount]=l,r.bOneCount++),a=1,o=i,n=l),this.GetCardColor(e[l])!=c?s=1:++s}1==t&&(r.bOneFirst[r.bOneCount]=0,r.bOneCount++),r.bFlush=t==s},DataMgr.gameCtrl.SortForamtion=function(e){var t=new Array(e.length);CopyMemory(t,e,e.length),this.SortCardList(t,t.length,enDescend);for(var r=DataMgr.gameCtrl.GetType(t,t.length);;){var a=[];if(0!=r.btFiveSame){CopyMemory(a,r.cbFiveSame,5);break}if(0!=r.btStraightFlush){CopyMemory(a,r.cbStraightFlush,5);break}if(0!=r.btFourSame){CopyMemory(a,r.cbFourSame,4);break}if(0!=r.btGourd){CopyMemory(a,r.cbGourd,5);break}if(0!=r.btFlush){CopyMemory(a,r.cbFlush,5);break}if(0!=r.btStraight){CopyMemory(a,r.cbStraight,5);break}if(0!=r.btThreeSame){CopyMemory(a,r.cbThreeSame,3);break}if(0!=r.btTwoPare){CopyMemory(a,r.cbTwoPare,4);break}if(0!=r.btOnePare){CopyMemory(a,r.cbOnePare,2);break}break}for(var i=[],s=0;s<a.length;s++)a[s]&&i.push(a[s]);for(var n=this.GetRemainCard(t,i),s=0;s<n.length;s++)i.push(n[s]);return i},DataMgr.gameCtrl.isSpecialCard=function(e,t,r){if(DataMgr.gameCtrl.deskInfo&&0==DataMgr.gameCtrl.deskInfo.is_spec_poker&&GAME_TYPE==GAME_TYPE_LS)return-1;var a=this.getRandCards(e);if(0!=a.length)return-1;var i=new tagAnalyseData;if(this.AnalyseCard(e,t,i),13==i.bOneCount&&1==i.bFlush)return CT_THIRTEEN_FLUSH;if(13==i.bOneCount)return CT_THIRTEEN;var s=this.isSpecialCard_CT_THREE_SIXPAIR(e,t,r,i);if(s!=-1)return s;var s=this.isSpecialCard_CT_THREE_FLUSH(e,r);if(s!=-1)return s;var s=this.isSpecialCard_CT_THREE_STRAIGHT(e,r);return s!=-1?s:0},DataMgr.gameCtrl.isSpecialCard_CT_THREE_SIXPAIR=function(e,t,r,a){return 6==a.bTwoCount||5==a.bTwoCount&&1==a.bThreeCount||4==a.bTwoCount&&1==a.bFourCount||3==a.bTwoCount&&1==a.bFourCount&&1==a.bThreeCount||2==a.bTwoCount&&2==a.bFourCount||1==a.bTwoCount&&2==a.bFourCount&&1==a.bThreeCount||3==a.bFourCount?CT_SIXPAIR:-1},DataMgr.gameCtrl.isSpecialCard_CT_THREE_FLUSH=function(e,t){var r=e.length,a=new Array(r);CopyMemory(a,e,r),this.SortCardList(a,r,enColor);var i=new Array;i.push([3,5,5]),i.push([5,3,5]),i.push([5,5,3]);for(var s=0;s<i.length;s++){var n=i[s],o=new Array,c=new Array,l=new Array,g=this.getFlushCard(a,o,n[0]);if(0!=o.length&&(g=this.getFlushCard(g,c,n[1]),0!=c.length&&(this.getFlushCard(g,l,n[2]),0!=l.length))){var h=this.GetCardColor(o[0]),u=this.GetCardColor(c[0]),d=this.GetCardColor(l[0]);if(0==s?(CopyMemory(t,o,3,10),CopyMemory(t,c,5,0),CopyMemory(t,l,5,5)):1==s?(CopyMemory(t,c,3,10),CopyMemory(t,o,5,0),CopyMemory(t,l,5,5)):2==s&&(CopyMemory(t,l,3,10),CopyMemory(t,o,5,0),CopyMemory(t,c,5,5)),h!=u&&u!=d&&h!=d)return CT_THREE_FLUSH}}return-1},DataMgr.gameCtrl.getANum=function(e){for(var t=0,r=0;r<4;r++)14==this.GetCardLogicValue(e[r])&&t++;return t},DataMgr.gameCtrl.MoveAToFront=function(e,t){var r=0,a=e.length;null==t&&(t=4);for(var i=0;i<4&&i<t;i++)14==this.GetCardLogicValue(e[i])&&r++;var s=new Array;CopyMemory(s,e,a-r,0,r);for(var i=0;i<r;i++)s.push(e[i]);return s},DataMgr.gameCtrl.isSpecialCard_CT_THREE_STRAIGHT=function(e,t){var r=e.length,a=(e[0],new Array(r));CopyMemory(a,e,r);var i=this.isThreeStraightCard(a,t);if(i!=-1)return i;for(var s=this.getANum(a),n=0;n<s;n++){var o=this.MoveAToFront(a,n+1),i=this.isThreeStraightCard(o,t);if(i!=-1)return i}return-1},DataMgr.gameCtrl.isThreeStraightCard=function(e,t){var r=new Array;r.push([3,5,5]),r.push([5,3,5]),r.push([5,5,3]);for(var a=0;a<r.length;a++){var i=r[a],s=new Array,n=new Array,o=new Array,c=this.getStraightCard(e,s,i[0]);if(0!=s.length&&(c=this.getStraightCard(c,n,i[1]),0!=n.length&&(this.getStraightCard(c,o,i[2]),0!=o.length)))return 0==a?(CopyMemory(t,s,3,10),CopyMemory(t,n,5,0),CopyMemory(t,o,5,5)):1==a?(CopyMemory(t,n,3,10),CopyMemory(t,s,5,0),CopyMemory(t,o,5,5)):2==a&&(CopyMemory(t,o,3,10),CopyMemory(t,s,5,0),CopyMemory(t,n,5,5)),CT_THREE_STRAIGHT}return-1},SGMsgTip=UILayer.extend({uiPath:"ui/base/MsgTip.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},setData:function(e){this.lab_txt&&this.lab_txt.setString(e.text)},show:function(){function e(e){t.close()}this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20),this.setCascadeOpacityEnabled(!0);var t=this,r=cc.p(0,40),a=cc.p(0,20);if(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE){var i=ModuleMgr.getScreenRotation();if(i==-90)var r=cc.p(-40,0),a=cc.p(-20,0);else if(90==i)var r=cc.p(40,0),a=cc.p(20,0)}this.runAction(cc.Sequence.create(cc.Spawn.create(cc.MoveBy.create(.4,r),cc.FadeIn.create(.3)),cc.DelayTime.create(1),cc.Spawn.create(cc.MoveBy.create(.2,a),cc.FadeOut.create(.2)),cc.CallFunc.create(e)))}}),SGMsgTip.create=function(e,t,r){return new SGMsgTip(e,t,r)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.TIP,SGMsgTip),SGMsgWait=QPLayer.extend({waitTime:2,uiPath:"ui/base/MsgWait.ui",_touchListener:null,ctor:function(e,t,r){e=e||this.uiPath,QPLayer.prototype.ctor.call(this,e,t,r);var a=this;this.setVisible(!1),0==this.waitTime?this.showAction():this.runAction(cc.Sequence.create(cc.DelayTime.create(SGMsgWait.waitTime),cc.CallFunc.create(function(){a.showAction()})))},updateTxt:function(e){this.lab_txt&&this.lab_txt.setString(e)},onEnter:function(){QPLayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),QPLayer.prototype.onExit.call(this)},showAction:function(){this.setVisible(!0),this.icon_wait&&this.icon_wait.runAction(cc.RepeatForever.create(cc.Sequence.create(cc.RotateBy.create(2,360))))},setData:function(e){this.lab_txt&&this.lab_txt.setString(e.text),this.isShowBg=e.black;var t=cc.size(3*cc.winSize.width,3*cc.winSize.height),r=cc.LayerColor.create(cc.color(0,0,0,150));r.setContentSize(t),r.setPositionX(-cc.winSize.width),r.setPositionY(-cc.winSize.height),this.addChild(r,-1),r.setOpacity(150),this.isShowBg&&(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,t){return!0}}),cc.eventManager.addListener(this._touchListener,this))},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),SGMsgWait.create=function(e,t){return new SGMsgWait(e,t)},SGMsgWait.waitTime=2,MsgMgr.registerMsg(MsgMgr.MSG_TYPE.WAIT,SGMsgWait),SGMsgConfirm=QPDlg.extend({uiPath:"ui/base/MsgConfirm.ui",_touchListener:null,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r);var a=cc.size(3*cc.winSize.width,3*cc.winSize.height),i=cc.LayerColor.create(cc.color(0,0,0,150));i.setContentSize(a),i.setPositionX(-cc.winSize.width),i.setPositionY(-cc.winSize.height),i.setOpacity(150),this.addChild(i,-1),this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(e,t){return!0}}),cc.eventManager.addListener(this._touchListener,this)},setData:function(e){if(this.data=e,null!=this.lab_txt&&null!=e&&(this.cancelFunc=e.cancelFunc,this.okFunc=e.okFunc,this.lab_txt.setString(e.text),e.time)){this.timer.setVisible(!0);var t=this,r=function(){t.okFunc&&t.okFunc.call(),t.close()};this.timer.setData(e.time,r)}},onLoaded:function(){this.ishideCancel&&this.hideCancel(),this.timer.setVisible(!1),this.setData(this.data);var e=this;this.addListener("SuccessMyShowCard",function(t){e.close()})},onEnter:function(){UILayer.prototype.onEnter.call(this)},onExit:function(){this._touchListener&&(cc.eventManager.removeListener(this._touchListener),this._touchListener=null),UILayer.prototype.onExit.call(this)},DoCancel:function(e){"ended"==e.name&&(this.cancelFunc&&this.cancelFunc.call(),this.close())},hideCancel:function(){this.ishideCancel=!0,this.btn_cancel&&(this.btn_cancel.setVisible(!1),this.btn_ok&&this.btn_ok.setPositionX(this.btn_cancel.getPositionX()/2+this.btn_ok.getPositionX()/2))},DoOk:function(e){"ended"==e.name&&(this.okFunc&&this.okFunc.call(),this.close())},show:function(){this.setAnchorPoint(.5,.5),this.setPositionX(cc.winSize.width/2),this.setPositionY(cc.winSize.height/2-20)}}),SGMsgConfirm.create=function(e,t,r){return new SGMsgConfirm(e,t,r)},MsgMgr.registerMsg(MsgMgr.MSG_TYPE.CONFIRM,SGMsgConfirm),UrlHead=UILayer.extend({ctor:function(e,t,r){UILayer.prototype.ctor.call(this,e,t,r)},setUrl:function(e){if(null!=e&&0!=e.length){var t=this;e=toDecodeURIComponent(e),e=e.substr(0,e.length-1)+"96",cc.loader.loadImg(e,{isCrossOrigin:!1},function(r,a){cc.log(e);var i=new cc.Sprite(a);t.head_icon.parent.addChild(i),i.x=t.head_icon.x,i.y=t.head_icon.y,i.scaleX=t.head_icon.scaleX,i.scaleY=t.head_icon.scaleY})}}}),UrlHead.create=function(e,t,r){return new UrlHead(e,t,r)},ModuleMgr.registerModule("UrlHead",UrlHead),MsgNotice=UILayer.extend({isControlNode:!0,uiPath:"ui/base/MsgNotice.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){var e=this;e.setVisible(!1),gInReview||DataMgr.recordCtrl.getScrollNotice(function(t){if(t&&t.length>0){for(var r="",a=0;a<t.length;a++){var i=t[a];r+=i.title+"  "+i.content+"     "}r&&(e.setVisible(!0),e.show(r))}})},show:function(e){this.lab_txt.setString(e);var t=this.img_bg.getContentSize();this.lab_txt.setPositionX(t.width+5);var r=this.lab_txt.getContentSize(),a=100,i=t.width+r.width+5,s=i/a,n=this;this.lab_txt.runAction(cc.Sequence.create(cc.MoveBy.create(s,cc.p(-i,0)),cc.CallFunc.create(function(){n.show(e)})))}}),MsgNotice.create=function(e,t,r){return new MsgNotice(e,t,r)},UIUtils.RegisterPathTemple("ui/base/MsgNotice.ui",MsgNotice),WxShareDlg=QPDlg.extend({uiPath:"ui/base/WxShareDlg.ui",isTouchClose:!0,ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t);var a=this;this.addListener("SuccessShareReturn",function(e){a.close()})},onLoaded:function(){var e=this.data.type||0;this.img_0&&this.img_0.setVisible(!1),this.img_1&&this.img_1.setVisible(!1),this.img_90_0&&this.img_90_0.setVisible(!1),this.img_90_1&&this.img_90_1.setVisible(!1),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_LANDSCAPE&&90==ModuleMgr.getScreenRotation()?(this.img_90_0&&this.img_90_0.setVisible(0==e),this.img_90_1&&this.img_90_1.setVisible(1==e)):(this.img_0&&this.img_0.setVisible(0==e),this.img_1&&this.img_1.setVisible(1==e))}}),WxShareDlg.create=function(e,t,r){return new WxShareDlg(e,t,r)},ModuleMgr.registerModule("WxShareDlg",WxShareDlg),LoginScene=cc.Scene.extend({onEnter:function(){this._super(),UIDataUtils.SetUIPrefix("res/"),UIDataUtils.SetLanguagePath("lang/lang.txt"),ModuleMgr.runDlg("LoginLayer")}}),LoginScene.create=function(){return new LoginScene},ModuleMgr.registerModule("LoginScene",LoginScene);var hasQueryParam=!1,hasQueryDeskParam=!1;LoginLayer=UILayer.extend({uiPath:"ui/Login.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){if(playMuisc("hall_bg1.mp3"),this.addListener(EVENT_ENTER_GAME,function(){ModuleMgr.removeWaitMsg(),ModuleMgr.runScene("EnterScene")}),this.btn_download.setVisible(!1),0==cc.sys.isNative&&cc.sys.os==cc.sys.OS_ANDROID,this.btn_weixin.setVisible(!1),platform.isInstalled()&&this.btn_weixin.setVisible(!0),isAgent()){this.btn_guest.setVisible(!1);var e=parseInt(getQueryString("guest"))||0;1==e&&this.btn_guest.setVisible(!0),gInReview&&this.btn_guest.setVisible(!0)}this.scheduleUpdate();var t=getQueryString("recordId")||"";if(t.length>1){var r=function(e){e&&e.lists&&DataMgr.recordCtrl.showRecordDetail(e.lists[0])};return void DataMgr.recordCtrl.getOneRecord(t,r)}do if(0==cc.sys.isNative&&0==hasQueryParam){var a=getQueryString("user"),i=getQueryString("password");if(hasQueryParam=!0,null==a||null==i)break;var s=parseInt(getQueryString("loginsuc")||0);if(1!=s){ModuleMgr.showConfirmTxtMsg("微信授权失败");break}return DataMgr.accountCtrl.wechatAccount=a,DataMgr.accountCtrl.wechatPass=i,void platform.doWechatLogin()}while(!1);var n=parseInt(getQueryString("desk"))||0;if(n>0&&0==hasQueryDeskParam)hasQueryDeskParam=!0,""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&platform.doWechatLogin();else if(""!=DataMgr.accountCtrl.wechatAccount&&""!=DataMgr.accountCtrl.wechatPass&&getTimestamp()-DataMgr.accountCtrl.lastLoginTime<platform.weixinTimeOut)return void platform.login();this.img_logo1&&this.img_logo1.setVisible(GAME_TYPE==GAME_TYPE_GP),this.img_logo2&&this.img_logo2.setVisible(GAME_TYPE==GAME_TYPE_GP);
},update:function(){platform.retCode&&(ModuleMgr.removeWaitMsg(),platform.loginCallback(platform.retCode),platform.retCode=null)},tap_btn_download:function(e){cc.sys.os==cc.sys.OS_ANDROID&&cc.sys.openURL("http://chessres.oss-cn-shanghai.aliyuncs.com/hotfire.apk")},tap_btn_weixin:function(e){platform.login()},tap_btn_guest:function(e){function t(){DataMgr.accountCtrl.isGuest=!0,DataMgr.accountCtrl.apilogin(DataMgr.accountCtrl.guestAccount,DataMgr.accountCtrl.guestPsw,function(e,t){e?ModuleMgr.showTipMsg(e):LOGIN_D.login(null,null)})}function r(e){0!=e.ret?ModuleMgr.showConfirmTxtMsg(e.error):(DataMgr.accountCtrl.guestAccount=e.user,DataMgr.accountCtrl.guestPsw=e.password),t()}return""!=DataMgr.accountCtrl.guestAccount&&""!=DataMgr.accountCtrl.guestPsw?void t():(DataMgr.accountCtrl.apiGuestLogin(r),void(0==cc.sys.isNative&&doMainShare()))}}),LoginLayer.create=function(e,t,r){return new LoginLayer(e,t,r)},ModuleMgr.registerModule("LoginLayer",LoginLayer),UIDataUtils.SetUIPrefix("res/");var HelloWorldLayer=cc.Layer.extend({sprite:null,ctor:function(){this._super();var e=(cc.winSize,UILayer.create("ui/test.ui"));return e.setPosition(0,0),this.addChild(e,0),!0}}),HelloWorldScene=cc.Scene.extend({onEnter:function(){this._super(),UIDataUtils.SetUIPrefix("res/"),UIDataUtils.SetLanguagePath("lang/lang.txt");var e=LoginLayer.create();this.addChild(e)}});ChatFaceItem=QPListItem.extend({uiPath:"ui/ChatFaceItem.ui",_data:null,_indexArr:[],ctor:function(e,t,r){e=e||this.uiPath,QPListItem.prototype.ctor.call(this,e,t,r)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(e){e||this.setVisible(!1),this._data=e;var t=e;this._indexArr=t;for(var r=0;r<4;r++){var a=this["item_face_"+r];a&&(t[r]?(a.setVisible(!0),a.loadTexture("res/uires/face/"+t[r]+".png")):a.setVisible(!1))}},sendFace:function(e){this._indexArr[e]&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",faceId:this._indexArr[e]}),cc.eventManager.dispatchCustomEvent("HideChatLayer"))},tap_item_face_0:function(){this.sendFace(0)},tap_item_face_1:function(){this.sendFace(1)},tap_item_face_2:function(){this.sendFace(2)},tap_item_face_3:function(){this.sendFace(3)}}),ChatFaceItem.create=function(e,t,r){return new ChatFaceItem(e,t,r)},UIUtils.RegisterPathTemple("ui/ChatFaceItem.ui",ChatFaceItem),ChatLayer=QPLayer.extend({uiPath:"ui/ChatLayer.ui",_curTag:0,list_1_item:null,ctor:function(e,t,r){e=e||this.uiPath,this.list_1_item=ChatTxtItem,QPLayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){this.refreshList({name:"list_1",list:chatCfgList}),this.list_1.setBounceEnabled(!0);for(var e=[],t=1;t<=20;t++){var r=Math.floor((t-1)/4),a=e[r]||[];a.push(t),e[r]=a}this.refreshList({name:"list_2",itemCell:ChatFaceItem,list:e}),this.list_2.setBounceEnabled(!0),this.selectTag(this._curTag)},selectTag:function(e){for(this._curTag=e,i=0;i<2;i++)this["btn_tap_"+i]&&this["btn_tap_"+i].setEnabled(i!=e);0==e?(this.list_1.setVisible(!0),this.list_2.setVisible(!1)):1==e&&(this.list_1.setVisible(!1),this.list_2.setVisible(!0))},tap_btn_hide:function(){this.setVisible(!1)},tap_btn_tap_0:function(){this.selectTag(0)},tap_btn_tap_1:function(){this.selectTag(1)},DoSpeak:function(e){return cc.sys.isNative||GAME_TYPE==GAME_TYPE_DD?void(SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT?ModuleMgr.getDlg("GameLayer").DoRecord(e):ModuleMgr.getDlg("L_GameLayer").DoRecord(e)):void("began"==e.name&&ModuleMgr.showTipMsg("此功能需下载安装原生游戏后方可使用"))}}),ChatLayer.create=function(e,t,r){return new ChatLayer(e,t,r)},UIUtils.RegisterPathTemple("ui/ChatLayer.ui",ChatLayer),ChatTxtItem=QPListItem.extend({uiPath:"ui/ChatTxtItem.ui",_txt:null,ctor:function(e,t,r){e=e||this.uiPath,QPListItem.prototype.ctor.call(this,e,t,r)},onLoaded:function(){QPListItem.prototype.onLoaded.call(this)},setData:function(e){e||this.setVisible(!1),this._txt=e,this.lab_txt.setString(this._txt)},tap_tap_touch:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",txt:this._txt}),cc.eventManager.dispatchCustomEvent("HideChatLayer")}}),ChatTxtItem.create=function(e,t,r){return new ChatTxtItem(e,t,r)},UIUtils.RegisterPathTemple("ui/ChatTxtItem.ui",ChatTxtItem),EnterScene=cc.Scene.extend({onEnter:function(){this._super(),ModuleMgr.runDlg("MainLayer",function(){})}}),EnterScene.create=function(){return new EnterScene},ModuleMgr.registerModule("EnterScene",EnterScene),EnterLayer=UILayer.extend({uiPath:"ui/LoginSuccess.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){this.txt_name.setString(DataMgr.accountCtrl.lastAccount)},DoStartGame:function(e){if(WsNetwork.getInstance().initNetwork(),"ended"==e.name){var t=this;ModuleMgr.runDlg("MainLayer",function(){t.close()})}},DoLogout:function(e){"ended"==e.name&&ModuleMgr.runScene("LoginScene")},tap_btn_weixin:function(e){console.log("tap_btn_weixin 11111111111111111111111")}}),EnterLayer.create=function(e,t,r){return new EnterLayer(e,t,r)},ModuleMgr.registerModule("EnterLayer",EnterLayer),GameScene=cc.Scene.extend({onExit:function(){this._super(),DataMgr.gameCtrl.clearData(),SCREEN_CUR_ORIENTATION=SCREEN_ORIENTATION_PROTRAIT},onEnter:function(){this._super(),SCREEN_CUR_ORIENTATION=DataMgr.gameCtrl.getSceenOrientation(),ModuleMgr.runOrientationDlg("GameLayer")}}),GameScene.create=function(){return new GameScene},ModuleMgr.registerModule("GameScene",GameScene),GameLayer=UILayer.extend({uiPath:"ui/Game.ui",musicDt:0,updateDt:0,wheelTable:{},isPlaying:!1,isAllUILoaded:!1,eventStack:{},isScreenRotationDirty:!1,isDissolve:!1,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r),this.addGameEvent(),this.scheduleUpdate()},addGameEvent:function(){var e=this;this.addListener("SuccessOwnLeaveDesk",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessOwnLeaveDesk=t.getUserData()):void(e.isDissolve||ModuleMgr.runScene("EnterScene"))}),this.addListener("SuccessDissolve",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessDissolve=t.getUserData()):void(DataMgr.gameCtrl.deskInfo&&DataMgr.gameCtrl.deskInfo.cur_round>1&&(e.isDissolve=!0,ModuleMgr.closeDlg("GameDissolve"),e.gameOver()))}),this.addListener("SuccessStartPlayRecord",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessStartPlayRecord=t.getUserData());var r=t.getUserData(),a=DataMgr.gameCtrl.deskChat[r];e["role_card"+a]&&e["role_card"+a].showTalk()}),this.addListener("SuccessEndPlayRecord",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessEndPlayRecord=t.getUserData());var r=t.getUserData(),a=DataMgr.gameCtrl.deskChat[r];e["role_card"+a]&&e["role_card"+a].stopTalk()}),this.addListener("SuccessPlayChatTxt",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessPlayChatTxt=t.getUserData());var r=t.getUserData(),a=r.chair;e["role_card"+a]&&e["role_card"+a].showChatLab(r.txt)}),this.addListener("SuccessPlayChatFace",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessPlayChatFace=t.getUserData());var r=t.getUserData(),a=r.chair;e["role_card"+a]&&e["role_card"+a].showChatFace(r.faceId)}),this.addListener("HideChatLayer",function(t){return 0==e.isAllUILoaded?void(e.eventStack.HideChatLayer=t.getUserData()):void e.hideChatLayer()}),this.addListener("SuccessEnterDesk",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessEnterDesk=t.getUserData());var r=t.getUserData();r?e.refreshPlayers():e.refreshPlayersOnline()}),this.addListener("SuccessCompareEnd",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessCompareEnd=t.getUserData());var r=t.getUserData(),a=DataMgr.gameCtrl.getChairIdByWheelIdx(r.idx);e["role_card"+a]&&e["role_card"+a].compareEnd()}),this.addListener("SuccessLeaveDesk",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessLeaveDesk=t.getUserData());var r=t.getUserData();r?e.refreshPlayers():e.refreshPlayersOnline()}),this.addListener("SUCCECES_ROOM_CREATE",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SUCCECES_ROOM_CREATE=t.getUserData()):void e.reBuyCardStart()}),this.addListener("SuccessStartGame",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessStartGame=t.getUserData()):(e.SuccessStartGame(),void e.refreshRoomState())}),this.addListener("SuccessRefreshRoomState",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessRefreshRoomState=t.getUserData()):void e.refreshRoomState()}),this.addListener("SuccessPreStartGame",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessPreStartGame=t.getUserData())}),this.addListener("SuccessGameEnd",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessGameEnd=t.getUserData()):(e.checkContinueBuy(),e.isPlaying=!1,void e.refreshRoomState())}),this.addListener("SuccessUserReady",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessUserReady=t.getUserData());var r=t.getUserData();r.idx==DataMgr.gameCtrl.myWheelIdx&&e.btn_ready.setVisible(!1);var a=DataMgr.gameCtrl.getChairIdByWheelIdx(r.idx);e["role_card"+a]&&e["role_card"+a].setReady(1)}),this.addListener("SuccessCompareCard",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessCompareCard=t.getUserData()):void e.OnCompare()}),this.addListener("SuccessDoSelect",function(t){return 0==e.isAllUILoaded?void(e.eventStack.SuccessDoSelect=t.getUserData()):(e.SuccessPreStartGame(),void e.onShowSelect())}),this.addListener("SuccessShowCard",function(t){if(0==e.isAllUILoaded)return void(e.eventStack.SuccessShowCard=t.getUserData());var r=t.getUserData();e["role_card"+r]&&e["role_card"+r].cardSelected();var a=DataMgr.gameCtrl.getChairIdByWheelIdx(DataMgr.gameCtrl.myWheelIdx);a==r&&cc.eventManager.dispatchCustomEvent("SuccessMyShowCard")})},onExit:function(){UILayer.prototype.onExit.call(this)},onShowSelect:function(){function e(){0==DataMgr.gameCtrl.isOwer()&&t.tap_btn_rate1()}var t=this;if(1==DataMgr.gameCtrl.deskInfo.score_max_ratio)return void t.tap_btn_rate1();0==DataMgr.gameCtrl.isOwer()&&t.panel_rate.setVisible(!0);for(var r=1;r<=3;r++)t["btn_rate"+r].setOpacity(100),t["btn_rate"+r].setTouchEnabled(!1);for(var r=1;r<=DataMgr.gameCtrl.deskInfo.score_max_ratio;r++)t["btn_rate"+r].setOpacity(255),t["btn_rate"+r].setTouchEnabled(!0);for(var r=1;r<=MAX_ROLE_NUM;r++)t["role_card"+r]&&t["role_card"+r].isVisible()&&t["role_card"+r].setWait();t.score_container.setVisible(!1),DataMgr.gameCtrl.startTime=getTimestamp(),t.timer.setVisible(!0),t.timer.setData(10,e)},refreshRoomState:function(){this.btn_back.setVisible(!1),this.btn_close.setVisible(!1),this.btn_do_start.setVisible(!1),this.btn_invite.setVisible(!1),this.isPlaying?(this.btn_close.setVisible(!0),this.btn_close.x=this.btn_back.x):(this.btn_back.setVisible(!0),DataMgr.gameCtrl.getPlayerNum()<MAX_ROLE_NUM&&this.btn_invite.setVisible(!0),DataMgr.gameCtrl.isOwer()&&(DataMgr.gameCtrl.getPlayerNum()>1&&this.btn_do_start.setVisible(!0),this.btn_close.setVisible(!0),this.btn_close.x=this.btn_close.orgX));for(var e=1;e<=MAX_ROLE_NUM;e++)this["role_card"+e]&&(this["role_card"+e].btn_out.setVisible(!1),0==this.isPlaying&&e!=MAX_ROLE_NUM&&DataMgr.gameCtrl.isOwer()&&this["role_card"+e].head.isVisible()&&this["role_card"+e].btn_out.setVisible(!0));this.refreshRate()},onPackerInited:function(){function e(){var e=[],t=DataMgr.gameCtrl.isSpecialCard(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,e);if(t>0){var r=function(){DataMgr.gameCtrl.runFormation()};DataMgr.gameCtrl.checkSpeicalCard(t,e,r)}else DataMgr.gameCtrl.runFormation()}function t(){}var r=DataMgr.gameCtrl.getChairIdxByRid(DataMgr.gameCtrl.myWheelInfo.rid);this["role_card"+r].startGame(),playEffect("poker_deal.mp3"),this.score_container.setVisible(!1),this.runAction(cc.Sequence.create(cc.DelayTime.create(1),cc.CallFunc.create(e)));DataMgr.gameCtrl.startTime=getTimestamp(),this.timer.setVisible(!0),this.timer.setData(FORMATION_TIME,t)},refreshRound:function(){if(DataMgr.gameCtrl.deskInfo){DataMgr.gameCtrl.deskInfo.cur_round>DataMgr.gameCtrl.deskInfo.full_round&&(DataMgr.gameCtrl.deskInfo.cur_round=DataMgr.gameCtrl.deskInfo.full_round),this.txt_round&&this.txt_round.setString(DataMgr.gameCtrl.deskInfo.cur_round+"/"+DataMgr.gameCtrl.deskInfo.full_round);var e="";GAME_TYPE==GAME_TYPE_LS?(e=DataMgr.gameCtrl.getIsSpecialName(DataMgr.gameCtrl.deskInfo.is_spec_poker)+"  "+DataMgr.gameCtrl.getMasterName(DataMgr.gameCtrl.deskInfo.is_master_mode)+"  "+DataMgr.gameCtrl.getCrazyName(DataMgr.gameCtrl.deskInfo.crazy_lv)+"  "+DataMgr.gameCtrl.getJoke(DataMgr.gameCtrl.deskInfo.has_joker)+"  "+DataMgr.gameCtrl.getRedFive(DataMgr.gameCtrl.deskInfo.check_maker_poker,DataMgr.gameCtrl.deskInfo.has_more_color),this.txt_game_type&&this.txt_game_type.setString(e)):(e=DataMgr.gameCtrl.getAreaName(DataMgr.gameCtrl.deskInfo.area)+"  "+DataMgr.gameCtrl.getMasterName(DataMgr.gameCtrl.deskInfo.is_master_mode)+"  "+DataMgr.gameCtrl.getCrazyName(DataMgr.gameCtrl.deskInfo.crazy_lv)+"  "+DataMgr.gameCtrl.getJoke(DataMgr.gameCtrl.deskInfo.has_joker)+"  "+DataMgr.gameCtrl.getRedFive(DataMgr.gameCtrl.deskInfo.check_maker_poker,DataMgr.gameCtrl.deskInfo.has_more_color),this.txt_game_type&&this.txt_game_type.setString(e));var t=DataMgr.gameCtrl.getColor(DataMgr.gameCtrl.deskInfo.has_more_color)+"  房卡"+DataMgr.gameCtrl.getWinName(DataMgr.gameCtrl.deskInfo.is_win_cost_mode)+"  "+DataMgr.gameCtrl.getAutoPoker(DataMgr.gameCtrl.deskInfo.is_auto_deal);this.txt_game_other&&this.txt_game_other.setString(t),SCREEN_CUR_ORIENTATION!=SCREEN_ORIENTATION_PROTRAIT&&(this.txt_game_other&&this.txt_game_other.setString(""),this.lab_game_other&&this.lab_game_other.setString(""),this.txt_game_type&&this.txt_game_type.setString(e+"  "+t));var r=0;this.txt_game_type&&(r=this.txt_game_type.getContentSize().width),this.txt_game_other&&this.txt_game_other.getContentSize().width>r&&(r=this.txt_game_other.getContentSize().width),r+=95}},reBuyCardStart:function(){this.refreshRound(),this.refreshDesk(),this.refreshRoomState();for(var e=1;e<=MAX_ROLE_NUM;e++){var t=DataMgr.gameCtrl.players[e];if(t){var r=DataMgr.gameCtrl.getChairIdxByRid(t.info.rid);this["role_card"+r]&&(this["role_card"+r].setScore(0),this["role_card"+r].setWait())}}this.tap_btn_ready(),this.showTxtScore(!1)},tap_btn_rate1:function(){this.panel_rate.setVisible(!1),this.timer.stop(),this.timer.setVisible(!1),ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"select_compare",compare_score:1})},tap_btn_rate2:function(){this.panel_rate.setVisible(!1),ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"select_compare",compare_score:2}),this.timer.stop(),this.timer.setVisible(!1)},tap_btn_rate3:function(){this.panel_rate.setVisible(!1),ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"select_compare",compare_score:3}),this.timer.stop(),this.timer.setVisible(!1)},checkContinueBuy:function(){this.gameOver()},gameOver:function(){},SuccessPreStartGame:function(){this.isPlaying=!0,this.refreshRound(),this.refreshRoomState(),this.btn_ready.setVisible(!1),this.btn_invite.setVisible(!1)},SuccessStartGame:function(){function e(){for(var e=1;e<=MAX_ROLE_NUM;e++)DataMgr.gameCtrl.deskPlayers[e]&&(a["role_card"+e].startGame(),a["role_card"+e].setReady(0),a["role_card"+e].setLocalZOrder(e-6));a.onStartGame()}if(DataMgr.gameCtrl.deskInfo.cur_round>DataMgr.gameCtrl.deskInfo.full_round)return void this.refreshRound();this.isPlaying=!0;for(var t=1;t<=MAX_ROLE_NUM;t++){var r=DataMgr.gameCtrl.wheelInfos[t];r&&(r.is_show_card=0)}var a=this;this.panel_rate&&this.panel_rate.setVisible(!1),ModuleMgr.runDlg("GameStart",{callback:e},null,null),this.refreshRound()},onStartGame:function(){0==DataMgr.gameCtrl.myWheelInfo.is_show_card&&this.onPackerInited(),this.btn_ready.setVisible(!1),this.btn_invite.setVisible(!1)},OnCompare:function(){for(var e=DataMgr.gameCtrl.roundScore,t=this,r=[],a=1;a<=MAX_ROLE_NUM;a++)if(this["role_card"+a]&&(this["role_card"+a].card_tag=a,DataMgr.gameCtrl.deskPlayers[a])){var i=DataMgr.gameCtrl.deskPlayers[a].wheel_idx,s=DataMgr.gameCtrl.wheelInfos[i];s&&(s.card=DataMgr.gameCtrl.allPockerList[i-1]),this["role_card"+a].compareCards(DataMgr.gameCtrl.allPockerList[i-1]),this["role_card"+a].stopAllActions(),this["role_card"+a].canView=!1,0==this["role_card"+a].card.isVisible()&&this["role_card"+a].cardSelected(),this["role_card"+a].card.clearCards(),this["role_card"+a].spec_type&&this["role_card"+a].spec_type>0&&r.push(this["role_card"+a])}this.score_container.setVisible(!0),this.showTxtScore(!1),this.icon_compare.setVisible(!0);var n=function(e,t){return e.spec_type-t.spec_type};r.sort(n);var o=function(e){e.showStepCards(1)},c=function(e){e.showStepCards(2)},l=function(e){e.showStepCards(3)},g=function(){t.icon_compare.setVisible(!1)},h=0,u=!0,d=function(e,r){u&&(t.setTxtScore(r.score,r.idx,r.add_score),h+=r.score,h+=r.add_score,t.setTxtScore(h,0,0))},_=1/GAME_SHOW_CARD_SPEED,m=1.5/GAME_SHOW_CARD_SPEED;this.runAction(cc.Sequence.create(cc.DelayTime.create(1),cc.CallFunc.create(g))),playEffect(MUSIC_TYPE+"/start_compare.mp3");for(var a=1;a<=3;a++){for(var p=[],f=1;f<=MAX_ROLE_NUM;f++){var C={};C.score=e["rank"+a]["idx"+f],C.idx=f,p.push(C)}p.sort(function(e,t){return e.score-t.score});for(var f=0;f<p.length;f++){var M=p[f],E=DataMgr.gameCtrl.getChairIdByWheelIdx(M.idx);DataMgr.gameCtrl.deskPlayers[E]&&(this["role_card"+E].isSpecialCard||0)<0&&(1==a?this["role_card"+E].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(o))):2==a?this["role_card"+E].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(c))):3==a&&this["role_card"+E].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(l))),_+=m)}var y={};y.score=e["rank"+a]["idx"+DataMgr.gameCtrl.myWheelIdx],y.add_score=e["rank"+a]["spec"+DataMgr.gameCtrl.myWheelIdx],y.idx=a,this["score"+a].runAction(cc.Sequence.create(cc.DelayTime.create(_-m),cc.CallFunc.create(d,null,y)))}var T=function(e){return null==e.spec_type?"":(e.setSpecialCard(e.spec_type),e.showCompareCards(),t.scaleItem(e.card.icon_special),playEffect(MUSIC_TYPE+"/special"+e.spec_type+".mp3"),void t.addSceenEffect("special"+e.spec_type))},S=function(e,r){h+=r,t.setTxtScore(h,0,0)};if(1==DataMgr.gameCtrl.deskInfo.is_master_mode)for(var v=this.getOwerWheelIdx(),a=0;a<r.length;a++){var i=r[a].wheelIdx;r[a].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(T))),_+=2.5;var b=0;i==DataMgr.gameCtrl.myWheelIdx?b=e["spec_score"+v]["idx"+i]||0:DataMgr.gameCtrl.myWheelIdx==v?b=-e["spec_score"+v]["idx"+i]||0:i==v&&(b=e["spec_score"+v]["idx"+DataMgr.gameCtrl.myWheelIdx]||0),r[a].wheelIdx==DataMgr.gameCtrl.myWheelIdx&&(u=!1),r[a].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(S,null,b)))}else for(var a=0;a<r.length;a++){r[a].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(T))),_+=2.5;var i=r[a].wheelIdx,b=e["spec_score"+i]["idx"+DataMgr.gameCtrl.myWheelIdx];r[a].wheelIdx==DataMgr.gameCtrl.myWheelIdx&&(u=!1),r[a].runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(S,null,b)))}r.length>0&&(_+=.5);var D=function(e,t){e.gunCard=t.gunCard,e.addGun()},A=function(e,r){e.wheelIdx==DataMgr.gameCtrl.myWheelIdx&&(h+=r.gunScore,t.setTxtScore(h,0,0)),e.gunCard.wheelIdx==DataMgr.gameCtrl.myWheelIdx&&(h-=r.gunScore,t.setTxtScore(h,0,0))},v=-1,I=DataMgr.gameCtrl.getPlayerByRid(DataMgr.gameCtrl.deskInfo.desk_own_rid);if(I&&(v=I.wheel_idx),e.gank_info)for(var a=1;a<=MAX_ROLE_NUM;a++)for(var f=1;f<=MAX_ROLE_NUM;f++)if((1!=DataMgr.gameCtrl.deskInfo.is_master_mode||a==v||f==v)&&e.gank_info["gank"+a+f]>0){var R=this["role_card"+DataMgr.gameCtrl.getChairIdByWheelIdx(a)],P=this["role_card"+DataMgr.gameCtrl.getChairIdByWheelIdx(f)],y={};y.gunCard=P,y.gunScore=e.gank_info["gank"+a+f],R.runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(D,null,y))),_+=1,R.runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(A,null,y))),_+=1}var x=0,L=function(r){x=e.allkill["idx"+DataMgr.gameCtrl.myWheelIdx],t.addSceenEffect("killall"),playEffect(MUSIC_TYPE+"/special2.mp3")};if(e.allkill)for(var a=1;a<=MAX_ROLE_NUM;a++){var G=e.allkill["idx"+a];G>0&&(this.runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(L))),_+=3)}var w=function(){0!=x&&(h+=x,t.setTxtScore(h,0,0)),t.showMoveCoin()};this.timer.setVisible(!1),t.timer.stop(),this.runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(w)))},getOwerWheelIdx:function(){var e=-1,t=DataMgr.gameCtrl.getPlayerByRid(DataMgr.gameCtrl.deskInfo.desk_own_rid);return t&&(e=t.wheel_idx),e},addSceenEffect:function(e){var t=ccs.Armature.create(e);t.getAnimation().play("stand",-1,-1),t.setScale(1.8),t.getAnimation().setMovementEventCallFunc(this.animationEvent,this),this.special_container.addChild(t),this.special_container.setLocalZOrder(100)},animationEvent:function(e,t,r){t==ccs.MovementEventType.complete&&e.removeFromParent()},tap_btn_do_start:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"start_game"})},tap_btn_showcards:function(){this["role_card"+MAX_ROLE_NUM]&&this["role_card"+MAX_ROLE_NUM].viewCard&&this["role_card"+MAX_ROLE_NUM].viewCard(DataMgr.gameCtrl.viewCards)},showMoveCoin:function(){var e=DataMgr.gameCtrl.roundScore,t=[],r=this,a=function(){for(var t=1;t<=MAX_ROLE_NUM;t++){var a=e.score["idx"+t],i=DataMgr.gameCtrl.getChairIdByWheelIdx(t),s=r["role_card"+i],n=DataMgr.gameCtrl.curScore["idx"+t];s&&r["score_show"+i]&&(s.setScore&&s.setScore(n),r["score_show"+i].setVisible(!0),r["score_show"+i].setScore(a),r["score_show"+i].setScale(1.5),r["score_show"+i].setPositionY(r["score_show"+i].orgY-30),r["score_show"+i].runAction(cc.Sequence.create(cc.MoveBy.create(.5,cc.p(0,30)),cc.DelayTime.create(.5),cc.Hide.create())))}};playEffect("coin_show.mp3");var i=function(e){var t=e.idx;0==r.musicDirty&&(r.musicDirty=!0,r["role_card"+t].showCoinEffect(),playEffect("coin_income.mp3"))};if(e){for(var s=this.coin0.getPosition(),n=1;n<=MAX_ROLE_NUM;n++){var o=e.score["idx"+n],c=this["coin"+DataMgr.gameCtrl.getChairIdByWheelIdx(n)];if(o<0)for(var l=0;l<2*-o;l++){var g=cc.Sprite.create(GetRealPath("res/uires/game/coin.png"));g.scale=.7,g.x=c.x+50*Math.random(),g.y=c.y+50*Math.random(),c.parent.addChild(g),g.setLocalZOrder(100),t.push(g)}}for(var h=0,n=1;n<=MAX_ROLE_NUM;n++){var o=e.score["idx"+n],u=DataMgr.gameCtrl.getChairIdByWheelIdx(n),c=this["coin"+DataMgr.gameCtrl.getChairIdByWheelIdx(n)];if(o>0)for(var l=0;l<2*o;l++)g=t[h],g&&(g.idx=u,g.runAction(cc.sequence(cc.delayTime(.3*Math.random()),cc.fadeIn(.3),cc.moveTo(.3,cc.p(s.x+70*Math.random(),s.y+70*Math.random())),cc.delayTime(.5),cc.delayTime(.3*Math.random()),cc.callFunc(i),cc.spawn(cc.moveTo(.3,cc.p(c.x,c.y))),cc.removeSelf())),h++)}for(var l=h;l<t.length;l++)t[l].removeFromParent()}var d=function(){function e(){r.tap_btn_continue()}a();var t=5;r.getRealNum()>5&&(t=10),r.timer.setVisible(!0),r.timer.setData(t,e);for(var i=1;i<=MAX_ROLE_NUM;i++)r["role_card"+i].clearGunHole();r.panel_continue.setVisible(!0)};t.length>0?this.runAction(cc.Sequence.create(cc.DelayTime.create(2),cc.CallFunc.create(d))):this.runAction(cc.Sequence.create(cc.DelayTime.create(1),cc.CallFunc.create(d)))},getRealNum:function(){for(var e=0,t=0;t<MAX_ROLE_NUM;t++)DataMgr.gameCtrl.players[t]&&e++;return e},tap_btn_continue:function(){this.timer.setVisible(!1),this.timer.stop(),this.panel_continue.setVisible(!1),ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"compare_end"})},refreshRate:function(){for(var e=1;e<=MAX_ROLE_NUM;e++)this["role_card"+e]&&this["role_card"+e].setRate(-1);if(1==DataMgr.gameCtrl.deskInfo.is_master_mode)for(var e=1;e<=MAX_ROLE_NUM;e++){var t=DataMgr.gameCtrl.wheelInfos[e];if(t&&t.rid!=DataMgr.gameCtrl.deskInfo.desk_own_rid&&t.compare_score){var r=DataMgr.gameCtrl.getChairIdByWheelIdx(e);this["role_card"+r]&&this["role_card"+r].setRate(t.compare_score)}}},refreshDesk:function(){DataMgr.gameCtrl.sortPlayers(),this.txt_desk_idx.setString(DataMgr.gameCtrl.deskIdx);var e=null;DataMgr.gameCtrl.deskInfo&&(e=DataMgr.gameCtrl.deskInfo.desk_own_rid),null==e&&(e=-1);var t=DataMgr.gameCtrl.getPlayerByRid(e);if(t?this.txt_owner_name.setString(toDecodeURIComponent(t.info.name)):this.txt_owner_name.setString(""),DataMgr.gameCtrl.deskInfo){this.txt_role_num.setString(DataMgr.gameCtrl.getPlayerNum()+"/"+DataMgr.gameCtrl.deskInfo.full_num);for(var r=1;r<=MAX_ROLE_NUM;r++)this["role_card"+r]&&this["role_card"+r].setOwner(e)}},onLoaded:function(){this.icon_compare.setVisible(!1),this.btn_ready.setVisible(!1),this.refreshRound(),this.onAllUiLoaded(),this.hideChatLayer(),this.refreshDesk(),0==cc.sys.isNative&&doGameShare();var e=this,t=function(t){e.isScreenRotationDirty=!0};this.addListener("screen_change",t),this.isAllUILoaded=!0;for(var r in this.eventStack)cc.eventManager.dispatchCustomEvent(r,this.eventStack[r])},tap_btn_back:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})},tap_do_invite:function(){var e=DataMgr.gameCtrl.getMasterName(DataMgr.gameCtrl.deskInfo.is_master_mode),t=DataMgr.gameCtrl.getWinName(DataMgr.gameCtrl.deskInfo.is_win_cost_mode);platform.share("房号:"+DataMgr.gameCtrl.deskIdx+" 模式:"+e+" 房费:"+t,getShareInfo(),getShareUrl(DataMgr.gameCtrl.deskIdx,0)+"&oncestr="+DataMgr.gameCtrl.deskInfo.oncestr,0,SHARE_URL+"ttw/res/icon/invite3.png")},tap_btn_close:function(){var e=function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"apply_dissolve"})},t=function(){};ModuleMgr.showConfirmCancelMsg("是否要解散房间?",e,t)},refreshPlayersOnline:function(){if(DataMgr.gameCtrl.deskPlayers)for(var e=1;e<=MAX_ROLE_NUM;e++)if(DataMgr.gameCtrl.deskPlayers[e]){var t=DataMgr.gameCtrl.deskPlayers[e].wheel_idx;this["role_card"+e]&&this["role_card"+e].setOnline(DataMgr.gameCtrl.online[t])}},update:function(e){if(this.musicDt+=e,this.musicDt>=.2&&(this.musicDt=0,this.musicDirty=!1),this.isScreenRotationDirty&&(this.isScreenRotationDirty=!1,0==cc.sys.isNative&&__BrowserGetter)){var t=__BrowserGetter.availWidth(cc.EGLView._getInstance()._frame),r=__BrowserGetter.availHeight(cc.EGLView._getInstance()._frame);return t>r?DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE):DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT),this.close(),ModuleMgr.runOrientationDlg("GameLayer"),void(t>r&&ModuleMgr.showConfirmTxtMsg("手机锁定屏幕,体验更佳 "))}if(this.updateDt+=e,!(this.updateDt<.2)){if(this.updateDt-=.2,1==this.endRecord&&Date.parse(new Date)-this.recordTime>800&&(this.txt_record.setVisible(!1),this.endRecord=!1,platform.stopRecord()),1==this.startRecord){if(this.startRecord=!1,this.endRecord)return;platform.startRecord()}platform.retRecordStartPlay&&(cc.eventManager.dispatchCustomEvent("SuccessStartPlayRecord",platform.retRecordStartPlay),platform.retRecordStartPlay=null),platform.retRecordEndPlay&&(cc.eventManager.dispatchCustomEvent("SuccessEndPlayRecord",platform.retRecordEndPlay),platform.retRecordEndPlay=null),platform.retRecordUploaded&&(ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"chat",media_id:DOWN_RECORD_SERVER+"/apidown?file="+platform.retRecordUploaded,platform:"native"}),platform.retRecordUploaded=null)}},DoRecord:function(e){"began"==e.name?(this.startRecord=!0,this.endRecord=!1,this.recordTime=Date.parse(new Date),this.txt_record.setVisible(!0)):"ended"!=e.name&&"canceled"!=e.name||(this.endRecord=!0)},refreshPlayers:function(){console.log("refreshPlayers"),DataMgr.gameCtrl.sortPlayers(),this.bg.setLocalZOrder(-12),this.img_logo.setLocalZOrder(-12),this.txt_container.setLocalZOrder(-11);for(var e=1;e<=MAX_ROLE_NUM;e++)if(this["role_card"+e])if(this["role_card"+e].card_tag=e,this["score_show"+e].orgY=this["score_show"+e].getPositionY(),this["score_show"+e].setVisible(!1),DataMgr.gameCtrl.deskPlayers[e]){var t=DataMgr.gameCtrl.deskPlayers[e].wheel_idx;this["role_card"+e].wheelIdx=t;var r=DataMgr.gameCtrl.wheelInfos[t];if(!r)continue;this["role_card"+e].setData(DataMgr.gameCtrl.deskPlayers[e]),this["role_card"+e].setReady(r.is_ready),this["role_card"+e].setLocalZOrder(e-9),DataMgr.gameCtrl.curScore&&this["role_card"+e]&&this["role_card"+e].setScore(DataMgr.gameCtrl.curScore["idx"+t]),t==DataMgr.gameCtrl.myWheelIdx&&(DataMgr.gameCtrl.viewCards=r.card),"deal_end"==DataMgr.gameCtrl.deskInfo.cur_step?(1==r.is_show_card?this["role_card"+e].cardSelected():this["role_card"+e].formationCard(),this["role_card"+e].setReady(0)):"show_finish"==DataMgr.gameCtrl.deskInfo.cur_step&&(1!=r.is_compare_end?(this["role_card"+e].cardSelected(),this["role_card"+e].txt_compare.setVisible(!0)):this["role_card"+e].compareEnd(),this["role_card"+e].setReady(0))}else this["role_card"+e].setEmpty();this.refreshPlayersOnline(),this.refreshDesk(),this.refreshRoomState()},tap_btn_formation:function(){DataMgr.gameCtrl.runFormation()},showAllCard:function(){for(var e=1;e<=MAX_ROLE_NUM;e++){var t=DataMgr.gameCtrl.wheelInfos[e];if(t){var r=DataMgr.gameCtrl.getChairIdxByRid(t.rid);r!=-1&&(this["role_card"+r].showCards(t.poker_list),this["role_card"+r].spec_type=t.card.spec_type,t.card.spec_type?this["role_card"+r].setSpecialCard(t.card.spec_type):this["role_card"+r].setSpecialCard(-1),this["role_card"+r].canView=!0,this["role_card"+r].viewCard(t.card),cc.log("view card",r))}}this.score_container.setVisible(!0);var r=DataMgr.gameCtrl.myWheelIdx,a=DataMgr.gameCtrl.roundScore;if(a){for(var e=1;e<=3;e++){var i=a["rank"+e]["idx"+r],s=a["rank"+e]["spec"+r];this.setTxtScore(i,e,s)}this.setTxtScore(a.score["idx"+r],0,a.score["spec"+r])}this.showTxtScore(!0)},showTxtScore:function(e){for(var t=0;t<=3;t++)this["txt_title"+t].setVisible(e),this["score"+t].setVisible(e),this["score_add"+t]&&this["score_add"+t].setVisible(e),this["kh_left"+t]&&this["kh_left"+t].setVisible(e),this["kh_right"+t]&&this["kh_right"+t].setVisible(e)},setTxtScore:function(e,t,r){this["score"+t].setVisible(!0),this["score_add"+t]&&this["score_add"+t].setVisible(!0),this["kh_left"+t]&&this["kh_left"+t].setVisible(!0),this["kh_right"+t]&&this["kh_right"+t].setVisible(!0),this["txt_title"+t].setVisible(!0);var a=this["score"+t];a&&a.setScore(e);var i=this["score_add"+t];i&&i.setScore(r),0==t&&this.scaleItem(this["score"+t])},scaleItem:function(e){e.stopActionByTag(1),e.orgScaleX=e.scaleX,e.orgScaleY=e.scaleY;var t=cc.sequence(cc.scaleTo(.3,2*e.orgScaleX,2*e.orgScaleY),cc.scaleTo(.1,.7*e.orgScaleX,.7*e.orgScaleY),cc.scaleTo(.07,e.orgScaleX,e.orgScaleY));t.setTag(1),e.runAction(t)},tap_btn_ready:function(){ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"ready"})},tap_btn_set:function(){ModuleMgr.runDlg("SetingDlg")},onAllUiLoaded:function(){for(var e=1;e<=MAX_ROLE_NUM;e++)if(null==this["role_card"+e])return void console.log("card "+e+" empty");this.btn_back.orgX=this.btn_back.x,this.btn_close.orgX=this.btn_close.x,this.refreshPlayers(),"dissolve"==DataMgr.gameCtrl.deskStatus&&ModuleMgr.runDlg("GameDissolve"),this.isPlaying=!0,DataMgr.gameCtrl.deskInfo&&(1==DataMgr.gameCtrl.deskInfo.is_need_room_card&&this.checkContinueBuy(),"deal_end"==DataMgr.gameCtrl.deskInfo.cur_step?(this.onStartGame(),this.btn_ready.setVisible(!1)):"do_select"==DataMgr.gameCtrl.deskInfo.cur_step?this.onShowSelect():"show_finish"==DataMgr.gameCtrl.deskInfo.cur_step?(this.showAllCard(),this.panel_continue.setVisible(!0),this.btn_ready.setVisible(!1)):"none"==DataMgr.gameCtrl.deskInfo.cur_step?(0==this["role_card"+MAX_ROLE_NUM].isReady&&this.tap_btn_ready(),this.isPlaying=!1):"game_end"==DataMgr.gameCtrl.deskInfo.cur_step&&(this.isPlaying=!1)),this.txt_container.setVisible(!0),this.refreshRoomState()},hideChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!1)},showChatLayer:function(){this.layer_chat&&this.layer_chat.setVisible(!0)},tap_bg:function(){this.hideChatLayer()},tap_btn_chat:function(){this.showChatLayer()},tap_btn_switch:function(){this.close(),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT?DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_LANDSCAPE):DataMgr.gameCtrl.saveSceenOrientation(SCREEN_ORIENTATION_PROTRAIT),ModuleMgr.runOrientationDlg("GameLayer")}}),GameLayer.create=function(e,t,r){return new GameLayer(e,t,r)},ModuleMgr.registerModule("GameLayer",GameLayer),GameCard=UILayer.extend({isControlNode:!0,uiPath:"ui/GameCard.ui",
isHide:!0,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){for(var e=1;e<=13;e++)this["card"+e].idx=e,this["card"+e].pos=this["card"+e].getPosition(),this["card"+e].orgRotation=this["card"+e].getRotation(),this["card"+e].orgScaleY=this["card"+e].scaleY,this["card"+e].orgScaleX=this["card"+e].scaleX;cc.log(" game card onloaded"),this.icon_special.setVisible(!1)},clearCards:function(){for(var e=1;e<=13;e++)this["card"+e].removeAllChildren(),this["card"+e].loadTexture(GetRealPath("res/uires/game/poker_backview.png"));this.isHide=!0},showCards:function(e){if(null!=e)for(var t=1;t<=13;t++)if(e[t-1]){var r=e[t-1];this["card"+t].removeAllChildren(),this["card"+t].loadTexture("pokers/pokers_"+r+".png",ccui.Widget.PLIST_TEXTURE)}},setSpecialCard:function(e){this.icon_special.setVisible(e>0),1==e?this.icon_special.loadTexture(GetRealPath("res/uires/game/special_words.png")):e>0&&this.icon_special.loadTexture("game/right_specia"+e+".png",ccui.Widget.PLIST_TEXTURE)},showCompareCards:function(){this.showStepCards(1,!0),this.showStepCards(2,!0),this.showStepCards(3,!0),this.isHide=!1,cc.log("showCards",this.parent.name)},compareCards:function(e){this.cardDatas=e},resetZOrder:function(){this.container1.setLocalZOrder(1),this.container2.setLocalZOrder(2),this.container3.setLocalZOrder(3)},showCardNum:function(e,t){var r=t%256;e.removeAllChildren();var a="pokers/pokers_"+r+".png",i=cc.spriteFrameCache.getSpriteFrame(a);if(i?e.loadTexture(a,ccui.Widget.PLIST_TEXTURE):logSaveServer("error card num:"+t,"","","",""),DataMgr.gameCtrl.isRandCard(t)){var s=ccui.ImageView.create();s.loadTexture("pokers/pokers_"+DataMgr.gameCtrl.getRandValue(t)+".png",ccui.Widget.PLIST_TEXTURE),e.addChild(s),s.x=e.width/2,s.y=e.height/2}if(t==DataMgr.gameCtrl.deskInfo.check_maker_poker){var s=ccui.ImageView.create();s.loadTexture(GetRealPath("res/uires/game/img_red5_1.png")),e.addChild(s),s.setTag(2),s.x=73,s.y=101}},showStepCards:function(e,t){var r=[],a=1,i=13,s=[],n=-1;3==e?(a=9,i=13,s=this.cardDatas.third_list,n=this.cardDatas.third_type):2==e?(a=4,i=8,s=this.cardDatas.second_list,n=this.cardDatas.second_type):1==e&&(a=1,i=3,s=this.cardDatas.first_list,n=this.cardDatas.first_type);for(var o=a;o<=i;o++)r.push(this["card"+o]);if(t)for(var o=0;o<r.length;o++){var c=r[o],l=s[o];this.showCardNum(c,l),c.setPosition(c.pos),c.setRotation(c.orgRotation),c.setScaleY(c.orgScaleY),c.setScaleX(c.orgScaleX)}else{for(var g=(r[r.length-1].getPositionX()-r[0].getPositionX())/(r.length-1),o=0;o<r.length;o++){var c=r[o],l=s[o];c.setRotation(0),c.setPositionX(r[0].getPositionX()+g*o),c.setPositionY(r[0].getPositionY()),this.showCardNum(c,l),c.setScaleY(0),c.runAction(cc.scaleTo(.1,1.5*c.orgScaleX,1.5*c.orgScaleY))}this.icon_type.loadTexture(DataMgr.gameCtrl.getTypeImage(n,e),ccui.Widget.PLIST_TEXTURE);var h=this,u=function(){h.icon_type.setVisible(!1),h.resetZOrder();for(var e=0;e<r.length;e++){var t=r[e];t.setPosition(t.pos),t.setRotation(t.orgRotation),t.setScaleY(t.orgScaleY),t.setScaleX(t.orgScaleX)}},d=DataMgr.gameCtrl.getFormationType(n,e);""!=d&&playEffect(MUSIC_TYPE+"/common"+DataMgr.gameCtrl.getFormationType(n,e)+".mp3"),playEffect("poker_compare.mp3"),h.icon_type.setVisible(!0),h.icon_type.setLocalZOrder(6),this.icon_special.setLocalZOrder(5),this["container"+e].setLocalZOrder(4),this.icon_type.setPositionY(this["container"+e].getPositionY()+100);var _=1.2/GAME_SHOW_CARD_SPEED;this.icon_type.runAction(cc.Sequence.create(cc.DelayTime.create(_),cc.CallFunc.create(u)))}}}),GameCard.create=function(e,t,r){return new GameCard(e,t,r)},ModuleMgr.registerModule("GameCard",GameCard),UIUtils.RegisterPathTemple("ui/GameCard.ui",GameCard),GameHead=UrlHead.extend({isControlNode:!0,uiPath:"ui/GameHead.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){this.icon_ower.setVisible(!1)},setData:function(e){var t=toDecodeURIComponent(e.name);this.txt_name.setString(t),this.setUrl(e.headimgurl),this.txt_score.setVisible(!1)},setOnline:function(e){e?this.online_icon.setVisible(!1):this.online_icon.setVisible(!0)},setScore:function(e){this.txt_score.setVisible(!0),null==e&&(e=0),e>=0?this.txt_score.setString&&this.txt_score.setString("+"+e):this.txt_score.setString&&this.txt_score.setString(e)},animationEvent:function(e,t,r){t==ccs.MovementEventType.complete&&e.removeFromParent()},showCoinEffect:function(){var e=ccs.Armature.create("coin_effect");e.getAnimation().play("stand",-1,-1),e.getAnimation().setMovementEventCallFunc(this.animationEvent,this),this.coin.addChild(e)}}),GameHead.create=function(e,t,r){return new GameHead(e,t,r)},ModuleMgr.registerModule("GameHead",GameHead),UIUtils.RegisterPathTemple("ui/GameHead.ui",GameHead),GameTimer=UILayer.extend({isControlNode:!0,time:0,passTime:0,callback:null,uiPath:"ui/GameTimer.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},update:function(e){if(this.passTime+=e,this.time<=this.passTime)return this.txt_time.setString("0"),this.callback&&this.callback(),this.callback=null,this.unscheduleUpdate(),void this.setVisible(!1);var t=this.time-this.passTime;t<.1?this.txt_time.setString(0):this.txt_time.setString(parseInt(this.time-this.passTime)),this.progressCooling.setPercentage(100*(this.time-this.passTime)/this.time)},stop:function(){this.unscheduleUpdate(),this.passTime=0},setData:function(e,t){this.passTime=0,this.time=e,this.callback=t,this.txt_time.setString(e),this.scheduleUpdate()},onLoaded:function(){this.progressCooling=cc.ProgressTimer.create(cc.Sprite.create(GetRealPath("res/uires/game/desk_time_bar.png"))),this.progressCooling.setType(cc.ProgressTimer.TYPE_RADIAL),this.progressCooling.setPercentage(100),this.addChild(this.progressCooling),this.progressCooling.setPosition(this.bg.getPosition())}}),GameTimer.create=function(e,t,r){return new GameTimer(e,t,r)},ModuleMgr.registerModule("GameTimer",GameTimer),UIUtils.RegisterPathTemple("ui/GameTimer.ui",GameTimer),GameStart=QPDlg.extend({isControlNode:!0,uiPath:"ui/GameStart.ui",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},animationEvent:function(e,t,r){t==ccs.MovementEventType.complete&&(this.data.callback&&this.data.callback.call(),this.close())},onLoaded:function(){playEffect("room_start_compare.mp3"),this.ani.getAnimation().play("stand",-1,-1),this.ani.getAnimation().setMovementEventCallFunc(this.animationEvent,this)}}),GameStart.create=function(e,t,r){return new GameStart(e,t,r)},ModuleMgr.registerModule("GameStart",GameStart),GameScore=UILayer.extend({uiPath:"ui/ScoreItem.ui",isControlNode:!0,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){},setScore:function(e){var t=this.txt_num,r=GetRealPath("res/uires/game/score_yellow.png");e<0?(r=GetRealPath("res/uires/game/score_blue.png"),this.txt_flag.loadTexture("game/reduce.png",ccui.Widget.PLIST_TEXTURE)):this.txt_flag.loadTexture("game/add.png",ccui.Widget.PLIST_TEXTURE),t.setProperty(Math.abs(e),r,t.uiData.itemWidth,t.uiData.itemHeight,t.uiData.mapStartChar),t.setAnchorPoint(0,.5)}}),GameScore.create=function(e,t,r){return new GameScore(e,t,r)},ModuleMgr.registerModule("GameScore",GameScore),UIUtils.RegisterPathTemple("ui/ScoreItem.ui",GameScore),GameDissolve=QPDlg.extend({isControlNode:!0,uiPath:"ui/GameDissolve.ui",ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r);var a=this;this.addListener("AGREE_DISSOLVE",function(e){a.onRefresh()}),this.addListener("REFUSE_DISSOLVE",function(e){a.onRefresh(),a.close()})},onRefresh:function(){for(var e=!1,t=1;t<=8;t++)null==DataMgr.gameCtrl.dissovle[t]||0==DataMgr.gameCtrl.dissovle[t]?this["txt_info"+t]&&this["txt_info"+t].setString(""):1==DataMgr.gameCtrl.dissovle[t]?(this["txt_info"+t]&&this["txt_info"+t].setString("同意"),t==DataMgr.gameCtrl.myWheelIdx&&(e=!0)):(this["txt_info"+t]&&this["txt_info"+t].setString("拒绝"),t==DataMgr.gameCtrl.myWheelIdx&&(e=!0));e?(this.btn_ok&&this.btn_ok.setVisible(!1),this.btn_cancel&&this.btn_cancel.setVisible(!1)):(this.btn_ok&&this.btn_ok.setVisible(!0),this.btn_cancel&&this.btn_cancel.setVisible(!0))},DoCancel:function(e){"ended"==e.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"refuse_dissolve"})},DoOk:function(e){"ended"==e.name&&ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"agree_dissolve"})},onLoaded:function(){this.onRefresh(),this.onAllUiLoaded();var e=this,t=function(){e.close()};this.timer.setData(60-(getTimestamp()-DataMgr.gameCtrl.deskTime),t)},onEnter:function(){UILayer.prototype.onEnter.call(this),this.setLocalZOrder(1e4)},onAllUiLoaded:function(){for(var e=1;e<=8;e++){var t=DataMgr.gameCtrl.players[e];this["head"+e]&&(this["head"+e].setVisible(!1),t&&(this["head"+e].setVisible(!0),this["head"+e].setData(t.info),this["head"+e].setOnline(DataMgr.gameCtrl.online[e]),DataMgr.gameCtrl.deskInfo&&t.rid==DataMgr.gameCtrl.deskInfo.desk_own_rid&&this["head"+e].icon_ower.setVisible(!0)))}}}),GameDissolve.create=function(e,t,r){return new GameDissolve(e,t,r)},ModuleMgr.registerModule("GameDissolve",GameDissolve),GameCardLine=UILayer.extend({isControlNode:!0,uiPath:"ui/GameCardLine.ui",ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){},startGame:function(e){function t(t){t.setVisible(!0),13==t.idx&&e()}for(var r=1;r<=13;r++){var a=this["card"+r];a.idx=r,a.setVisible(!1),a.runAction(cc.Sequence.create(cc.DelayTime.create(.04*r),cc.CallFunc.create(t)))}}}),GameCardLine.create=function(e,t,r){return new GameCardLine(e,t,r)},ModuleMgr.registerModule("GameCardLine",GameCardLine),UIUtils.RegisterPathTemple("ui/GameCardLine.ui",GameCardLine),GameCardFormation=QPDlg.extend({uiPath:"ui/GameCardFormation.ui",cardPos:null,selectCard:null,usedCardNum:{},ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},tap_btn_handle:function(e){this.close(),DataMgr.gameCtrl.setFormationHandle(1),DataMgr.gameCtrl.runFormation()},getCardByNum:function(e){null==this.usedCardNum[e]&&(this.usedCardNum[e]=0);for(var t=DataMgr.gameCtrl.getRandValue(e),r=0,a=1;a<=13;a++)if(this["card"+a].num==t){if(this.usedCardNum[e]>r){r++;continue}return this["card"+a]}return null},moveCard:function(e,t){var r=this.getCardByNum(e);if(r){this.usedCardNum[e]++;var a=this.cardPos[t];r.runAction(cc.moveTo(.3,a)),r.idx=t,r.changeNum=DataMgr.gameCtrl.GetCardLogicValue(e)}},clearSelectCard:function(){this.selectCard&&(this.selectCard.changeSprite&&this.selectCard.changeSprite.setColor(cc.color(255,255,255,255)),this.selectCard.setColor(cc.color(255,255,255,255))),this.selectCard=null},OnSelectCard:function(e){if("ended"==e.name){if(this.selectCard){var t=e.target,r=this.selectCard,a=t.idx,i=r.idx,s=this.cardPos[a],n=this.cardPos[i];return t.stopAllActions(),r.stopAllActions(),t.runAction(cc.moveTo(.3,n)),r.runAction(cc.moveTo(.3,s)),t.idx=i,r.idx=a,this.changeFormation(),void this.clearSelectCard()}this.selectCard=e.target,this.selectCard.setColor(cc.color(100,100,100)),this.selectCard.changeSprite&&this.selectCard.changeSprite.setColor(cc.color(100,100,100))}},onAllUiLoaded:function(){function e(){c.showFomation(c.items[0].data),c.tap_btn_ok()}DataMgr.gameCtrl.SortCardList(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,enDescend),this.cardPos=[];for(var t=1;t<=13;t++){this.cardPos[t]=this["card"+t].getPosition();var r=DataMgr.gameCtrl.myCards[t-1];if(this["card"+t].num=DataMgr.gameCtrl.getRandValue(r),this["card"+t].idx=t,this["card"+t].loadTexture("pokers/pokers_"+r+".png",ccui.Widget.PLIST_TEXTURE),DataMgr.gameCtrl.deskInfo&&r==DataMgr.gameCtrl.deskInfo.check_maker_poker){var a=this["card"+t],i=ccui.ImageView.create();i.loadTexture(GetRealPath("res/uires/game/img_red5_1.png")),a.addChild(i),i.x=73,i.y=101,a.red5Sprite=i}}var s=new Array,n=[];CopyMemory(n,DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length),DataMgr.gameCtrl.GetCardForamtion(n,n.length,s);var o=this.list_view;o.setClippingType(ccui.Layout.CLIPPING_STENCIL),o.setBounceEnabled(!0);var c=this,l=function(e){c.showFomation(e)};this.items=[];for(var t=0;t<s.length;t++){var g=CardFormationItem.create();g.setTouchEnabled(!0),g.setData(s[t]),g.selectCallback=l,o.pushBackCustomItem(g),this.items.push(g)}0!=this.items.length&&l(s[0]);var c=this,h=getTimestamp()-DataMgr.gameCtrl.startTime;this.timer.setData(FORMATION_TIME-h,e),this.addListener("SuccessMyShowCard",function(e){c.close()})},onLoaded:function(){this.checkSpecialVisible(),this.onAllUiLoaded()},checkSpecialVisible:function(){if(null!=this.btn_special){this.btn_special.setVisible(!1);var e=[],t=DataMgr.gameCtrl.isSpecialCard(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,e);t>0&&this.btn_special.setVisible(!0)}},showFomation:function(e){this.data=e;for(var t=1;t<=13;t++){var r=this["card"+t];r.stopAllActions()}for(var t=0;t<this.items.length;t++){var a=this.items[t];a.setUnSelect(),a.data==this.data&&a.setSelect()}this.usedCardNum={};for(var t=0;t<e.third_list.length;t++){var i=e.third_list[t],s=t+9;this.moveCard(i,s)}for(var t=0;t<e.second_list.length;t++){var i=e.second_list[t],s=t+4;this.moveCard(i,s)}for(var t=0;t<e.first_list.length;t++){var i=e.first_list[t],s=t+1;this.moveCard(i,s)}this.usedCardNum={},this.clearSelectCard(),this.changeFormation()},getCardNum:function(e,t){var r=e.num;return t&&DataMgr.gameCtrl.isRandCard(r)?DataMgr.gameCtrl.mergeRandNum(r,e.changeNum):r},getDataByStep:function(e,t){var r=[];if(3==e)for(var a=1;a<=13;a++)this["card"+a].idx>=9&&this["card"+a].idx<=13&&r.push(this.getCardNum(this["card"+a],t));else if(2==e)for(var a=1;a<=13;a++)this["card"+a].idx>=4&&this["card"+a].idx<=8&&r.push(this.getCardNum(this["card"+a],t));else if(1==e)for(var a=1;a<=13;a++)this["card"+a].idx>=1&&this["card"+a].idx<=3&&r.push(this.getCardNum(this["card"+a],t));return r},tap_btn_special:function(){var e=[],t=DataMgr.gameCtrl.isSpecialCard(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,e);if(t>0){var r=this,a=function(){r.close()},i=function(){};DataMgr.gameCtrl.checkSpeicalCard(t,e,i,a)}},changeFormation:function(){var e=this.getDataByStep(1,!0),t={};DataMgr.gameCtrl.SortCardList(e,3,enDescend);var r=DataMgr.gameCtrl.GetCardType3(e,t),a=this.getDataByStep(2,!0),i={};DataMgr.gameCtrl.SortCardList(a,5,enDescend);var s=DataMgr.gameCtrl.GetCardType5(a,i),n=this.getDataByStep(3,!0);DataMgr.gameCtrl.SortCardList(n,5,enDescend);var o={},c=DataMgr.gameCtrl.GetCardType5(n,o);this.sprite3.loadTexture(DataMgr.gameCtrl.getTypeImage(c,3),ccui.Widget.PLIST_TEXTURE),this.sprite2.loadTexture(DataMgr.gameCtrl.getTypeImage(s,2),ccui.Widget.PLIST_TEXTURE),this.sprite1.loadTexture(DataMgr.gameCtrl.getTypeImage(r,1),ccui.Widget.PLIST_TEXTURE),this.changeCard(t),this.changeCard(i),this.changeCard(o)},changeCard:function(e){for(var t in e){var r=e[t]%256,a=this.getCardByNum(t);a.removeChildByTag(1),a.changeNum=r;var i="pokers/pokers_"+r+".png",s=cc.spriteFrameCache.getSpriteFrame(i);s?a.loadTexture(i,ccui.Widget.PLIST_TEXTURE):logSaveServer("error card cards:"+DataMgr.gameCtrl.myCards,"","","","");var n=ccui.ImageView.create();n.loadTexture("pokers/pokers_"+DataMgr.gameCtrl.getRealType(t)+".png",ccui.Widget.PLIST_TEXTURE),a.addChild(n),a.setTag(1),n.x=a.width/2,n.y=a.height/2,a.changeSprite=n}},tap_btn_ok:function(){var e={},t=new tagCardForamtion;if(t.first_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(1,!0)),t.second_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(2,!0)),t.third_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(3,!0)),t.first_type=DataMgr.gameCtrl.GetCardType3(t.first_list),t.second_type=DataMgr.gameCtrl.GetCardType5(t.second_list),t.third_type=DataMgr.gameCtrl.GetCardType5(t.third_list),0==DataMgr.gameCtrl.isLegalForamtion(t))return this.showFomation(t),ModuleMgr.showTipMsg("倒水了"),!1;DataMgr.gameCtrl.SortFormationA(t.third_list,t.third_type),DataMgr.gameCtrl.SortFormationA(t.second_list,t.second_type);var r=t.first_list;e.first_type=t.first_type,e.first_list=r.reverse();var a=t.second_list;e.second_type=t.second_type,e.second_list=a.reverse();var i=t.third_list;return e.third_type=t.third_type,e.third_list=i.reverse(),DataMgr.gameCtrl.viewCards=e,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"show_card",poker:e}),this.close(),!0}}),GameCardFormation.create=function(e,t,r){return new GameCardFormation(e,t,r)},ModuleMgr.registerModule("GameCardFormation",GameCardFormation),GameCardFormationHandle=QPDlg.extend({uiPath:"ui/GameCardFormationHandle.ui",cardPos:null,selectCard:null,usedCardNum:{},showIdx:{},ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},getCardByNum:function(e){null==this.usedCardNum[e]&&(this.usedCardNum[e]=0);for(var t=DataMgr.gameCtrl.getRandValue(e),r=0,a=1;a<=13;a++)if(this["card"+a].num==t){if(this.usedCardNum[e]>r){r++;continue}return this["card"+a]}return null},moveCard:function(e,t){var r=this.getCardByNum(e);if(r){this.usedCardNum[e]++;var a=this.cardPos[t];r.runAction(cc.moveTo(.3,a)),r.idx=t,r.changeNum=DataMgr.gameCtrl.GetCardLogicValue(e)}},clearSelectCard:function(){this.selectCard&&(this.selectCard.changeSprite&&this.selectCard.changeSprite.setColor(cc.color(255,255,255,255)),this.selectCard.setColor(cc.color(255,255,255,255))),this.selectCard=null},getNodeWorldRect:function(e){var t=e.convertToWorldSpace(cc.p(0,0)),r=t.x,a=t.y,i=e.getContentSize(),s=e.getScaleX(),n=e.getScaleY(),o=i.width*s,c=i.height*n,l=cc.rect(r,a,o,c),g=ModuleMgr.getScreenRotation();return 90==g&&(l.width=i.height*n,l.height=i.width*s,l.y=l.y-l.height),l},getTouchCardIndex:function(e){for(var t=13;t>=1;t--){var r=this["card_"+t];if(r&&r.isVisible()&&cc.rectContainsPoint(this.getNodeWorldRect(r),e))return t}return-1},onTouchBegan:function(e,t){var r=e.getLocation();if(!cc.rectContainsPoint(this.getNodeWorldRect(this.touch_node),r))return!1;var a=this.getTouchCardIndex(r);return a>0&&(this.beginCardIndex=a,this.endCardIndex=a,this.checkTouchCard(this.beginCardIndex,this.endCardIndex)),!0},onTouchMoved:function(e,t){var r=e.getLocation(),a=this.getTouchCardIndex(r);a>0&&(this.endCardIndex=a,this.checkTouchCard(this.beginCardIndex,this.endCardIndex))},onTouchEnded:function(e,t){this.checkTouchCard(this.beginCardIndex,this.endCardIndex,!0),this.beginCardIndex=-1,this.endCardIndex=-1},checkTouchCard:function(e,t,r){if(e!=-1||t!=-1)for(var a=Math.min(e,t),i=Math.max(e,t),s=1;s<=13;s++){var n=this["card_"+s];s>=a&&s<=i?r?(n.isSelect?n.setPositionY(n.orgY):n.setPositionY(n.orgY+30),n.isSelect=!n.isSelect,this.hiedMask(n)):this.showMask(n):this.hiedMask(n)}},hiedMask:function(e){e.setColor(cc.color(255,255,255))},showMask:function(e){e.setColor(cc.color(100,100,100))},OnSelectCard2:function(e){if("ended"==e.name){var t=e.target;1==t.isSelect?(t.isSelect=!1,t.setPositionY(t.orgY)):(t.isSelect=!0,t.setPositionY(t.orgY+30))}},OnSelectCard:function(e){if("ended"==e.name){if(this.selectCard){var t=e.target,r=this.selectCard,a=t.idx,i=r.idx,s=this.cardPos[a],n=this.cardPos[i];return t.stopAllActions(),r.stopAllActions(),t.runAction(cc.moveTo(.3,n)),r.runAction(cc.moveTo(.3,s)),t.idx=i,r.idx=a,this.changeFormation(),void this.clearSelectCard()}this.selectCard=e.target,this.selectCard.setColor(cc.color(100,100,100)),this.selectCard.changeSprite&&this.selectCard.changeSprite.setColor(cc.color(100,100,100))}},onAllUiLoaded:function(){function e(){null!=r[0]&&(i.setLineCard(r[0].first_list,1,5),i.setLineCard(r[0].second_list,2,5),i.setLineCard(r[0].third_list,3,5),i.showFomation(r[0]),i.tap_btn_ok())}DataMgr.gameCtrl.SortCardList(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,enDescend),this.cardPos=[];for(var t=1;t<=13;t++)this.cardPos[t]=this["card"+t].getPosition(),this["card"+t].idx=t,this["card"+t].setVisible(!1);for(var t=1;t<=13;t++)this["card_"+t].orgY=this["card_"+t].getPositionY(),this["card_"+t].idx=t;var r=new Array,a=[];CopyMemory(a,DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length),DataMgr.gameCtrl.GetCardForamtion(a,a.length,r);var i=this,s=getTimestamp()-DataMgr.gameCtrl.startTime;this.timer.setData(FORMATION_TIME-s,e),this.refreshRemainCard(),this.addListener("SuccessMyShowCard",function(e){i.close()})},tap_btn_cancel1:function(e){this.clearLine(1)},tap_btn_cancel2:function(e){this.clearLine(2)},tap_btn_cancel3:function(e){this.clearLine(3)},setSelectAll:function(){for(var e=1;e<=13;e++)this["card_"+e].isVisible()&&(this["card_"+e].isSelect=!0)},checkRemainCard:function(){var e=this.getDataByStep(1),t=this.getDataByStep(2),r=this.getDataByStep(3),a=e;a=a.concat(t),a=a.concat(r);var i=DataMgr.gameCtrl.GetRemainCard(DataMgr.gameCtrl.myCards,a);i.length<=3-e.length?(this.setSelectAll(),this.setLineCard(this.getSelectCard(),1,3)):i.length<=5-t.length?(this.setSelectAll(),this.setLineCard(this.getSelectCard(),2,5)):i.length<=5-r.length&&(this.setSelectAll(),this.setLineCard(this.getSelectCard(),3,5))},tap_btn_auto:function(e){this.close(),DataMgr.gameCtrl.setFormationHandle(0),DataMgr.gameCtrl.runFormation()},OnTouchFirst:function(e){"ended"==e.name&&(this.setLineCard(this.getSelectCard(),1,3),this.checkRemainCard())},OnTouchSecond:function(e){"ended"==e.name&&(this.setLineCard(this.getSelectCard(),2,5),this.checkRemainCard())},OnTouchThird:function(e){"ended"==e.name&&(this.setLineCard(this.getSelectCard(),3,5),this.checkRemainCard())},setLineCard:function(e,t,r){if(0!=e.length){var a=this.getDataByStep(t);a.length+e.length<=r&&(e=e.concat(a)),DataMgr.gameCtrl.SortCardList(e,e.length,enDescend);var i={},s=1;s=5==r?DataMgr.gameCtrl.GetCardType5(e,i):DataMgr.gameCtrl.GetCardType3(e,i),this["sprite"+t].loadTexture(DataMgr.gameCtrl.getTypeImage(s,t),ccui.Widget.PLIST_TEXTURE),this["btn_cancel"+t].setVisible(!0),this["sprite"+t].setVisible(!0),this.clearLine(t);for(var n=this.getCardByStep(t),o=0;o<r&&o<e.length;o++)if(n[o].removeChildByTag(1),n[o].removeChildByTag(2),n[o].setVisible(!0),n[o].num=e[o],n[o].loadTexture("pokers/pokers_"+e[o]+".png",ccui.Widget.PLIST_TEXTURE),n[o].num==DataMgr.gameCtrl.deskInfo.check_maker_poker){var c=ccui.ImageView.create();c.loadTexture(GetRealPath("res/uires/game/img_red5_1.png")),n[o].addChild(c),c.setTag(2),c.x=73,c.y=101,n[o].red5Sprite=c}this.changeCard(i),this.refreshRemainCard()}},clearLine:function(e){for(var t=this.getCardByStep(e),r=0;r<t.length;r++)t[r].setVisible(!1);this.refreshRemainCard()},getSelectCard:function(){for(var e=[],t=1;t<=13;t++)this["card_"+t].isSelect&&e.push(this["card_"+t].num);return e},onLoaded:function(){this.checkSpecialVisible(),this.onAllUiLoaded();var e=this,t=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,onTouchBegan:function(t,r){return e.onTouchBegan(t,r)},onTouchMoved:function(t,r){e.onTouchMoved(t,r)},onTouchEnded:function(t,r){e.onTouchEnded(t,r)}});this.onExit=function(){cc.eventManager.removeListener(t)},cc.eventManager.addListener(t,this.touch_node)},checkSpecialVisible:function(){if(null!=this.btn_special){this.btn_special.setVisible(!1);var e=[],t=DataMgr.gameCtrl.isSpecialCard(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,e);t>0&&this.btn_special.setVisible(!0)}},showFomation:function(e){this.data=e;for(var t=1;t<=13;t++){var r=this["card"+t];r.setVisible(!0),r.stopAllActions()}this.usedCardNum={};for(var t=0;t<e.third_list.length;t++){var a=e.third_list[t],i=t+9;this.moveCard(a,i)}for(var t=0;t<e.second_list.length;t++){var a=e.second_list[t],i=t+4;this.moveCard(a,i)}for(var t=0;t<e.first_list.length;t++){var a=e.first_list[t],i=t+1;this.moveCard(a,i)}this.usedCardNum={},this.clearSelectCard(),this.changeFormation()},getCardNum:function(e,t){var r=e.num;return t&&DataMgr.gameCtrl.isRandCard(r)?DataMgr.gameCtrl.mergeRandNum(r,e.changeNum):r},refreshRemainCard:function(){var e=this.getDataByStep(1),t=this.getDataByStep(2),r=this.getDataByStep(3),a=e;a=a.concat(t),a=a.concat(r),this.btn_cancel1.setVisible(e.length>0),this.btn_cancel2.setVisible(t.length>0),this.btn_cancel3.setVisible(r.length>0),this.sprite1.setVisible(3==e.length),this.sprite2.setVisible(5==t.length),this.sprite3.setVisible(5==r.length);for(var i=DataMgr.gameCtrl.GetRemainCard(DataMgr.gameCtrl.myCards,a),s=1;s<=13;s++)this["card_"+s].setVisible(!1),this["card_"+s].isSelect=!1,this["card_"+s].setPositionY(this["card_"+s].orgY),this["card_"+s].removeAllChildren();for(var s=1;s<=i.length;s++){var n=i[s-1];if(this["card_"+s].setVisible(!0),this["card_"+s].num=DataMgr.gameCtrl.getRandValue(n),n>=78&&(n+="_f"),this["card_"+s].loadTexture("pokers/pokers_"+n+".png",ccui.Widget.PLIST_TEXTURE),this["card_"+s].num==DataMgr.gameCtrl.deskInfo.check_maker_poker){var o=(this["card"+s],ccui.ImageView.create());o.loadTexture(GetRealPath("res/uires/game/img_red5_1.png")),this["card_"+s].addChild(o),this["card_"+s].setTag(2),o.x=73,o.y=101}}this.touch_icon1.setVisible(!0),this.touch_icon2.setVisible(!0),this.touch_icon3.setVisible(!0),0==i.length&&(this.touch_icon1.setVisible(!1),this.touch_icon2.setVisible(!1),this.touch_icon3.setVisible(!1));for(var c=DataMgr.gameCtrl.GetTypeHandle(i,i.length),l=[CT_ONE_DOUBLE,CT_FIVE_TWO_DOUBLE,CT_THREE,CT_FIVE_MIXED_FLUSH_NO_A,CT_FIVE_FLUSH,CT_FIVE_THREE_DEOUBLE,CT_FIVE_FOUR_ONE,CT_FIVE_STRAIGHT_FLUSH_NO_A,CT_FIVE],s=0;s<l.length;s++)this.setBtnEnable(l[s],c[l[s]]&&c[l[s]].length>0);this.handleData=c,this.showIdx={}},clearSelect:function(){for(var e=1;e<=13;e++)this["card_"+e].isSelect=!1,this["card_"+e].setPositionY(this["card_"+e].orgY)},showSelectCards:function(e){for(var t=0;t<e.length;t++)for(var r=DataMgr.gameCtrl.getRandValue(e[t]),a=1;a<=13;a++)if(!this["card_"+a].isSelect&&r==DataMgr.gameCtrl.getRandValue(this["card_"+a].num)){this["card_"+a].isSelect=!0,this["card_"+a].setPositionY(this["card_"+a].orgY+40);break}},showBtnType:function(e){this.clearSelect();var t=this.handleData;if(null!=t[e]){var r=this.showIdx[e]||0;r>=t[e].length&&(r=0);var a=t[e][r];this.showSelectCards(a),this.showIdx[e]=r+1}},tap_btn_type14:function(e){this.showBtnType(14)},tap_btn_type11:function(e){this.showBtnType(11)},tap_btn_type10:function(e){this.showBtnType(10)},tap_btn_type9:function(e){this.showBtnType(9)},tap_btn_type8:function(e){this.showBtnType(8)},tap_btn_type7:function(e){this.showBtnType(7)},tap_btn_type5:function(e){this.showBtnType(5)},tap_btn_type4:function(e){this.showBtnType(4)},tap_btn_type3:function(e){this.showBtnType(3)},tap_btn_type2:function(e){this.showBtnType(2)},setBtnEnable:function(e,t){this["btn_type"+e].setTouchEnabled(t),t?this["btn_type"+e].setOpacity(255):this["btn_type"+e].setOpacity(155)},getCardByStep:function(e){var t=[];if(3==e)for(var r=1;r<=13;r++)this["card"+r].idx>=9&&this["card"+r].idx<=13&&t.push(this["card"+r]);else if(2==e)for(var r=1;r<=13;r++)this["card"+r].idx>=4&&this["card"+r].idx<=8&&t.push(this["card"+r]);else if(1==e)for(var r=1;r<=13;r++)this["card"+r].idx>=1&&this["card"+r].idx<=3&&t.push(this["card"+r]);return t.sort(function(e,t){return e.idx-t.idx}),t},getDataByStep:function(e,t){var r=[];if(3==e)for(var a=1;a<=13;a++)this["card"+a].idx>=9&&this["card"+a].idx<=13&&this["card"+a].isVisible()&&r.push(this.getCardNum(this["card"+a],t));else if(2==e)for(var a=1;a<=13;a++)this["card"+a].idx>=4&&this["card"+a].idx<=8&&this["card"+a].isVisible()&&r.push(this.getCardNum(this["card"+a],t));else if(1==e)for(var a=1;a<=13;a++)this["card"+a].idx>=1&&this["card"+a].idx<=3&&this["card"+a].isVisible()&&r.push(this.getCardNum(this["card"+a],t));return r},tap_btn_special:function(){var e=[],t=DataMgr.gameCtrl.isSpecialCard(DataMgr.gameCtrl.myCards,DataMgr.gameCtrl.myCards.length,e);if(t>0){var r=this,a=function(){r.close()},i=function(){};DataMgr.gameCtrl.checkSpeicalCard(t,e,i,a)}},changeFormation:function(){var e=this.getDataByStep(1,!0),t={};DataMgr.gameCtrl.SortCardList(e,3,enDescend);var r=DataMgr.gameCtrl.GetCardType3(e,t),a=this.getDataByStep(2,!0),i={};DataMgr.gameCtrl.SortCardList(a,5,enDescend);var s=DataMgr.gameCtrl.GetCardType5(a,i),n=this.getDataByStep(3,!0);DataMgr.gameCtrl.SortCardList(n,5,enDescend);var o={},c=DataMgr.gameCtrl.GetCardType5(n,o);this.sprite3.loadTexture(DataMgr.gameCtrl.getTypeImage(c,3),ccui.Widget.PLIST_TEXTURE),this.sprite2.loadTexture(DataMgr.gameCtrl.getTypeImage(s,2),ccui.Widget.PLIST_TEXTURE),this.sprite1.loadTexture(DataMgr.gameCtrl.getTypeImage(r,1),ccui.Widget.PLIST_TEXTURE),this.changeCard(t),this.changeCard(i),this.changeCard(o)},changeCard:function(e){for(var t in e){var r=e[t]%256,a=this.getCardByNum(t);a.removeChildByTag(1),a.removeChildByTag(2),a.changeNum=r;var i="pokers/pokers_"+r+".png",s=cc.spriteFrameCache.getSpriteFrame(i);s?a.loadTexture(i,ccui.Widget.PLIST_TEXTURE):logSaveServer("error card cards:"+DataMgr.gameCtrl.myCards,"","","","");var n=ccui.ImageView.create();n.loadTexture("pokers/pokers_"+DataMgr.gameCtrl.getRealType(t)+".png",ccui.Widget.PLIST_TEXTURE),a.addChild(n),n.setTag(1),n.x=a.width/2,n.y=a.height/2,a.changeSprite=n}},tap_btn_ok:function(){var e=this.getDataByStep(1),t=this.getDataByStep(2),r=this.getDataByStep(3),a=e;a=a.concat(t),a=a.concat(r);var i=DataMgr.gameCtrl.GetRemainCard(DataMgr.gameCtrl.myCards,a);if(i.length>0)return void ModuleMgr.showTipMsg("牌还没有摆满");var s={},n=new tagCardForamtion;if(n.first_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(1,!0)),n.second_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(2,!0)),n.third_list=DataMgr.gameCtrl.SortForamtion(this.getDataByStep(3,!0)),n.first_type=DataMgr.gameCtrl.GetCardType3(n.first_list),n.second_type=DataMgr.gameCtrl.GetCardType5(n.second_list),n.third_type=DataMgr.gameCtrl.GetCardType5(n.third_list),0==DataMgr.gameCtrl.isLegalForamtion(n))return this.showFomation(n),ModuleMgr.showTipMsg("倒水了"),!1;DataMgr.gameCtrl.SortFormationA(n.third_list,n.third_type),DataMgr.gameCtrl.SortFormationA(n.second_list,n.second_type);var o=n.first_list;s.first_type=n.first_type,s.first_list=o.reverse();var c=n.second_list;s.second_type=n.second_type,s.second_list=c.reverse();var l=n.third_list;return s.third_type=n.third_type,s.third_list=l.reverse(),DataMgr.gameCtrl.viewCards=s,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"show_card",poker:s}),this.close(),!0}}),GameCardFormationHandle.create=function(e,t,r){return new GameCardFormationHandle(e,t,r)},ModuleMgr.registerModule("GameCardFormationHandle",GameCardFormationHandle),CardFormationItem=UILayer.extend({isControlNode:!0,uiPath:"ui/CardFormationItem.ui",selectCallback:null,data:null,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){this.icon_select.setVisible(!1)},setSelect:function(){this.icon_select.setVisible(!0)},setUnSelect:function(){this.icon_select.setVisible(!1)},setData:function(e){this.data=e,this.sprite3.loadTexture(DataMgr.gameCtrl.getTypeImage(e.third_type,3),ccui.Widget.PLIST_TEXTURE),this.sprite2.loadTexture(DataMgr.gameCtrl.getTypeImage(e.second_type,2),ccui.Widget.PLIST_TEXTURE),this.sprite1.loadTexture(DataMgr.gameCtrl.getTypeImage(e.first_type,1),ccui.Widget.PLIST_TEXTURE)},tap_btn_formation:function(){this.selectCallback&&this.selectCallback.call(this,this.data)}}),CardFormationItem.create=function(e,t,r){return new CardFormationItem(e,t,r)},ModuleMgr.registerModule("CardFormationItem",CardFormationItem),UIUtils.RegisterPathTemple("ui/CardFormationItem.ui",CardFormationItem),GameRoleCard=UILayer.extend({isControlNode:!0,uiPath:"ui/GameRoleCard.ui",isReady:!1,canView:!1,online:!0,shootIdx:1,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},animationEvent:function(e,t,r){if(t==ccs.MovementEventType.loopComplete&&(playEffect("daqiang3.mp3"),this.gunCard.addGunHole(),e.playTime--,e.playTime<0))return void e.removeFromParent()},tap_btn_out:function(){var e=this,t=function(){var t=DataMgr.gameCtrl.getPlayerByRid(e._data.rid);ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"kick_user",idx:t.wheel_idx})},r=function(){};ModuleMgr.showConfirmCancelMsg("确定要将["+this._data.name+"]请离房间?",t,r)},tap_btn_shoot:function(){this.shootIdx==this.card_tag&&this.shootIdx++,this.gunCard=this.parent.parent["role_card"+this.shootIdx],
this.addGun(),this.shootIdx++,this.shootIdx>=8&&(this.shootIdx=1)},addGun:function(){if(null!=this.gunCard&&null!=this.gunCard.card_tag){var e=cc.pSub(this.gunCard.getPosition(),this.getPosition()),t=cc.pToAngle(e),r=cc.radiansToDegrees(t);playEffect(MUSIC_TYPE+"/daqiang1.mp3"),this.setLocalZOrder(-1),this.gun_container.removeChildByTag(1);var a=null;e.x<0?(a=ccs.Armature.create("gun_effect2"),a.setRotation(-1*r-180)):(a=ccs.Armature.create("gun_effect"),a.setRotation(-1*r)),a.getAnimation().play("stand",-1,1),a.playTime=2,a.getAnimation().setSpeedScale(1.5),a.getAnimation().setMovementEventCallFunc(this.animationEvent,this),this.gun_container.addChild(a)}},showTalk:function(){this.icon_laba.setVisible(!0)},stopTalk:function(){this.icon_laba.setVisible(!1)},showChatLab:function(e){function t(e){r.hideChatLab()}for(var r=this,a=0;a<chatCfgList.length;a++)if(chatCfgList[a]==e){var i=a+1;playEffect(MUSIC_CHAT_TYPE+"/talk/CHAT"+i+".mp3")}r.lab_chat.setString("[c0:0:0]"+e+"[/c]"),r.grp_chat_txt.stopAllActions(),r.grp_chat_txt.setVisible(!0),r.grp_chat_txt.runAction(cc.Sequence.create(cc.DelayTime.create(2),cc.CallFunc.create(t)))},hideChatLab:function(){this.grp_chat_txt.setVisible(!1)},showChatFace:function(e){function t(e){r.hideChatFace()}var r=this;r.img_chat_face.stopAllActions(),r.img_chat_face.loadTexture("res/uires/face/"+e+".png"),r.img_chat_face.setVisible(!0),r.img_chat_face.setOpacity(0),r.img_chat_face.runAction(cc.Sequence.create(cc.FadeIn.create(.4),cc.DelayTime.create(1),cc.CallFunc.create(t)))},hideChatFace:function(){this.img_chat_face.setVisible(!1)},addGunHole:function(){var e=ccs.Armature.create("gun_hole_effect");e.getAnimation().play("stand",-1,-1),this.gun_container.addChild(e),e.x=80*(Math.random()-.5),e.y=80*(Math.random()-.5)},clearGunHole:function(){this.gun_container.removeAllChildren()},showCompareCards:function(){this.card.showCompareCards()},setSpecialCard:function(e){this.isSpecialCard=e,this.card.setSpecialCard(e)},setOnline:function(e){this.head.setOnline(e),this.online=e,0==e&&this.setReady(0)},onLoaded:function(){this.setEmpty(),this.setVisible(!1),this.icon_laba.setVisible(!1),this.hideChatLab(),this.hideChatFace(),this.txt_compare&&this.txt_compare.setVisible(!1)},cardSelected:function(){this.setEmpty(),this.head.setVisible(!0),this.card.setVisible(!0),this.setSpecialCard(-1),this.canView=!0},formationCard:function(){this.setEmpty(),this.head.setVisible(!0),this.card_line.setVisible(!0),this.txt_formation.setVisible(!0)},setOwner:function(e){this.head.icon_ower.setVisible(e==this.rid)},viewCard:function(e){this.card&&0!=this.card.isVisible()&&0!=this.canView&&(this.card.isHide?(this.card.compareCards(e),this.card.showCompareCards()):this.card.clearCards())},compareCards:function(e){this.card.compareCards(e),this.spec_type=e.spec_type,e.spec_type?this.setSpecialCard(1):this.setSpecialCard(-1),this.txt_compare.setVisible(!0)},compareEnd:function(){this.txt_compare.setVisible(!1)},showStepCards:function(e){this.card.showStepCards(e)},showCards:function(e){this.cards=e,this.setEmpty(),this.head.setVisible(!0),this.card.setVisible(!0),this.card.showCards(e)},startGame:function(){this.setEmpty();var e=this,t=function(){e.txt_formation.setVisible(!0)};this.txt_compare.setVisible(!1),e.txt_formation.setVisible(!1),this.head.setVisible(!0),this.card_line.setVisible(!0),this.card_line.startGame(t),this.card.clearCards(),this.gun_container.removeAllChildren()},setWait:function(){this.setEmpty(),this.head.setVisible(!0),this.setVisible(!0),this.gun_container.removeAllChildren(),this.setOnline(this.online)},setData:function(e){null!=e&&(this.rid=e.rid,this._data=e.info,this.head.setVisible(!0),this.setVisible(!0),this.head.setData(e.info))},setScore:function(e){this.score=e,this.head&&this.head.setScore(e)},showCoinEffect:function(){this.head.showCoinEffect()},setReady:function(e){this.icon_ready&&this.icon_ready.setVisible(!1),this.isReady=1==e},setRate:function(e){return e==-1?void(this.txt_rate&&this.txt_rate.setString("")):void(this.txt_rate&&this.txt_rate.setString(e+"倍"))},setEmpty:function(){this.btn_out&&this.btn_out.setVisible(!1),this.head&&this.head.setVisible(!1),this.card&&this.card.setVisible(!1),this.card_line&&this.card_line.setVisible(!1),this.txt_formation&&this.txt_formation.setVisible(!1),this.icon_ready&&this.icon_ready.setVisible(!1),this.gun_container&&this.gun_container.removeAllChildren(),this.txt_rate&&(this.txt_rate.scale=1/this.scale)}}),GameRoleCard.create=function(e,t,r){return new GameRoleCard(e,t,r)},ModuleMgr.registerModule("GameRoleCard",GameRoleCard),UIUtils.RegisterPathTemple("ui/GameRoleCard1.ui",GameRoleCard),UIUtils.RegisterPathTemple("ui/GameRoleCard2.ui",GameRoleCard),UIUtils.RegisterPathTemple("ui/GameRoleCard3.ui",GameRoleCard),CreateRoomDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/CreateRoomDlg.ui",roomName:null,gameState:null,gameType:null,curRound:0,curRoleNum:4,curType:0,curCost:0,curArea:0,curJoke:0,curColor:0,curWin:0,curRate:0,curMaster:0,curFive:0,curFiveValue:0,roleNumList:[2,3,4],defaultFiveValue:5,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},onLoaded:function(){for(var e=0;e<3;e++)ROOM_CARD_COST[e]&&this.setText("lab_round_"+e,ROOM_CARD_COST[e].round);var t=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_master")||0),r=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_round")||1),a=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_area")||0),i=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_cur_color")||0),s=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_win")||0),n=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_rate")||0),o=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_role_num")||0),c=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_red5_poker")||this.defaultFiveValue);this.setMater(t),this.setRound(r),this.setArea(a),this.setCurColor(i),this.setWin(s),this.setRate(n),this.setRoleNum(o),this.setRed5Lab(c),this.setTypeNum(),this.setOther(),this.refreshCkRound()},refreshCkRound:function(){for(var e=0;e<4;e++)ROOM_CARD_COST[e]&&this["ck_round"+e]&&this["ck_round"+e].setSelected(this.curRound==ROOM_CARD_COST[e].round),this["ck_role_num"+e]&&this["ck_role_num"+e].setSelected(this.curRoleNum==this.roleNumList[e]),this["ck_area"+e]&&this["ck_area"+e].setSelected(this.curArea==e),this["ck_joke"+e]&&this["ck_joke"+e].setSelected(this.curJoke==e),this["ck_color"+e]&&this["ck_color"+e].setSelected(this.curColor==e),this["ck_rate"+e]&&this["ck_rate"+e].setSelected(this.curRate==e),this["ck_win"+e]&&this["ck_win"+e].setSelected(this.curWin==e),this["btn_master"+e]&&this["btn_master"+e].setEnabled(this.curMaster!=e),this["txt_master"+e]&&this["txt_master"+e].setVisible(this.curMaster==e);this.panel_rate&&this.panel_rate.setVisible(1==this.curMaster),this.refreshCost()},refreshCost:function(){var e={crazyLv:this.curType,hasJoker:this.curJoke,round:this.curRound,curColor:this.curColor},t=DataMgr.gameCtrl.getRoomCardCost(e);this.curCost=t,this.lab_cost&&this.lab_cost.setString&&this.lab_cost.setString(this.curCost)},setRed5Lab:function(e){this.curFiveValue=e,cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_red5_poker",e),this.refreshRed5Poker()},refreshRed5Poker:function(){var e=DataMgr.gameCtrl.getPokerName(this.curFiveValue),t=DataMgr.gameCtrl.getMaRatio(this.curFiveValue,this.curColor);this.lab_red5&&this.lab_red5.setString(e+t)},setRound:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_round",e),this.curRound=ROOM_CARD_COST[e].round,this.refreshCkRound()},setRate:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_rate",e),this.curRate=e,this.refreshCkRound()},setArea:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_area",e),this.curArea=e,this.refreshCkRound()},setJoke:function(e){this.curJoke=e,this.refreshCkRound()},setCurColor:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_cur_color",e),this.curColor=e,this.refreshCkRound(),this.refreshRed5Poker()},setWin:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_win",e),this.curWin=e,this.refreshCkRound()},setMater:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_master",e),this.curMaster=e,this.refreshCkRound()},setRoleNum:function(e){cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_role_num",e),this.curRoleNum=this.roleNumList[e],this.refreshCkRound()},OnSelectRound:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(8,1));this.setRound(t)}else"unselected"==e.name&&e.target.setSelected(!0)},OnSelectColor:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(8,1));this.setCurColor(t)}else"unselected"==e.name&&e.target.setSelected(!0)},OnSelectRate:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(7,1));this.setRate(t)}else"unselected"==e.name&&e.target.setSelected(!0)},tap_btn_change_red5:function(){for(var e=[],t=0;t<ALL_CARDS.length;t++){var r=ALL_CARDS[t];r<64&&r!=this.curFiveValue&&e.push(r)}var a=Math.ceil(Math.random()*e.length),r=e[a]||this.defaultFiveValue;this.setRed5Lab(r)},tap_btn_master0:function(e){this.setMater(0)},tap_btn_master1:function(e){this.setMater(1)},OnSelectWin:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(6,1));this.setWin(t)}else"unselected"==e.name&&e.target.setSelected(!0)},OnSelectArea:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(7,1));this.setArea(t)}else"unselected"==e.name&&e.target.setSelected(!0)},OnSelectRoleNum:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(11,1));this.setRoleNum(t)}else"unselected"==e.name&&e.target.setSelected(!0)},OnSelectJoke:function(e){if("selected"==e.name){var t=parseInt(e.target.name.substr(7,1));this.setJoke(t)}else"unselected"==e.name&&e.target.setSelected(!0)},setOther:function(){for(var e=0;e<4;e++){var t=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_other"+e)||0),r=this["ck_other"+e];r&&r.setSelected(1==t)}this.refreshCkRound()},OnSelectOther:function(e){var t=parseInt(e.target.name.substr(8,1));"selected"==e.name?(cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_other"+t,1),this.setOther()):"unselected"==e.name&&(cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_other"+t,0),this.setOther())},setTypeNum:function(){for(var e=0;e<4;e++){var t=parseInt(cc.sys.localStorage.getItem(GAME_TYPE+"_ceate_room_type"+e)||0),r=this["ck_type"+e];r&&r.setSelected(1==t),0==e?this.curType=t:1==e?this.curJoke=t:2==e&&(this.curFive=t)}this.refreshCkRound()},OnSelecType:function(e){var t=parseInt(e.target.name.substr(7,1));"selected"==e.name?(cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_type"+t,1),this.setTypeNum()):"unselected"==e.name&&(cc.sys.localStorage.setItem(GAME_TYPE+"_ceate_room_type"+t,0),this.setTypeNum())},tap_btn_create:function(){if(this.curCost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");this.curRoleNum=4;var e=0;this.ck_other0&&this.ck_other0.isSelected()&&(e=1);var t=0;this.curFive&&(t=this.curFiveValue||this.defaultFiveValue);var r={has_more_color:this.curColor,has_joker:this.curJoke,game_type:GAME_TYPE,full_num:this.curRoleNum,is_win_cost_mode:this.curWin,score_max_ratio:this.curRate+1,is_master_mode:this.curMaster,full_round:this.curRound,area:this.curArea+1,crazy_lv:this.curType+1,check_maker_poker:t,is_auto_deal:e};r.auto_deal_time=FORMATION_TIME+5,ME_D.send_message(CMD_CREATE_DESK,r)}}),CreateRoomDlg.create=function(e,t,r){return new CreateRoomDlg(e,t,r)},ModuleMgr.registerModule("CreateRoomDlg",CreateRoomDlg),CreateRoomXxDlg=CreateRoomDlg.extend({uiPath:"ui/CreateRoomXxDlg.ui",refreshCost:function(){var e={crazyLv:this.curType+1,hasJoker:this.curJoke,round:this.curRound,curColor:this.curColor},t=DataMgr.gameCtrl.getRoomCardCost(e);this.curCost=t,this.lab_cost&&this.lab_cost.setString(this.curCost)}}),CreateRoomXxDlg.create=function(e,t,r){return new CreateRoomXxDlg(e,t,r)},CreateRoomLsDlg=CreateRoomDlg.extend({uiPath:"ui/CreateRoomLsDlg.ui",curFive:0,tap_btn_create:function(){if(this.curCost>ME_D.get_user().room_card)return ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！");this.curRoleNum=4;var e=0;this.ck_other0&&this.ck_other0.isSelected()&&(e=1);var t=0;this.curFive&&(t=this.curFiveValue||this.defaultFiveValue);var r={has_more_color:this.curColor,has_joker:this.curJoke,game_type:GAME_TYPE,full_num:this.curRoleNum,is_win_cost_mode:this.curWin,score_max_ratio:this.curRate+1,is_master_mode:this.curMaster,full_round:this.curRound,is_spec_poker:this.curArea,crazy_lv:this.curType+1};r.check_maker_poker=t,r.auto_deal_time=FORMATION_TIME+5,r.is_auto_deal=e,ME_D.send_message(CMD_CREATE_DESK,r)}}),CreateRoomLsDlg.create=function(e,t,r){return new CreateRoomLsDlg(e,t,r)},JoinRoomDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/JoinRoomDlg.ui",roomName:null,gameState:null,gameType:null,inputIdx:1,maxNum:6,isCatchTouch:!0,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},onLoaded:function(){this.onReset()},onReset:function(){for(var e=1;e<=this.maxNum;e++)this["lab_num"+e].setString("");inputIdx=1},tap_btn_del:function(e){null!=this["lab_num"+(inputIdx-1)]&&(inputIdx--,this["lab_num"+inputIdx].setString(""))},tap_btn_reset:function(e){this.onReset()},tap_btn_join:function(e){for(var t=0,r=1;r<=this.maxNum;r++)t+=parseInt(this["lab_num"+r].getString()),t*=10;t/=10,ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:t})},DoSelectNum:function(e){if("ended"==e.name){if(inputIdx>this.maxNum)return;var t=e.target.name.substr(7,1);if(this["lab_num"+inputIdx].setString(t),inputIdx++,inputIdx>this.maxNum)return void this.tap_btn_join(e)}}}),JoinRoomDlg.create=function(e,t,r){return new JoinRoomDlg(e,t,r)},ModuleMgr.registerModule("JoinRoomDlg",JoinRoomDlg),MainLayer=QPLayer.extend({uiPath:"ui/MainLayer.ui",_contentNode:null,ctor:function(e,t,r){e=e||this.uiPath,QPLayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){0==cc.sys.isNative&&doMainShare(),checkPhone(DataMgr.accountCtrl.telephone)&&this.btn_bind_phone.setVisible(!1);var e=this;if(this.addListener("SuccessBindPhone",function(t){e.btn_bind_phone.setVisible(!1),e.sortGrp("grp_activity",5,0,1)}),this.addListener("success_receive_native_rewards",function(t){e.refreshDownBtn()}),this.refreshDownBtn(),this.btn_turning_activity&&this.btn_turning_activity.setVisible(!1),this.sortGrp("grp_activity",5,0,1),gInReview&&this.grp_activity.setVisible(!1),GAME_TYPE==GAME_TYPE_GP&&this.btn_niuniu.setVisible(!0),isAgent()&&(cc.sys.isNative?this.grp_activity.setVisible(!1):(this.btn_turning_activity.setVisible(!1),this.btn_share.setVisible(!1),this.btn_bind_phone.setVisible(!1),GAME_TYPE==GAME_TYPE_WZ?this.btn_down.setVisible(!1):this.btn_down.setVisible(!0),this.grp_activity.setVisible(!0),this.sortGrp("grp_activity",5,0,1))),NetMsg.is_kicked){NetMsg.is_kicked=!1;var t=function(){};ModuleMgr.showConfirmTxtMsg("你已被房主请离房间",t)}DataMgr.accountCtrl.bolFromHall()?this.btn_home&&this.btn_home.setVisible(!0):this.btn_home&&this.btn_home.setVisible(!1)},refreshDownBtn:function(){var e=DataMgr.timeCtrl.getReceiveNativeRewards(),t=e[GAME_TYPE];cc.sys.isNative?null==t||void 0==t||t<=0?this.btn_down.setVisible(!0):this.btn_down.setVisible(!1):t>0?this.btn_down.setVisible(!1):this.btn_down.setVisible(!0),this.sortGrp("grp_activity",5,0,1)},tap_btn_niuniu:function(){var e=getQueryString("test")||0;return cc.sys.isNative?void platform.share("开房间玩牛牛","开好房了，就等你们一起来牛牛啦！晚了位置就没了哟~",SHARE_URL+"nn?test="+e,0):void cc.sys.openURL(SHARE_URL+"nn?test="+e)},tap_btn_home:function(){goHome()},tap_btn_join:function(){0==DataMgr.gameCtrl.deskIdx?ModuleMgr.runDlg("JoinRoomDlg"):ME_D.send_message(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:DataMgr.gameCtrl.deskIdx})},tap_btn_bind_phone:function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")},tap_btn_turning_activity:function(){var e=function(){ModuleMgr.runDlg("ActivityTurningDlg")};DataMgr.activityCtrl.getTurnActivity(e)},tap_btn_activity:function(){ModuleMgr.runDlg("ActivityDlg")},tap_btn_share:function(){ModuleMgr.runDlg("ActivityShareDlg")},tap_btn_down:function(){isAgent()?cc.sys.openURL(getNativeDownUrl()):ModuleMgr.runDlg("ActivityDownDlg")},tap_btn_create:function(){0==DataMgr.gameCtrl.deskIdx?ModuleMgr.runDlg("CreateRoomDlg"):ME_D.send_message_waiting(CMD_ENTER_DESK,{game_type:GAME_TYPE,desk_idx:DataMgr.gameCtrl.deskIdx})}}),MainLayer.create=function(e,t,r){return new MainLayer(e,t,r)},ModuleMgr.registerModule("MainLayer",MainLayer),RoleInfoBottom=QPLayer.extend({uiPath:"ui/RoleInfoBottom.ui",onLoaded:function(){},tap_btn_help:function(){ModuleMgr.runDlg("HelpImgDlg")},tap_btn_news:function(){var e=function(e){ModuleMgr.runDlg("NewsDlg",e,null,null)};DataMgr.recordCtrl.getNews(e)},tap_btn_record:function(){var e=function(e){ModuleMgr.runDlg("RecordDlg",e,null,null)};DataMgr.recordCtrl.getRecord(e)},tap_btn_set:function(){ModuleMgr.runDlg("SetingDlg")},tap_btn_exit:function(){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()}}),RoleInfoBottom.create=function(e,t,r){return new RoleInfoBottom(e,t,r)},UIUtils.RegisterPathTemple("ui/RoleInfoBottom.ui",RoleInfoBottom),RoleInfoTop=QPLayer.extend({uiPath:"ui/RoleInfoTop.ui",city:null,onLoaded:function(){var e=this;e.addListener("SuccessBind",function(t){e.checkBindBtn()}),e.checkBindBtn(),e.addListener("userChange",function(t){e.refreshUi()});var t=function(t){e.city=t,e.refreshUi()};DataMgr.getCityCallback(t),e.refreshUi()},refreshUi:function(){this.city?this.lab_name.setString("["+this.city+"]"+toDecodeURIComponent(ME_D.get_user().name)):this.lab_name.setString(toDecodeURIComponent(ME_D.get_user().name)),this.lab_stone.setString(ME_D.get_user().room_card),this.lab_id.setString("ID:"+ME_D.get_user().account_uid),this.item_head.setData({url:ME_D.get_user().headimgurl})},checkBindBtn:function(){if(gInReview)return void this.btn_bind.setVisible(!1);var e=ME_D.get_user().extend_uid||"";isAgent()?this.btn_bind.setVisible(0==e.length):this.btn_bind.setVisible(!1)},tap_btn_bind:function(){ModuleMgr.runDlg("InviteDlg")},tap_btn_buy:function(){return"1"==isTestServer||gInReview?void ModuleMgr.runDlg("MallDlg"):void(isAgent()?(GAME_PAY_TYPE==GAME_PAY_TYPE_JTPAY&&(cc.sys.isNative?ModuleMgr.runDlg("MallDlg"):ModuleMgr.showConfirmCancelMsg("请下载客户端充值",function(){cc.sys.openURL(getNativeDownUrl())})),ModuleMgr.runDlg("MallDlg")):ModuleMgr.runDlg("BuyDlg"))}}),RoleInfoTop.create=function(e,t,r){return new RoleInfoTop(e,t,r)},UIUtils.RegisterPathTemple("ui/RoleInfoTop.ui",RoleInfoTop),NewsDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/NewsDlg.ui",roomName:null,gameState:null,gameType:null,data:null,ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},getStr:function(e){var t="";return t+=e.title+"[br]",t+=e.content},dlgActionEnd:function(){if(QPDlg.prototype.dlgActionEnd.call(this),!gInReview){for(var e=this.data.list||[],t=0,r=18,a=0;a<5;a++){var i=this["lab_new_"+a];if(i)if(a<e.length){i.setVisible(!0),i.setString(this.getStr(e[a]));var s=i.getVirtualRendererSize();t+=s.height+r}else i.setVisible(!1)}var n=this.scr_view.getContentSize();n.height<t&&(n.height=t),this.scr_view.setInnerContainerSize(n),t=n.height;for(var a=0;a<5;a++){var i=this["lab_new_"+a];i&&i.isVisible()&&(i.setPositionY(t),t=t-i.getVirtualRendererSize().height-r)}}}}),NewsDlg.create=function(e,t,r){return new NewsDlg(e,t,r)},ModuleMgr.registerModule("NewsDlg",NewsDlg),HelpDlg=QPDlg.extend({uiPath:"ui/HelpDlg.ui",totalHeight:0,updateDt:0,isOver:!1,addIndex:0,scrMaxHeight:1e4,isLoad:!1,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r),this.scheduleUpdate()},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this),this.item_base_tit.setVisible(!1);var e=this.scr_view.getContentSize();e.height=this.scrMaxHeight,this.scr_view.setInnerContainerSize(e),this.scr_view.setBounceEnabled(!0);var t=this,r=HelpTitleItem.create();r.setVisible(!1),this.addChild(r),this.isLoad=!0,t.scheduleUpdate()},update:function(e){if(this.isLoad){if(this.isOver)return this.restScroll(),void this.unscheduleUpdate();if(this.updateDt+=e,this.updateDt>.01){this.updateDt=0;var t=GAME_HELP_LIST[this.addIndex];if(this.addIndex++,!t)return void(this.isOver=!0);this.addTxt(t)}}},restScroll:function(){for(var e=this.scr_view.getChildren(),t=this.scrMaxHeight-this.totalHeight,r=0;r<e.length;r++){var a=e[r];a.setPositionY(a.getPositionY()-t)}var i=this.scr_view.getContentSize();i.height=this.totalHeight,this.scr_view.setInnerContainerSize(i)},addTxt:function(e){var t=null,r=0;if(1==e.type)t=HelpTitleItem.create(e),r=t.getContentSize().height;else if(2==e.type){var a={};t=new UIRichText(e.txt||"",{width:540,height:0},a),r=t.getVirtualRendererSize().height}t&&(t.setAnchorPoint(cc.p(0,1)),t.setPosition(cc.p(0,this.scrMaxHeight-this.totalHeight)),this.totalHeight=this.totalHeight+r+20,this.scr_view.addChild(t))}}),HelpDlg.create=function(e,t,r){return new HelpDlg(e,t,r)},ModuleMgr.registerModule("HelpDlg",HelpDlg),HelpImgDlg=QPDlg.extend({uiPath:"ui/HelpImgDlg.ui",totalHeight:0,updateDt:0,isOver:!1,addIndex:0,scrMaxHeight:1e4,isLoad:!1,cur_list:null,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r),this.scheduleUpdate()},setImg:function(){var e=this,t=e.scr_view.getContentSize();cc.loader.load(HELP_IMG_CFG,function(e,t,r){},function(){for(var r=0,a=HELP_IMG_CFG.length-1;a>=0;a--){var i=ccui.ImageView.create();i.loadTexture(HELP_IMG_CFG[a]),i.anchorX=.5,i.anchorY=0,i.y=r,i.x=t.width/2,e.scr_view.addChild(i),r+=i.height}t.height=r,e.scr_view.setInnerContainerSize(t),e.scr_view.setBounceEnabled(!0)})},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);var e=this.scr_view.getContentSize();this.scr_view.orgH=e.height,this.setImg()}}),HelpImgDlg.create=function(e,t,r){return new HelpImgDlg(e,t,r)},ModuleMgr.registerModule("HelpImgDlg",HelpImgDlg),HelpTitleItem=QPLayer.extend({uiPath:"ui/HelpTitleItem.ui",ctor:function(e,t,r){this.data=e,QPLayer.prototype.ctor.call(this,this.uiPath,t,r)},onLoaded:function(){this.data&&this.lab_title.setString(this.data.txt)}}),HelpTitleItem.create=function(e,t,r){return new HelpTitleItem(e,t,r)},UIUtils.RegisterPathTemple("ui/HelpTitleItem.ui",HelpTitleItem),RecordDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/RecordDlg.ui",roomName:null,gameState:null,gameType:null,listView_item:null,ctor:function(e,t,r){this.data=e,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,t)},dlgActionEnd:function(){QPDlg.prototype.dlgActionEnd.call(this);var e=this.data.lists||[];0==e.length?(this.lab_none.setVisible(!0),this.listView.setVisible(!1)):(this.lab_none.setVisible(!1),this.listView.setVisible(!0),this.refreshList({name:"listView",list:e,async:!0}))}}),RecordDlg.create=function(e,t,r){return new RecordDlg(e,t,r)},ModuleMgr.registerModule("RecordDlg",RecordDlg),RecordItem=QPListItem.extend({isControlNode:!0,uiPath:"ui/RecordItem.ui",selectCallback:null,data:null,ctor:function(e,t,r){this.data=e,QPListItem.prototype.ctor.call(this,this.uiPath,t)},parseTime:function(e){var t=new Date(1e3*e),r="";return r+=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r+=t.getDate()+" ",r+=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",r+=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()},getMyScore:function(e){if(null==e)return 0;var t=ConvertToJson(e),r=ME_D.get_rid(),a=t.users,i=0;if(t.users)for(var s=0;s<a.length;s++){var n=a[s];if(n.rid==r){i=s;break}}var o=t.score;if(null==o)return 0;var c="idx"+(i+1);return o[c]||0},setData:function(e){if(this.data=e,this.txt_num&&e){this.txt_num.setString(e.desk_no),this.txt_round.setString(e.full_round),this.txt_time.setString(this.parseTime(e.create_time));var t=this.getMyScore(e.record_detail);t=t>0?"+"+t:t,this.lab_score.setString(t);var r=DataMgr.recordCtrl.getOwnerInfo(e);r&&this.item_head.setData({url:r.headimgurl})}},tap_btn_view:function(){DataMgr.recordCtrl.showRecordDetail(this.data)}}),RecordItem.create=function(e,t,r){return new RecordItem(e,t,r)},ModuleMgr.registerModule("RecordItem",RecordItem),RecordDetail=QPDlg.extend({isControlNode:!0,uiPath:"ui/RecordDetailDlg.ui",curLoadSubUiIdx:0,curCost:0,grpType:0,ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t);var a=this;this.addListener("SUCCECES_ROOM_CREATE",function(e){a.close()})},onEnter:function(){QPDlg.prototype.onEnter.call(this)},parseTime:function(e){var t=new Date(1e3*e),r="";return r+=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r+=t.getDate()+" ",r+=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",r+=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()},getOwnerInfo:function(e){for(var t=e.desk_own_rid,r=ConvertToJson(e.record_detail),a=r.users,i=0;i<a.length;i++){var s=a[i];if(s.rid==t)return s}return null},onLoaded:function(){var e=this.data;this.txt_num.setString(e.deskId),this.txt_round.setString(e.round),this.txt_time.setString(this.parseTime(e.creatTime)),this.txt_name.setString(toDecodeURIComponent(e.ownerName));var t=cc.sys.isNative;if(this.grp_official.setVisible(!t),this.grp_h5_again.setVisible(!t),this.grp_native_again.setVisible(t),this.img_ewm.setVisible(t),this.lab_ewm.setVisible(t),this.grp_share.setVisible(!0),this.refreshRank(this.data),this.grp_share.oldY=this.grp_share.getPositionY(),this.grp_share.oldX=this.grp_share.getPositionX(),this.checkGrp(),e.dlgType&&1==e.dlgType||0==DataMgr.gameCtrl.deskIdx){this.grp_h5_again.setVisible(!1),this.grp_native_again.setVisible(!1);var r=this.grp_share.getPositionY()-40;this.grp_share.setPositionY(r),this.grp_official.setPositionY(r),this.btn_details&&(this.btn_details.y=this.btn_details.y-40),this.btn_help&&(this.btn_help.y=this.btn_help.y-40)}else if(DataMgr.gameCtrl&&DataMgr.gameCtrl.deskInfo){var a={crazyLv:DataMgr.gameCtrl.deskInfo.crazy_lv||0,hasJoker:DataMgr.gameCtrl.deskInfo.has_joker||0,round:DataMgr.gameCtrl.deskInfo.full_round,curColor:DataMgr.gameCtrl.deskInfo.has_more_color};this.curCost=DataMgr.gameCtrl.getRoomCardCost(a),this.lab_h5_cost.setString(this.curCost),this.lab_native_cost.setString(this.curCost)}GAME_TYPE!=GAME_TYPE_GP&&(this.img_ewm.setVisible(!1),this.lab_ewm.setVisible(!1),this.grp_official.setVisible(!1),this.grp_native_again.setVisible(!1),this.grp_h5_again.setVisible(!1),this.grp_share.setPositionY(this.grp_share.oldY-40),SCREEN_CUR_ORIENTATION==SCREEN_ORIENTATION_PROTRAIT&&(e.dlgType&&1==e.dlgType?this.grp_share.setPositionX(this.grp_share.oldX-120):(this.grp_native_again.setVisible(!0),this.grp_native_again.setPositionY(this.grp_share.oldY-40),this.grp_share.setPositionX(this.grp_share.oldX-245))))},checkGrp:function(){1==this.grpType?(this.grp_help&&this.grp_help.setVisible(!0),this.grp_details&&this.grp_details.setVisible(!1),this.btn_details&&this.btn_details.setVisible(!0),this.btn_help&&this.btn_help.setVisible(!1)):(this.grp_help&&this.grp_help.setVisible(!1),this.grp_details&&this.grp_details.setVisible(!0),this.btn_details&&this.btn_details.setVisible(!1),this.btn_help&&this.btn_help.setVisible(!0))},tap_btn_help:function(){this.grpType=1,this.checkGrp()},tap_btn_details:function(){this.grpType=0,this.checkGrp()},getMyLoseScore:function(e,t,r){for(var a=0,i=0;i<e.length;i++){var s=e[i];(r&&s.win==t&&s.fail==ME_D.get_user().account_uid||!r&&s.fail==t&&s.win==ME_D.get_user().account_uid)&&(a+=s.score)}return r?-a:a},initHelpGrp:function(e){if(this.grp_help){for(var t={},r=0;r<e.length;r++){var a=e[r];t[a.fail]||(t[a.fail]=[]),t[a.fail].push(a)}for(var r=0;r<6;r++){var i=this["item_help_"+r];i&&i.setVisible(!1)}var s=0,n={};for(var o in t){for(var c=t[o],r=0;r<c.length;r++){var a=c[r];r%2==0&&(n={},n.failPlayer=this.getPlayer(o),n.winPlayers=[],r>=2?n.failShow=!1:n.failShow=!0);var l=this.getPlayer(a.win);l&&(l.winScore=a.score),n.winPlayers.push(l),n.winPlayers.length>=2&&this["item_help_"+s]&&(this["item_help_"+s].setVisible(!0),this["item_help_"+s].setData(n),s++)}n.winPlayers.length<2&&this["item_help_"+s]&&(this["item_help_"+s].setVisible(!0),this["item_help_"+s].setData(n),s++)}}},getPlayer:function(e){if(!this.data)return{};for(var t=this.data.players||[],r=0;r<t.length;r++)if(t[r].account_uid==e)return gDeepDup(t[r]);return{}},refreshRank:function(e){for(var t=[],r=[],a=0;a<e.players.length;a++){var i=e.players[a];i&&(i.round=e.round,i.sortNum=i.score,t.push(i),r.push({id:i.account_uid,score:i.score}))}t.sort(function(e,t){return t.sortNum-e.sortNum});var s=gCalScore(r);this.initHelpGrp(gDeepDup(s));for(var n=!1,a=0;a<8;a++){var o=this["item_detail_"+a];if(o){var c=t[a];c?(o.setVisible(!0),c.account_uid&&(n=!0),c.loseScore=this.getMyLoseScore(s,c.account_uid,c.score>0),c.rank=a+1,c.isOwner=c.rid==e.ownerRid,o.setData(c)):o.setVisible(!1)}}n&&this.txt_id.setString("ID")},tap_btn_share:function(){var e=this.data,t="";if(e.crazyLv&&e.crazyLv>1&&(t="（疯狂场）"),cc.sys.isNative){var r="",a=function(){platform.shareImage(r,0)};r=saveScreenShot(a)}else platform.share(GAME_NAME+"战绩"+t,"房间号:"+e.deskId+"  局数:"+e.round+"  时间:"+this.parseTime(this.data.creatTime)+"  点击查看详情",getShareUrl(0,e.recordId),0,SHARE_URL+"ttw/res/icon/record3.png")},tap_btn_close:function(){this.close(),this.data.dlgType&&1==this.data.dlgType||ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"refuse_buy"})},again:function(){return this.curCost>ME_D.get_user().room_card?ModuleMgr.showTipMsg("您的"+ROOM_CARD_NAME+"不足！"):void ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"room_buy_by_card"})},tap_btn_h5_again:function(){this.again()},tap_btn_native_again:function(){this.again()},tap_btn_official:function(){cc.sys.openURL(H5_FOCUS_PUBLIC_URL)},tap_btn_close:function(){this.close(),this.data.dlgType&&1==this.data.dlgType||(0==DataMgr.gameCtrl.deskIdx?ModuleMgr.runScene("EnterScene"):(DataMgr.gameCtrl.deskIdx=0,ME_D.send_message(CMD_ROOM_MESSAGE,"desk_op",{oper:"leave_desk"})))}}),RecordDetail.create=function(e,t,r){return new RecordDetail(e,t,r)},ModuleMgr.registerModule("RecordDetail",RecordDetail),SetingDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/SetingDlg.ui",_effectsVolume:1,_musicVolume:1,ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onEnter:function(){QPDlg.prototype.onEnter.call(this)},tap_btn_bind_phone:function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")},onExit:function(){QPDlg.prototype.onExit.call(this),this.unscheduleAllCallbacks()},setMusic:function(e){this._musicVolume=e;var t=e<=0;this.lab_open_music.setVisible(!t),this.lab_close_music.setVisible(t),gSetMusic(t)},setEffect:function(e){this._effectsVolume=e;var t=e<=0;this.lab_effect_open.setVisible(!t),this.lab_effect_close.setVisible(t),gSetMusicEffect(t)},onLoaded:function(){var e=cc.sys.localStorage.getItem("musicVolume"),t=cc.sys.localStorage.getItem("effectsVolume");null==e&&(e=1),null==t&&(t=1),this.setMusic(e),this.setEffect(t),null==this.txt_phone.oldTxt&&(this.txt_phone.oldTxt=this.txt_phone.getString());var r=this;if(this.addListener("SuccessBindPhone",function(e){r.txt_phone.setString(r.txt_phone.oldTxt+DataMgr.accountCtrl.telephone)}),DataMgr.accountCtrl.telephone&&""!=DataMgr.accountCtrl.telephone?this.txt_phone.setString(this.txt_phone.oldTxt+DataMgr.accountCtrl.telephone):this.txt_phone.setString(this.txt_phone.oldTxt+"无"),isAgent()){this.txt_bind&&this.txt_bind.setVisible(!0);var a=ME_D.get_user().extend_uid||"";0==a.length?this.setText("txt_bind","无"):this.setText("txt_bind",a)}else this.txt_bind&&this.txt_bind.setVisible(!1);this.txt_bind&&this.txt_bind.setVisible(!1),gInReview&&(this.btn_share_wx.setVisible(!1),this.btn_share_py.setVisible(!1))},tap_btn_switch_music:function(){this._musicVolume<=0?this.setMusic(1):this.setMusic(0)},tap_btn_switch_effect:function(){this._effectsVolume<=0?this.setEffect(1):this.setEffect(0)},tap_btn_logout:function(){DataMgr.accountCtrl.lastLoginTime=0,WsNetwork.getInstance().close()},tap_btn_share_wx:function(){platform.share("开房间玩"+GAME_NAME,"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~",getShareUrl(0,0),0)},tap_btn_share_py:function(){platform.share("开房间玩"+GAME_NAME,"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~",getShareUrl(0,0),1);
},tap_btn_close:function(){this.close()}}),SetingDlg.create=function(e,t,r){return new SetingDlg(e,t,r)},ModuleMgr.registerModule("SetingDlg",SetingDlg),BuyDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/BuyDlg.ui",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){}}),BuyDlg.create=function(e,t,r){return new BuyDlg(e,t,r)},ModuleMgr.registerModule("BuyDlg",BuyDlg),RecordDetailItem=QPLayer.extend({isControlNode:!0,uiPath:"ui/RecordDetailItem.ui",data:null,ctor:function(e,t,r){e=e||this.uiPath,QPLayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){},setData:function(e){var t=(e.rank||1,e.name),r=e.score,a=(e.round,e.isOwner);this.txt_name.setString(toDecodeURIComponent(t)),this.txt_round.setString(e.account_uid||e.round),this.txt_score.setString(r),this.img_house.setVisible(a),0==e.loseScore?this.txt_lose_score&&this.txt_lose_score.setString(""):this.txt_lose_score&&this.txt_lose_score.setString(e.loseScore),e.account_uid==ME_D.get_user().account_uid?(this.img_mySelf&&this.img_mySelf.setVisible(!0),this.img_normal&&this.img_normal.setVisible(!1)):(this.img_mySelf&&this.img_mySelf.setVisible(!1),this.img_normal&&this.img_normal.setVisible(!0)),this.item_head.setData({url:e.headUrl})}}),RecordDetailItem.create=function(e,t,r){return new RecordDetailItem(e,t,r)},ModuleMgr.registerModule("RecordDetailItem",RecordDetailItem),UIUtils.RegisterPathTemple("ui/RecordDetailItem.ui",RecordDetailItem),UIUtils.RegisterPathTemple("ui_landscape/RecordDetailItem.ui",RecordDetailItem),RecordDetailItem1=QPLayer.extend({isControlNode:!0,uiPath:"ui/RecordDetailItem1.ui",ctor:function(e,t,r){e=e||this.uiPath,QPLayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){},setData:function(e){var t=e.failShow||!1;this.item_head_lose&&this.item_head_lose.setVisible(t),this.txt_id_lose&&this.txt_id_lose.setVisible(t),this.txt_lose_real_score&&this.txt_lose_real_score.setVisible(t),t||(this.y=this.y+5);var r=e.failPlayer||{};this.item_head_lose&&this.item_head_lose.setData({url:r.headUrl}),this.txt_id_lose&&this.txt_id_lose.setString("ID:"+r.account_uid),this.setText("txt_lose_real_score",r.score),r.account_uid==ME_D.get_user().account_uid&&this.txt_id_lose&&(this.txt_id_lose.color=cc.color(253,176,176));for(var a=e.winPlayers||{},i=0;i<2;i++){var s=a[i],n=i+1,o=this["grp_win_"+n];o&&(s?(o.setVisible(!0),this["item_head_win_"+n]&&this["item_head_win_"+n].setData({url:s.headUrl}),this["txt_id_win_"+n]&&this["txt_id_win_"+n].setString("ID:"+s.account_uid),this.setText("txt_score_win_"+n,s.winScore),this.setText("txt_real_score_win_"+n,s.score),s.account_uid==ME_D.get_user().account_uid&&this["txt_id_win_"+n]&&(this["txt_id_win_"+n].color=cc.color(253,176,176))):o.setVisible(!1))}}}),RecordDetailItem1.create=function(e,t,r){return new RecordDetailItem1(e,t,r)},UIUtils.RegisterPathTemple("ui/RecordDetailItem1.ui",RecordDetailItem1),UIUtils.RegisterPathTemple("ui_landscape/RecordDetailItem1.ui",RecordDetailItem1),HeadIcon=UrlHead.extend({isControlNode:!0,uiPath:"ui/HeadIcon.ui",data:null,ctor:function(e,t,r){e=e||this.uiPath,UILayer.prototype.ctor.call(this,e,t,r)},onLoaded:function(){},setData:function(e){var t=e.url;this.setUrl(t)}}),HeadIcon.create=function(e,t,r){return new HeadIcon(e,t,r)},UIUtils.RegisterPathTemple("ui/HeadIcon.ui",HeadIcon),BindDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/BindDlg.ui",_inputText:"",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t);var a=this;this.addListener("SuccessBind",function(e){a.close()})},onLoaded:function(){this._inputText=this.lab_input.getString()},tap_btn_send:function(){var e=this.lab_input.getString()||0;return e==this._inputText||0==e.length?ModuleMgr.showTipMsg("代理ID 不能为空！"):void ME_D.send_message_waiting(CMD_BIND_EXTEND,{extend_uid:e})}}),BindDlg.create=function(e,t,r){return new BindDlg(e,t,r)},ModuleMgr.registerModule("BindDlg",BindDlg),ActivityDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityDlg.ui",ctor:function(e,t,r){this.data=e,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){}}),ActivityDlg.create=function(e,t,r){return new ActivityDlg(e,t,r)},ModuleMgr.registerModule("ActivityDlg",ActivityDlg),ActivityItem=QPListItem.extend({isControlNode:!0,uiPath:"ui/ActivityItem.ui",selectCallback:null,data:null,ctor:function(e,t,r){this.data=e,QPListItem.prototype.ctor.call(this,this.uiPath,t)},parseTime:function(e){var t=new Date(1e3*e),r="";return r+=(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-",r+=t.getDate()+" ",r+=(t.getHours()<10?"0"+t.getHours():t.getHours())+":",r+=t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()},setData:function(e){if(this.data=e,this.txt_num&&e){this.txt_num.setString(e.desk_no),this.txt_round.setString(e.full_round),this.txt_time.setString(this.parseTime(e.create_time));var t=this.getMyScore(e.record_detail);t=t>0?"+"+t:t,this.lab_score.setString(t);var r=DataMgr.recordCtrl.getOwnerInfo(e);r&&this.item_head.setData({url:r.headimgurl})}},tap_btn_view:function(){DataMgr.recordCtrl.showRecordDetail(this.data)}}),ActivityItem.create=function(e,t,r){return new ActivityItem(e,t,r)},ModuleMgr.registerModule("ActivityItem",ActivityItem),ActivityTurningDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityTurningDlg.ui",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){for(var e=DataMgr.activityCtrl.turnData,t=0;t<e.length&&t<8;t++)this["txt_num"+(t+1)].setString(this.getDesc(e[t].itemId,e[t].itemNum)),this["icon"+(t+1)].id=e[t].id,this["icon"+(t+1)].idx=t+1,this["icon"+(t+1)].data=e[t],this["icon"+(t+1)].loadTexture("res/uires/activity/reward_"+e[t].itemId+".png");for(var t=e.length;t<8;t++)this["icon"+(t+1)].setVisible(!1),this["txt_num"+(t+1)].setString("");this.txt_info.setString("还有"+DataMgr.timeCtrl.getLeftTurnTimes()+"次")},getItemById:function(e){for(var t=0;t<8;t++)if(this["icon"+(t+1)].id==e)return this["icon"+(t+1)];return item},getDesc:function(e,t){return 1==e?t+"个"+ROOM_CARD_NAME:2==e?t+"元话费":3==e?"小米盒子":4==e?"ipad mini":void 0},showReward:function(e,t){var r=this.getItemById(e),a=r.idx,i=r.data.itemId,s=r.data.itemNum;this.turn_bg.setRotation(0);var n=25222-45*a,o=this,c=function(){o.isTurning=!1,ModuleMgr.showConfirmTxtMsg("恭喜您获得"+o.getDesc(i,s))};DataMgr.timeCtrl.subLeftTurnTimes(1),this.txt_info.setString("还有"+DataMgr.timeCtrl.getLeftTurnTimes()+"次"),this.isTurning=!0,this.turn_bg.runAction(cc.sequence(cc.EaseOut.create(cc.rotateBy(8,n),20),cc.delayTime(1),cc.callFunc(c)))},tap_btn_turn:function(){if(1!=this.isTurning){if(0==checkPhone(DataMgr.accountCtrl.telephone)){var e=function(){ModuleMgr.runDlg("ActivityBindPhoneDlg")};return void ModuleMgr.showConfirmCancelMsg("请先绑定合法的手机号",e)}if(DataMgr.timeCtrl.getLeftTurnTimes()<=0)return void ModuleMgr.showTipMsg("您已经没有抽奖次数了");var t=this,r=function(e){t.showReward(e.id,e.itemName)};DataMgr.activityCtrl.doTurn(r)}}}),ActivityTurningDlg.create=function(e,t,r){return new ActivityTurningDlg(e,t,r)},ModuleMgr.registerModule("ActivityTurningDlg",ActivityTurningDlg),ActivityBindPhoneDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/ActivityBindPhoneDlg.ui",_inputText:"",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){this.lab_phone_input.setString(DataMgr.accountCtrl.telephone),this.lab_input.setString(DataMgr.accountCtrl.wechat)},tap_btn_send:function(){var e=this.lab_phone_input.getString();if(0==checkPhone(e))return ModuleMgr.showTipMsg("请填写合法的手机号！");var t=this.lab_input.getString();if(""==t)return ModuleMgr.showTipMsg("微信号 不能为空！");var r=this,a=function(a){return 0!=a.ret?void ModuleMgr.showTipMsg(a.error):(DataMgr.accountCtrl.telephone=e,DataMgr.accountCtrl.wechat=t,ModuleMgr.showTipMsg("绑定成功"),cc.eventManager.dispatchCustomEvent("SuccessBindPhone"),void r.close())};DataMgr.activityCtrl.getBindPhone(e,t,a)}}),ActivityBindPhoneDlg.create=function(e,t,r){return new ActivityBindPhoneDlg(e,t,r)},ModuleMgr.registerModule("ActivityBindPhoneDlg",ActivityBindPhoneDlg),ActivityShareDlg=QPDlg.extend({uiPath:"ui/ActivityShareDlg.ui",shareCfgList:[{times:1,cards:1},{times:5,cards:3},{times:10,cards:5}],idx:0,ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t);var a=this;this.addListener("SuccessShareGame",function(e){a.refreshUi()}),this.addListener("SuccessShareAward",function(e){a.refreshUi()})},onLoaded:function(){this.refreshUi()},refreshUi:function(){this.idx=0;var e=this.shareCfgList[this.shareCfgList.length-1].times,t=DataMgr.timeCtrl.getTodayShareTime();this.bar_times.setPercent(t/e*100);for(var r=DataMgr.timeCtrl.getShareStatusList(),a=0;a<3;a++){var i=this["item_share_"+a];if(i){var s=this.shareCfgList[a],n={};n.times=s.times,n.cards=s.cards,n.status=r[a],i.setData(n)}}for(var a=0;a<this.shareCfgList.length;a++)if(t>=this.shareCfgList[a].times&&0==r[a]){this.idx=a+1;break}0==this.idx?this.grp_get.setVisible(!1):this.grp_get.setVisible(!0)},tap_btn_share:function(){platform.share("开房间玩"+GAME_NAME,"开好房了，就等你们一起来"+GAME_NAME+"啦！晚了位置就没了哟~",getShareUrl(0,0),1)},tap_btn_get:function(){ME_D.send_message_waiting(CMD_SHARE_AWARD,{idx:this.idx})}}),ActivityShareDlg.create=function(e,t,r){return new ActivityShareDlg(e,t,r)},ModuleMgr.registerModule("ActivityShareDlg",ActivityShareDlg),ActivityShareItem=QPLayer.extend({uiPath:"ui/ActivityShareItem.ui",_txt:null,ctor:function(e,t,r){e=e||this.uiPath,QPLayer.prototype.ctor.call(this,e,t,r)},setData:function(e){e||this.setVisible(!1),this.lab_times.setString(e.times),this.lab_cards.setString(e.cards),this.icon_get.setVisible(1==e.status)}}),ActivityShareItem.create=function(e,t,r){return new ActivityShareItem(e,t,r)},UIUtils.RegisterPathTemple("ui/ActivityShareItem.ui",ActivityShareItem),ActivityDownDlg=QPDlg.extend({uiPath:"ui/ActivityDownDlg.ui",ctor:function(e,t,r){this.data=e,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){var e=this;this.addListener("success_receive_native_rewards",function(t){e.close()}),this.refreshUi()},refreshUi:function(){var e=DataMgr.timeCtrl.getReceiveNativeRewards(),t=e[GAME_TYPE];cc.sys.isNative?null==t||void 0==t||t<=0?(this.btn_get.setVisible(!0),this.btn_down.setVisible(!1)):(this.btn_get.setVisible(!1),this.btn_down.setVisible(!1)):null==t||void 0==t?(this.btn_get.setVisible(!1),this.btn_down.setVisible(!0)):(this.btn_get.setVisible(!0),this.btn_down.setVisible(!1))},tap_btn_down:function(){cc.sys.openURL(SHARE_URL)},tap_btn_get:function(){return cc.sys.isNative?void ME_D.send_message_waiting(CMD_COMMON_OP,{oper:"receive_native"}):ModuleMgr.showTipMsg("请到原生客户端领取")}}),ActivityDownDlg.create=function(e,t,r){return new ActivityDownDlg(e,t,r)},ModuleMgr.registerModule("ActivityDownDlg",ActivityDownDlg),PayDlg=QPDlg.extend({isControlNode:!0,uiPath:"ui/PayDlg.ui",ctor:function(e,t,r){this.data=e,this.listView_item=RecordItem,QPDlg.prototype.ctor.call(this,this.uiPath,t)},onLoaded:function(){},OnPay:function(e){if("ended"==e.name){var t=e.target.name.substr(7,1);platform.pay(parseInt(t))}}}),PayDlg.create=function(e,t,r){return new PayDlg(e,t,r)},ModuleMgr.registerModule("PayDlg",PayDlg),InviteDlg=QPDlg.extend({uiPath:"ui/InviteDlg.ui",inputIdx:1,maxNum:6,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},onLoaded:function(){var e=this;e.onReset(),e.addListener("SuccessBind",function(t){e.close()})},onReset:function(){for(var e=1;e<=this.maxNum;e++)this["lab_num"+e].setString("");inputIdx=1},tap_btn_del:function(e){null!=this["lab_num"+(inputIdx-1)]&&(inputIdx--,this["lab_num"+inputIdx].setString(""))},tap_btn_reset:function(e){this.onReset()},tap_btn_sure:function(e){for(var t="",r=1;r<=this.maxNum;r++)t+=this["lab_num"+r].getString();ME_D.send_message_waiting(CMD_BIND_EXTEND,{extend_uid:t})},onSelectNum:function(e){if("ended"==e.name){if(inputIdx>this.maxNum)return;var t=e.target.name.substr(7,1);if(this["lab_num"+inputIdx].setString(t),inputIdx++,inputIdx>this.maxNum)return}}}),InviteDlg.create=function(e,t,r){return new InviteDlg(e,t,r)},ModuleMgr.registerModule("InviteDlg",InviteDlg),MallDlg=QPDlg.extend({uiPath:"ui/MallDlg.ui",momeyList:[6,30,68,128,328,648],bolBind:!1,bolAppStore:!1,ctor:function(e,t,r){e=e||this.uiPath,QPDlg.prototype.ctor.call(this,e,t,r)},onLoaded:function(){var e=ME_D.get_user().extend_uid||"";this.bolBind=!(0==e.length);var t=10;this.bolBind||(t=2),this.bolAppStore=!1,gInReview&&(this.bolAppStore=!0),this.bolBind||(this.bolAppStore=!0);for(var r=1;r<=6;r++){var a=this.momeyList[r-1]||0;this["lab_momey_"+r]&&this["lab_momey_"+r].setString(a),this.setText("lab_zhuanshi_"+r,a*t),this["grp_zhengsong"+r]&&this["grp_zhengsong"+r].setVisible(!this.bolAppStore)}if(gInReview?this.lab_bind&&this.lab_bind.setVisible(!1):this.lab_bind&&this.lab_bind.setVisible(!this.bolBind),GAME_TYPE==GAME_TYPE_GP){t=10;for(var r=1;r<=6;r++){this["icon"+r]&&this["icon"+r].loadTexture(GetRealPath("res/uires/main/mall/cy_lv"+r+".png"));var a=this.momeyList[r-1]||0;this["lab_zhuanshi_"+r].setString(a*t/20+"茶叶")}}if(GAME_TYPE==GAME_TYPE_LS){t=10;for(var r=1;r<=6;r++){this["icon"+r]&&this["icon"+r].loadTexture(GetRealPath("res/uires/main/mall/cy_lv"+r+".png"));var a=this.momeyList[r-1]||0;this["lab_zhuanshi_"+r].setString(a*t/10+"茶叶"),this["grp_zhengsong"+r]&&this["grp_zhengsong"+r].setVisible(!1)}}},OnPay:function(e){if("ended"==e.name){var t=e.target.name.substr(7,1);if(this.bolAppStore){if(cc.sys.isNative&&cc.sys.os==cc.sys.OS_IOS)return void platform.pay(t,0);var r=this,a=function(){r.close(),ModuleMgr.runDlg("InviteDlg")};ModuleMgr.showConfirmTxtMsg("请先绑定代理号",a)}else if(GAME_PAY_TYPE==GAME_PAY_TYPE_JTPAY)ModuleMgr.runDlg("RechangeDlg",t,null,null);else{var i=[6,30,68,128,328,648];HEEPAY_PAY_WEB(i[t-1])}}}}),MallDlg.create=function(e,t,r){return new MallDlg(e,t,r)},ModuleMgr.registerModule("MallDlg",MallDlg),RechangeDlg=QPDlg.extend({uiPath:"ui/RechangeDlg.ui",payType:0,payMoney:[6,30,68,128,328,648],userCode:"10210372",userAppid:"20170303171424262044",keyString:"238ccd182fbd8d52e7dc67127ce68564",ivString:"54c28d536fb54769",ctor:function(e,t,r){this.payType=e,QPDlg.prototype.ctor.call(this,this.uiPath,t,r),GAME_TYPE==GAME_TYPE_WZ&&(this.userCode="10211074",this.userAppid="20170413171630227041",this.keyString="549cc4e82fa4a75f71c2162c474afb30",this.ivString="940aabc8e46f579b"),GAME_TYPE==GAME_TYPE_LS&&(this.userCode="10211074",this.userAppid="20170612151336846359",this.keyString="2c0c6ded05dcad313bd7851223b5bfdf",this.ivString="1007f4ef54daa42f"),GAME_TYPE==GAME_TYPE_DD&&(this.userCode="10211074",this.userAppid="20170612151303846273",this.keyString="cf297c88c5951eaa26df13d4d4aece1e",this.ivString="afa5666896215b52"),GAME_TYPE==GAME_TYPE_Q8&&(this.userCode="10211074",this.userAppid="20170612151408846454",this.keyString="f29ecb0a70e48c156bafa33f8904cdb5",this.ivString="46f98ae79a8bfe52"),GAME_TYPE==GAME_TYPE_DZ&&(this.userCode="10211074",this.userAppid="20170612151350846400",this.keyString="758663b68af78ec0bd0ba8c79189d26d",this.ivString="9e591895dad0c36e"),GAME_TYPE==GAME_TYPE_QL&&(this.userCode="10211074",this.userAppid="20170612151459846595",this.keyString="a323adcc4575dae2b40b5bdfa59bbb56",this.ivString="61b315a4dcff214a"),GAME_TYPE==GAME_TYPE_GP&&(this.userCode="10211074",this.userAppid="20170502202200400082",this.keyString="7545083e7ca115122b76419d78af6070",this.ivString="6c70d864f62b0272")},onLoaded:function(){},get_order:function(e,t){var r={};this.moeny=e,r.p3_money=e,r.p1_usercode=this.userCode,r.p5_notifyurl="unknow",r.p4_returnurl="unknow",r.ownMoney=ME_D.get_user().room_card,0==r.ownMoney&&(r.ownMoney="0.0"),r.extendUid=ME_D.get_user().extend_uid,r.userName=ME_D.get_user().name,r.userRid=ME_D.get_user().rid,r.userUid=ME_D.get_user().account_uid,r.detail=GAME_TYPE;var a=GAME_WEB_PORT;GAME_TYPE==GAME_TYPE_GP&&(a=":1338");var i={method:"POST",timeout:5e3,url:GAME_WEB_URL+a+"/apijftpay/ApiRequestSign",data:JSON.stringify(r)},s=this;ModuleMgr.showWaitMsg("获取订单中",0),HttpNetworkRequest(i,function(e,r){ModuleMgr.removeWaitMsg(),console.log(r);var a=ConvertToJson(r);a.userCode=s.userCode,a.userAppid=s.userAppid,a.keyString=s.keyString,a.ivString=s.ivString,t(JSON.stringify(a))})},tap_btn_weixin:function(e){var t=this,r=function(e){platform.pay(t.moeny,3,e)};this.get_order(this.payMoney[this.payType-1],r)},tap_btn_zifubao:function(e){var t=this,r=function(e){platform.pay(t.moeny,4,e)};this.get_order(this.payMoney[this.payType-1],r)}}),RechangeDlg.create=function(e,t,r){return new RechangeDlg(e,t,r)},ModuleMgr.registerModule("RechangeDlg",RechangeDlg),L_GameLayer=GameLayer.extend({uiPath:"ui_landscape/Game.ui"}),L_GameLayer.create=function(e,t,r){return new L_GameLayer(e,t,r)},ModuleMgr.registerModule("L_GameLayer",L_GameLayer),L_GameCardFormation=GameCardFormation.extend({uiPath:"ui_landscape/GameCardFormation.ui"}),L_GameCardFormation.create=function(e,t,r){return new L_GameCardFormation(e,t,r)},ModuleMgr.registerModule("L_GameCardFormation",L_GameCardFormation),L_GameCardFormationHandle=GameCardFormationHandle.extend({uiPath:"ui_landscape/GameCardFormationHandle.ui"}),L_GameCardFormationHandle.create=function(e,t,r){return new L_GameCardFormationHandle(e,t,r)},ModuleMgr.registerModule("L_GameCardFormationHandle",L_GameCardFormationHandle),L_RecordDetail=RecordDetail.extend({uiPath:"ui_landscape/RecordDetailDlg.ui"}),L_RecordDetail.create=function(e,t,r){return new L_RecordDetail(e,t,r)},ModuleMgr.registerModule("L_RecordDetail",L_RecordDetail);var GAME_WEB_URL="http://120.77.126.37",SHARE_URL="http://www.gongpaa.com/",GAME_WEB_PORT="",LOGIN_PORT="";DOWN_RECORD_SERVER="http://120.24.16.201";var isTestServer=getQueryString("test")||"0",isHall="1"==getQueryString("is_hall"),gameType=getQueryString("game_type");"ttw_xx"==gameType?(GAME_WEB_URL="http://119.23.114.179",SHARE_URL="http://ywt.gongpaa.com/",GAME_WEB_PORT=":1339"):"ttw_wz"==gameType?(GAME_WEB_URL="http://119.23.114.179",SHARE_URL="http://ywt.gongpaa.com/",GAME_WEB_PORT=":1341",LOGIN_PORT="12545"):"ttw_ls"==gameType?(GAME_WEB_URL="http://119.23.114.179",SHARE_URL="http://ywt.gongpaa.com/",GAME_WEB_PORT=":1342",LOGIN_PORT="12645"):"ttw_dd"==gameType?(GAME_WEB_URL="http://119.23.114.179",SHARE_URL="http://ywt.gongpaa.com/",GAME_WEB_PORT=":1343",DOWN_RECORD_SERVER="http://ywt.gongpaa.com",LOGIN_PORT="12745"):"ttw_q8"==gameType?(GAME_WEB_URL="http://119.23.116.226",SHARE_URL="http://ywt2.gongpaa.com/",GAME_WEB_PORT=":13001",LOGIN_PORT="13002"):"ttw_ql"==gameType?(GAME_WEB_URL="http://119.23.116.226",SHARE_URL="http://ywt2.gongpaa.com/",GAME_WEB_PORT=":11001",LOGIN_PORT="11002"):"ttw_dz"==gameType?(GAME_WEB_URL="http://119.23.116.226",SHARE_URL="http://ywt2.gongpaa.com/",GAME_WEB_PORT=":12001",LOGIN_PORT="12002"):"ttw_dz2"==gameType?(GAME_WEB_URL="http://119.23.116.226",SHARE_URL="http://ywt2.gongpaa.com/",GAME_WEB_PORT=":14001",LOGIN_PORT="14002"):"ttw_ff"==gameType&&(GAME_WEB_URL="http://120.77.88.77",SHARE_URL="http://fafa.gongpaa.com/",GAME_WEB_PORT=":11003",LOGIN_PORT="11002"),"1"==isTestServer&&(GAME_WEB_URL="http://120.25.86.231",SHARE_URL="http://test.gongpaa.com/"),console.log("GAME_WEB_URL:"+GAME_WEB_URL),console.log("SHARE_URL:"+SHARE_URL);var errorStack={},logSaveServer=function(e,t,r,a,i){if(null==errorStack[e]){errorStack[e]="error",DataMgr.gameCtrl.myCards&&(e+=" card cards:"+DataMgr.gameCtrl.myCards);var s={method:"POST",timeout:5e3,url:GAME_WEB_URL+GAME_WEB_PORT+"/apijserror",data:JSON.stringify({msg:e,ext:i.stack,rid:ME_D.get_rid(),url:t+"  line:"+r+" col:"+a})};HttpNetworkRequest(s,function(e,t){})}};window&&(window.onerror=function(e,t,r,a,i){logSaveServer(e,t,r,a,i)});var gInReview=!1;sdk_set_inview=function(e){gInReview=e,cc.sys.os==cc.sys.OS_ANDROID&&(gInReview=!1)};var isDebug=getQueryString("debug")||0;if(0==isDebug&&(console.log=function(){}),cc.game.onStart=function(){if(!cc.sys.isNative&&document.getElementById("cocosLoading")&&document.body.removeChild(document.getElementById("cocosLoading")),DataMgr&&"function"==typeof DataMgr.setGameType&&DataMgr.setGameType(),initAudio(),cc.view.enableRetina(!0),cc.view.adjustViewPort(!0),cc.view.setOrientation(cc.ORIENTATION_PORTRAIT),cc.view.resizeWithBrowserSize(!0),0==cc.sys.isNative){var e=function(){cc.eventManager.dispatchCustomEvent("screen_change")};cc.view.setResizeCallback(e)}setScreenSize(),cc.Device&&cc.Device.setKeepScreenOn&&cc.Device.setKeepScreenOn(!0),UIDataUtils.SetUIPrefix("res/"),ModuleMgr.runScene("LoginScene")},goHome=function(){DataMgr.accountCtrl.setDeskInfo({gameType:GAME_TYPE,deskIdx:DataMgr.gameCtrl.deskIdx}),jsb.UpdateZipMgr&&jsb.UpdateZipMgr.Instance().enterHall()},goHome=function(){DataMgr.accountCtrl.setDeskInfo({gameType:GAME_TYPE,deskIdx:DataMgr.gameCtrl.deskIdx}),jsb.UpdateZipMgr&&jsb.UpdateZipMgr.Instance().enterHall()},"undefined"!=typeof DataMgr&&DataMgr.accountCtrl&&DataMgr.accountCtrl.bolFromHall()){cc.loader.releaseAll(),UIDataUtils.SetUIPrefix("res/"),DataMgr&&"function"==typeof DataMgr.setGameType&&DataMgr.setGameType();var deskInfo=DataMgr.accountCtrl.deskInfo;deskInfo&&DataMgr.accountCtrl.enterGameInfo.user&&(GAME_TYPE==deskInfo.gameType?(DataMgr.accountCtrl.enterGameInfo.user.desk_idx=deskInfo.deskIdx,DataMgr.accountCtrl.enterGameInfo.user.game_type=GAME_TYPE):(DataMgr.accountCtrl.enterGameInfo.user.desk_idx=0,DataMgr.accountCtrl.enterGameInfo.user.game_type=GAME_TYPE)),NetMsg.msg_enter_game(DataMgr.accountCtrl.enterGameInfo),ModuleMgr.runScene("EnterScene")}else cc.game.run();