{"version":3,"sources":["Player.js"],"names":["Socket","require","KQGlobalEvent","ArrayExtension","UserModelHelper","Playback","KQCardResHelper","KQCard","AudioManager","cc","Class","extends","Component","properties","foldCardNode","Node","teShuPaiNode","cardsBackLayout","Layout","compareCardsNode","userInfoNode","chatMessageNode","userAvatarNode","bulletHolePrefab","Prefab","bulletHoleNode","shotNode","userId","cardTypePrefab","_userInfo","_deskInfo","playedCompareCardsIndexs","visible","default","undefined","onLoad","on","EventType","TOUCH_START","_showUserInfo","reset","foldCardNodeBack","cardSpriteAtlas","node","parent","getComponent","onDestroy","off","click_leave","userid","instance","userInfo","id","leaveId","sendQingli","active","removeAllChildren","children","forEach","length","unscheduleAllCallbacks","reset2","updateUserInfoWithUsers","users","user","find","e","bind","updateUserInfo","showQingli","creator","index","setqingli","updateAvatar","avatarUrl","updateUserId","updateNickname","nickname","setOfflineVisible","onlineStatus","cIndex","indexOf","isPlayedCards","playCard","cardInfo","setCompareData","updateBanker","userInfoComp","setIsBanker","isBanker","showFangZhuStatus","createId","setFangZhuNodeVisible","updateScore","score","totalScore","showReadyStatus","setReadyNodeVisible","showBeilv","bl","setBeilvLabel","updateDeskInfo","deskInfo","isCBegin","hideReadyStatus","playFaPaiAnimation","cardsBack","showPlayCardBacks","shouldShowFaPaiAnimation","setUserOnlineStatus","status","showChatText","message","chatMessage","setString","targetOff","slice","noe","cardSprite","path","_loadCardFrame","TOUCH_END","event","_clickFoldCardNode","cards","map","cardInfoItem","cardsFromArray","reduce","array","subCards","concat","nodes","sub","kqCard","Sprite","spriteFrame","nodds1","width","height","addComponent","sizeMode","cardName","maPai","nodds","loader","loadRes","SpriteFrame","err","error","btnSprite1","addChild","cards0","cards1","cards2","typeName0","cardsType","typeName1","typeName2","_setGuiCard","SpritesNode","w","h","getSpriteFrame","readyToCompareCards","_user","isContainExtra","playShootAnimation","toUserIndex","rotateBy","rotateTo","delay1","delayTime","rotateBy1","start_func1","callFunc","end_func1","action","repeat","sequence","fadeIn","scaleTo1","scaleTo","scaleTo2","fadeOutAndScaleTo","spawn","fadeOut","delay2","start_func2","end_func2","action1","runAction","playBulletHoleAnimation","instantiate","y","interval","initTime","scheduleOnce","playHumanZQiang","Math","round","random","floor","x","playHomeRunAimation","playSpeakAnimation","nextCompareScore","showNextCompareCards","showNextCards","showAllCompareCards","showAllCards","showNextCompareScore","showScoreResult"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Play","sourcesContent":["const Socket = require('socket');\nconst KQGlobalEvent = require('KQGlobalEvent');\nconst ArrayExtension = require('ArrayExtension');\nconst UserModelHelper = require('UserModelHelper');\nconst Playback = require('Playback');\nconst KQCardResHelper = require('KQCardResHelper');\nconst KQCard = require('KQCard');\nconst AudioManager = require('AudioManager');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        foldCardNode: cc.Node,      // 牌盖着时的样子\n        teShuPaiNode: cc.Node,      // 特殊牌盖着时的样子\n        cardsBackLayout: cc.Layout, // 13张牌背影，可用来展示发牌动画 含 cardsBack Component\n        compareCardsNode: cc.Node,  // compareCards   含 CompareCards Component\n        userInfoNode: cc.Node,          // 包含用户信息 含 userInfo Component\n        chatMessageNode: cc.Node,       // 聊天消息 包含 ChatMessage Component\n        userAvatarNode: cc.Node,\n        //userSampleInfoNode: cc.Node,\n        bulletHolePrefab: cc.Prefab,//中枪\n        bulletHoleNode: cc.Node,//中枪\n        shotNode: [cc.Node],//打枪\n        userId: 0,\n        cardTypePrefab: cc.Prefab,\n        // 用户信息\n        // 1、 如果 包含：cardInfo:[]，表明用户已经出牌\n        //\n        _userInfo: null,\n        _deskInfo: null,\n        /**/\n        playedCompareCardsIndexs: {\n            visible: false,\n            default: undefined,\n        }\n        /**/\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.userAvatarNode.on(cc.Node.EventType.TOUCH_START, this._showUserInfo, this);\n        this.reset();\n        this.foldCardNodeBack = false;//判断是否点击了拍的背影\n        this.cardSpriteAtlas = this.node.parent.getComponent('play').cardSpriteAtlas;\n    },\n\n    onDestroy: function () {\n        this.userAvatarNode.off(cc.Node.EventType.TOUCH_START, this._showUserInfo, this);\n    },\n\n    click_leave:function(){\n        var userid = Socket.instance.userInfo.id;\n        var leaveId = this._userInfo.id;\n        Socket.sendQingli(leaveId,userid);\n    },\n    \n    _showUserInfo: function () {\n        //this.userSampleInfoNode.getComponent('UserSampleInfo').updateWithUser(this._userInfo);\n    },\n\n    reset: function () {\n        this.foldCardNode.active = false;\n        this.cardsBackLayout.active = false;\n        this.compareCardsNode.active = false;\n        this.teShuPaiNode.active = false;\n        this.bulletHoleNode.active = false;\n        this.bulletHoleNode.removeAllChildren();\n        this.bulletHoleNode.children.forEach(function(node){node.active = false;});\n        if(this.shotNode.length > 0) this.shotNode.forEach(function(node){if(node) node.active = false;});\n        this.compareCardsNode.getComponent('CompareCards').reset();\n        this.compareCardsNode.getComponent('CompareCards').unscheduleAllCallbacks();\n    },\n\n    /*####*/\n    reset2: function () {\n        this.foldCardNode.active = false;\n        this.cardsBackLayout.active = false;\n        this.teShuPaiNode.active = false;\n        this.bulletHoleNode.active = false;\n        this.bulletHoleNode.removeAllChildren();\n        this.bulletHoleNode.children.forEach(function(node){node.active = false;});\n        if(this.shotNode.length > 0) this.shotNode.forEach(function(node){if(node) node.active = false;});\n        //this.compareCardsNode.active = false;\n        //this.compareCardsNode.getComponent('CompareCards').reset();\n    },\n    /*#####*/\n\n    updateUserInfoWithUsers: function (users) {\n        let user = users.find(function (e) {\n            return this.userId == e.id;\n        }.bind(this));\n\n        this.updateUserInfo(user);\n    },\n    showQingli:function(creator, index){\n        if(!this.node.active){\n            return;\n        }\n        if(index>0){\n            this.userInfoNode.getComponent('userInfo').setqingli(false);\n        }else{\n            if(creator){\n                this.userInfoNode.getComponent('userInfo').setqingli(false);\n            }else{\n                this.userInfoNode.getComponent('userInfo').setqingli(true);\n            }\n        }\n    },\n    updateUserInfo: function (user) {\n        this._userInfo = user;\n        this.node.active = (user != null);\n        this.userInfoNode.active = this.node.active;\n        if (!user) {\n            return;\n        }\n\n        let userInfo = this.userInfoNode.getComponent('userInfo');\n        userInfo.updateAvatar(user.avatarUrl);\n        userInfo.updateUserId(user.id);\n        userInfo.updateNickname(user.nickname);\n        userInfo.setOfflineVisible(!user.onlineStatus);\n\n        //if (this._deskInfo && this._deskInfo.cIndex > 0) {\n        //  if (UserModelHelper.isPlayedCards(user)) {\n        //    this.playCard(user.id);\n        //    this.compareCardsNode.getComponent('CompareCards').setCompareData(user);\n        //  }\n        //}\n        /**/\n        const cIndex = this._deskInfo.cIndex;\n        if (this._deskInfo && cIndex > 0 && (this.playedCompareCardsIndexs.indexOf(cIndex) == -1)) {\n            if (UserModelHelper.isPlayedCards(user)) {\n                this.playCard(user.id,user.cardInfo);\n                this.compareCardsNode.getComponent('CompareCards').setCompareData(user);\n            }\n        }\n        /**/\n    },\n\n    // 更新房主信息\n    updateBanker: function() {\n        let userInfoComp = this.userInfoNode.getComponent('userInfo');\n        if (!this._userInfo) {\n            userInfoComp.setIsBanker(false);\n            return;\n        }\n\n        let isBanker = this._userInfo ? this._userInfo.isBanker : false;\n        userInfoComp.setIsBanker(isBanker);\n    },\n\n    showFangZhuStatus: function (createId, visible = true) {\n        if (!this.node.active) {\n            return;\n        }\n        if (this._userInfo.id == createId) {\n            this.userInfoNode.getComponent('userInfo').setFangZhuNodeVisible(visible);\n        }\n    },\n\n    /**\n     * 更新分数\n     *\n     * @param {Number} score 用户分数、可选\n     */\n    updateScore: function(score) {\n        if (!score && this._userInfo) {\n            score = this._userInfo.totalScore;\n        }\n\n        let userInfo = this.userInfoNode.getComponent('userInfo');\n        userInfo.updateScore(score);\n    },\n\n    showReadyStatus: function (userId, visible = true) {\n        if (!this.node.active) {\n            return;\n        }\n\n        if (this._userInfo.id == userId) {\n            this.userInfoNode.getComponent('userInfo').setReadyNodeVisible(visible);\n        }\n    },\n    showBeilv:function(userId,bl){\n        if(!this.node.active){\n            return;\n        }\n        if( this._userInfo.id == userId ){\n             this.userInfoNode.getComponent('userInfo').setBeilvLabel(bl);\n        }\n    },\n    /*setDeskInfo: function (deskInfo) {\n     this._deskInfo = deskInfo;\n     },*/\n    updateDeskInfo: function (deskInfo) {\n        this._deskInfo = deskInfo;\n\n        if (deskInfo && !deskInfo.isCBegin) {\n            this.reset();\n        }\n    },\n    /**/\n\n    hideReadyStatus: function () {\n        this.userInfoNode.getComponent('userInfo').setReadyNodeVisible(false);\n    },\n\n    playFaPaiAnimation: function () {\n        if (!this.node.active) {\n            return;\n        }\n        if (UserModelHelper.isPlayedCards(this._userInfo)) {\n            return;\n        }\n        let cardsBack = this.cardsBackLayout.getComponent('cardsBack');\n        cardsBack.showPlayCardBacks();\n    },\n\n    shouldShowFaPaiAnimation: function () {\n        return UserModelHelper.isPlayedCards(this._userInfo);\n    },\n\n    setUserOnlineStatus: function (userId, status = 1) {\n        if (userId != this.userId) {\n            return;\n        }\n\n        let userInfo = this.userInfoNode.getComponent('userInfo');\n        userInfo.setOfflineVisible(status != 1);\n    },\n\n    showChatText: function (userId, message) {\n        if (userId != this.userId) {\n            return;\n        }\n\n        let chatMessage = this.chatMessageNode.getComponent('ChatMessage');\n        chatMessage.setString(message);\n    },\n\n    // 用户已经出牌，处于三堆盖着牌的状态\n    playCard: function (userId,cardInfo) {\n        if (this.userId != userId) {\n            return;\n        }\n\n        this.cardsBackLayout.node.active = false;\n        this.compareCardsNode.active = false;\n        this.foldCardNode.targetOff(this.foldCardNode);\n        this.foldCardNode.active = true;\n        this.foldCardNode.children.slice(0,3).forEach(function(node){\n            node.active = true;\n            node.children.forEach(function(noe){\n                noe.active = true;\n\n                var cardSprite = noe.getComponent('cc.Sprite');\n\n                var path = 'public-pic-card-poker-back';\n\n                this._loadCardFrame(this.cardSpriteAtlas, path ,cardSprite);\n\n            }.bind(this));\n        }.bind(this));\n        this.foldCardNode.on(cc.Node.EventType.TOUCH_END, function (event) {\n            this._clickFoldCardNode(event);\n        }.bind(this),this.foldCardNode);\n\n\n    },\n\n    _clickFoldCardNode: function (event) {\n\n        if (this.userId != Socket.instance.userInfo.id) return;\n\n        var cardInfo = this._userInfo.cardInfo.length == 1? this._userInfo.cardInfo[0].cards: this._userInfo.cardInfo;\n\n        var cards = cardInfo.map(function (cardInfoItem) {\n\n            if(this._userInfo.cardInfo.length == 1) return KQCard.cardsFromArray(cardInfoItem);\n\n            return KQCard.cardsFromArray(cardInfoItem.cards);\n\n        }.bind(this)).reduce(function (array, subCards) {return array.concat(subCards);}, []);\n\n        var foldCardNode = this.foldCardNode.children.slice(0,3);\n\n        var nodes = foldCardNode.map(function (node) {return node.children;}).reduce(function (array, sub) {return array.concat(sub);}, []);\n\n        cards.forEach(function (kqCard, index) {\n\n            if (index >= nodes.length) return;\n\n            nodes[index].removeAllChildren();\n\n            nodes[index].getComponent(cc.Sprite).spriteFrame = \"\";\n\n            var nodds1 = new cc.Node(); //创建一个节点对象\n\n            nodds1.width = nodes[0].width;\n\n            nodds1.height = nodes[0].height;\n\n            nodds1.addComponent(cc.Sprite); //添加精灵组件\n\n            var cardSprite = nodds1.getComponent('cc.Sprite');\n\n            cardSprite.sizeMode = 0;\n\n            var cardName = this.foldCardNodeBack == false? kqCard.cardName(): \"back\";\n\n            nodds1.cardName = cardName;\n\n            var path = 'public-pic-card-poker-'+ cardName;\n\n            this._loadCardFrame(this.cardSpriteAtlas, path ,cardSprite);\n\n            if(cc.maPai == cardName){\n\n                var nodds = new cc.Node(); //创建一个节点对象\n\n                nodds.addComponent(cc.Sprite); //添加精灵组件\n\n                cc.loader.loadRes('play/desk/img_red5_1', cc.SpriteFrame, function (err, spriteFrame) {\n\n                    if (err) {cc.error(err.message || err);return;}\n\n                    var btnSprite1 = nodds.getComponent(cc.Sprite);\n\n                    btnSprite1.spriteFrame = spriteFrame;\n\n                    btnSprite1.node.width = cardSprite.node.width + 10;\n\n                    btnSprite1.node.height = cardSprite.node.height + 10;\n\n                }.bind(this));\n\n                cardSprite.node.addChild(nodds);\n\n            }\n\n            nodes[index].addChild(nodds1);\n        }.bind(this));\n\n        var cards0 = cards.slice(0,3)\n        var cards1 = cards.slice(3,8)\n        var cards2 = cards.slice(8,13)\n\n        cards = [cards0, cards1, cards2]\n        //头道\n        let typeName0 = KQCard.cardsType(cards0)+1;\n        typeName0 = typeName0>=10 ? typeName0 :\"0\"+typeName0;\n        typeName0 = typeName0=='04' ? '11' :typeName0;\n\n        //中道\n        let typeName1 = KQCard.cardsType(cards1)+1;\n        typeName1 = typeName1>=10 ? typeName1 :\"0\"+typeName1;\n        typeName1 = typeName1=='07' ? '22' :typeName1;\n\n        //尾道\n        let typeName2 = KQCard.cardsType(cards2)+1;\n        typeName2 = typeName2>=10 ? typeName2 :\"0\"+typeName2;\n\n\n        if(typeName0) KQCard._setGuiCard(0, 0, 3, typeName0, cards, nodes, this.cardSpriteAtlas);\n        if(typeName1) KQCard._setGuiCard(1, 3, 8, typeName1, cards, nodes, this.cardSpriteAtlas);\n        if(typeName2) KQCard._setGuiCard(2, 8, 13, typeName2, cards, nodes, this.cardSpriteAtlas);\n        if(this.foldCardNodeBack == false){\n            this.foldCardNodeBack = true;\n        }\n        else if(this.foldCardNodeBack == true){\n            this.foldCardNodeBack = false;\n        }\n\n    },\n\n    _loadCardFrame: function(SpriteFrame, path, SpritesNode, w, h) {\n\n        var Sprite = SpriteFrame.getSpriteFrame( path );\n\n        SpritesNode.spriteFrame = Sprite;\n\n        if(w) SpritesNode.node.width = w;\n\n        if(h) SpritesNode.node.height = h;\n    },\n\n    // 准备好开始比牌\n    // readyToCompareCards: function () {\n    //     this.foldCardNode.targetOff(this.foldCardNode);\n    //     this.foldCardNodeBack = true;\n    //     this._clickFoldCardNode();\n    //     this.cardsBackLayout.node.active = false;\n    //     this.compareCardsNode.active = true;\n    //     //this.foldCardNode.active = false;\n    //     if(this.compareCardsNode.getComponent('CompareCards')._user){\n    //         if(this.compareCardsNode.getComponent('CompareCards')._user.isContainExtra){\n    //             this.teShuPaiNode.active = true;\n    //         }else{\n    //             this.teShuPaiNode.active = false;\n    //         }\n    //     }\n    // },\n    readyToCompareCards: function () {\n        this.foldCardNode.targetOff(this.foldCardNode);\n        this.foldCardNodeBack = true;\n        this._clickFoldCardNode();\n        this.cardsBackLayout.node.active = false;\n        this.compareCardsNode.active = true;\n        this.foldCardNode.active = true;\n        if(this.compareCardsNode.getComponent('CompareCards')._user){\n            if(this.compareCardsNode.getComponent('CompareCards')._user.isContainExtra){\n                this.teShuPaiNode.active = true;\n            }else{\n                this.teShuPaiNode.active = false;\n            }\n        }\n    },\n\n    // 播放打枪动画\n    // @param userId   要主动打枪的用户id\n    // @param toUserIndex  挨枪的用户的 index\n    playShootAnimation: function (userId, toUserIndex) {\n        if (userId != this.userId) {\n            return;\n        }\n        var shotNode = this.shotNode[toUserIndex];\n        shotNode.active = true;\n        shotNode.children[0].active = true;\n        shotNode.children[1].active = true;\n\n        //枪\n        var rotateBy = cc.rotateTo(0.1,-15);\n        var delay1 = cc.delayTime(0.1);\n        var rotateBy1 = cc.rotateTo(0.1,0);\n        var start_func1 = cc.callFunc(function(){shotNode.children[0].active = true;});\n        var end_func1 = cc.callFunc(function(){shotNode.children[0].active = false;});\n        var action = cc.repeat(cc.sequence(start_func1 ,rotateBy, delay1, rotateBy1, end_func1),3);\n\n        //烟\n        var fadeIn = cc.fadeIn (0);\n        var scaleTo1 = cc.scaleTo (0, 0.8);\n        var scaleTo2 = cc.scaleTo (0.08, 1);\n        var fadeOutAndScaleTo = cc.spawn(cc.fadeOut(0.02), cc.scaleTo(0.02, 0.5));\n        var delay2 = cc.delayTime(.2);\n        var start_func2 = cc.callFunc(function(){shotNode.children[1].active = true;});\n        var end_func2 = cc.callFunc(function(){shotNode.children[1].active = false;});\n        var action1 =  cc.repeat(cc.sequence(start_func2, fadeIn, scaleTo1, scaleTo2, fadeOutAndScaleTo, delay2, end_func2),3);\n\n        shotNode.children[0].runAction(action);\n        shotNode.children[1].runAction(action1);\n\n\n        //let userInfo = this.userInfoNode.getComponent('userInfo');\n        //userInfo.playShootAnimation(toUserIndex);\n    },\n\n    // 播放中枪动画\n    playBulletHoleAnimation: function (userId) {\n        if (userId != this.userId) {\n            return;\n        }\n\n        this.bulletHoleNode.active = true;\n\n        let bulletHoleNode = cc.instantiate(this.bulletHolePrefab);\n\n        bulletHoleNode.children.forEach(function(node){node.active = false;}.bind(this));\n\n        bulletHoleNode.children[0].y = 0;\n\n        this.bulletHoleNode.addChild(bulletHoleNode);\n\n        var interval = 0.3;\n\n        var initTime = 0;\n\n        bulletHoleNode.children.forEach(function(node){\n\n            this.scheduleOnce(function() {\n\n                AudioManager.instance.playHumanZQiang();\n\n                node.active = true;\n\n                var y = Math.round(Math.random()) == 0 ? -1 : 1;\n\n                y = Math.floor(Math.random()*38) * y;\n\n                var x = Math.round(Math.random()) == 0 ? -1 : 1;\n\n                x = Math.floor(Math.random()*38) * x;\n\n                node.x = x;\n\n                node.y = y;\n\n            }, initTime);\n\n            initTime = initTime + interval;\n\n        }.bind(this));\n\n    },\n\n    // 播放全垒打动画\n    playHomeRunAimation: function (userId) {\n        if (userId != this.userId) {\n            return;\n        }\n\n        let userInfo = this.userInfoNode.getComponent('userInfo');\n        userInfo.playHomeRunAimation();\n    },\n\n    playSpeakAnimation: function (userId) {\n        if (userId != this.userId) {\n            return;\n        }\n\n        let userInfo = this.userInfoNode.getComponent('userInfo');\n        userInfo.playSpeakAnimation();\n    },\n\n    nextCompareScore: function () {\n        if (!this.node.active) {\n            return 0;\n        }\n\n        let score = this.compareCardsNode.getComponent('CompareCards').nextCompareScore();\n        return score;\n    },\n\n    showNextCompareCards: function () {\n        if (this.nextCompareScore() <= 0) {\n            return;\n        }\n        this.teShuPaiNode.active = false;\n        this.compareCardsNode.getComponent('CompareCards').showNextCards();\n    },\n\n    showAllCompareCards: function (users) {\n        let user = users.find(function (e) {\n            return this.userId == e.id;\n        }.bind(this));\n        this.compareCardsNode.getComponent('CompareCards').setCompareData(user);\n        this.compareCardsNode.getComponent('CompareCards').showAllCards();\n\n        this.updateScore(this._userInfo.totalScore || 0);\n    },\n\n    showNextCompareScore: function (isContainExtra) {\n        this.compareCardsNode.getComponent('CompareCards').showNextCompareScore(isContainExtra);\n    },\n\n    showScoreResult: function () {\n        this.compareCardsNode.getComponent('CompareCards').showScoreResult();\n    },\n});\n"]}