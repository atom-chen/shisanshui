{"version":3,"sources":["recordInfo.js"],"names":["Socket","require","Playback","record","cc","Class","extends","Component","properties","timeLabel","Label","jushuLabel","createUser","Node","roomId","jifen","id","avatarNode","creatorImg","nicknameLabels","scoreLabels","_parentId","reordInfo","_recordItemInfo","totalGameResult","onLoad","find","setInfo","recordInfo","playersInfo","length","JSON","parse","scores","fen","userid","playersIndex","string","headUrl","players","creator","createUserId","avatarUrl","sprite","getComponent","Sprite","loader","load","url","type","err","tex","frame","SpriteFrame","spriteFrame","time","substr","js","setting1","setting2","jushu","i","clickAction","event","data","totalGameResultComp","setPlayerInfos","_clickBtn","alert","_startPlayback","playBackInfo","detailAction","recordItemInfo","index","records"],"mappings":"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","file":"recordInfo.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const Socket = require('socket');\nconst Playback = require('Playback');\nconst record = require('record');\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        timeLabel:cc.Label,   // 时间\n        jushuLabel:cc.Label,  // 局数\n        createUser:cc.Node,   // 房主\n        roomId:cc.Label,      // 房间号\n        jifen:cc.Label,       // 积分\n        id:cc.Label,\n        avatarNode:cc.Node,   // 头像\n        creatorImg:cc.Node,   // 创房头像\n        nicknameLabels:cc.Label,\n        scoreLabels:[cc.Label],\n        //numNode:cc.Label,\n        _parentId: null,\n        //playbackNode:cc.Node,//回放按钮\n        //watchNode:cc.Node,//查看按钮\n        reordInfo:cc.Node,\n        _recordItemInfo: null,\n        totalGameResult:cc.Node,\n\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        this.totalGameResult = cc.find(\"Canvas/recordInfo\");\n    },\n\n    setInfo: function (recordInfo) {\n        this._parentId = recordInfo.id;\n        //this.watchNode.active = true;\n        //this.playbackNode.active = false;\n        if (recordInfo.playersInfo.length == 0) {\n            return;\n        }\n\n        let playersInfo = JSON.parse(recordInfo.playersInfo);\n        recordInfo.scores = JSON.parse( recordInfo.scores );\n\n        var fen = recordInfo.scores[ this.fen(recordInfo.userid,playersInfo.playersIndex) ] ;\n        //cc.log(fen)\n        //cc.log(recordInfo.scores)\n        //cc.log(this.fen(recordInfo.userid,playersInfo.playersIndex))\n        //cc.log(recordInfo.userid)\n        //cc.log(playersInfo.playersIndex)\n        //cc.log(recordInfo)\n        //cc.log(playersInfo)\n        //cc.log('----47')\n        this.jifen.string = (fen >= 0?\"+\"+fen :fen);\n\n        var headUrl = playersInfo.players[ this.creator(recordInfo.createUserId,playersInfo.playersIndex) ].avatarUrl; // 头像URL\n        var sprite = this.avatarNode.getComponent(cc.Sprite);\n        cc.loader.load({url:headUrl,type:\"jpg\"}, function (err, tex) {\n            if (!err) {\n                var frame = new cc.SpriteFrame(tex);\n                sprite.spriteFrame=frame;\n            }\n        });\n\n        this.roomId.string = \"房号：\"+ playersInfo.roomId;\n        this.timeLabel.string = \"时间：\" + playersInfo.time.substr(5,11);\n        this.jushuLabel.string = \"局数：\"+ this.js(playersInfo.setting1-2);\n\n         //for (var i = 0;i < playersInfo.players.length;i++) {\n         //  this.nicknameLabels[i].string = playersInfo.players[i].nickname;\n         //  this.scoreLabels[i].string = playersInfo.players[i].totalScore;\n         //}\n    },\n    js: function(setting2){\n        var jushu = 5;\n        switch(setting2){\n            case 0: jushu = 5; break;\n            case 1: jushu = 10; break;\n            case 2: jushu = 20; break;\n            case 3: jushu = 30; break;\n        }\n        return jushu;\n    },\n\n    fen:function(userid,players){         // 找积分\n        for(var i =0; i<players.length;i++){\n            if(players[i] == userid){\n                return i;\n            }\n        }\n    },\n    creator :function(creator,players){    //创房者\n        for(var i =0; i<players.length;i++){\n            if(players[i] == creator){\n                return i;\n            }\n        }\n    },\n\n    clickAction: function( event, data ) {\n        let playersInfo = JSON.parse(data.playersInfo);\n        let totalGameResultComp = this.totalGameResult.getComponent('TotalGameResult');\n        totalGameResultComp.setPlayerInfos(playersInfo.players, data);\n        totalGameResultComp._clickBtn();\n        this.totalGameResult.getComponent('alert').alert();\n\n        //if (this._recordItemInfo) {\n        //  this._startPlayback(this._recordItemInfo._info8Array);\n        //  return;\n        //}\n        ////Socket.sendGetItemRecord(Socket.instance.userInfo.id,this._parentId);\n        //Socket.sendGetItemRecord(Socket.instance.userInfo.id,--index);\n    },\n\n    _startPlayback: function (playBackInfo) {\n        //Playback.instance.setPlaybackDatas(playBackInfo);\n        //cc.director.loadScene('play');\n    },\n\n    detailAction: function(recordItemInfo, index) {\n        //this._recordItemInfo = recordItemInfo;\n        ////this.playbackNode.active = true\n        ////console.log();\n        ////this.numNode.string = \"第\" + (index + 1) + \"局\";\n        //this.timeLabel.string = recordItemInfo.creatAt.substr(5,11);\n        //let objArray = JSON.parse(recordItemInfo.info8);\n        //this._recordItemInfo._info8Array = objArray;\n        //let playersArray = objArray.map(function(str){\n        //  return JSON.parse(str);\n        //});\n        //\n        //var players = playersArray[playersArray.length-1].data.players;\n        //for (var i = 0;i < players.length;i++) {\n        //    this.nicknameLabels[i].string = players[i].nickname;\n        //    this.scoreLabels[i].string = players[i].cScore;\n        //}\n    },\n    records:function(){\n\n    },\n\n\n});"]}