{"version":3,"sources":["KQNativeInvoke.js"],"names":["KQNativeInvoke","IOSClassName","ANDRIODClassName","isNativeIOS","platform","cc","sys","IPHONE","IPAD","isNativeAndroid","ANDROID","isNative","wxLogin","jsb","reflection","callStaticMethod","shareHallToWeChatFriend","shareHallToWeChatTimeline","forceExitApp","downloadNewVersion","iosUrl","androidUrl","shareRoomToWeChatFriend","roomId","description","id","title","shareRoomToWeChatTimeline","shareScreenToWeChatFriend","shareScreenToWeChatTimeline","startRecord","endRecord","screenshotShare","strings","_isCapturing","size","director","getWinSize","fileName","fullPath","fileUtils","getWritablePath","isFileExist","removeFile","texture","RenderTexture","Math","floor","width","height","IMAGE_FORMAT_PNG","gl","DEPTH24_STENCIL8_OES","setPosition","p","begin","getRunningScene","visit","end","saveToFile","self","tryTimes","fn","os","OS_ANDROID","console","log","setTimeout","playAudioWithUrl","audioUrl","module","exports"],"mappings":"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","file":"KQNativeInvoke.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\Utils","sourcesContent":["let KQNativeInvoke = {\n  IOSClassName: \"AppController\",\n  ANDRIODClassName: \"com/gongpa/ssz/AppActivity\",\n\n  isNativeIOS: function () {\n    let platform = cc.sys.platform;\n    if ((platform == cc.sys.IPHONE) || (platform == cc.sys.IPAD)) {\n      return true;\n    }\n    return false;\n  },\n\n  isNativeAndroid: function () {\n    let platform = cc.sys.platform;\n    if (platform == cc.sys.ANDROID) {\n      return true;\n    }\n    return false;\n  },\n\n  isNative: function () {\n    return cc.sys.isNative == true;\n  }\n};\n\n// MARK: 可调用的本地方法\n/**\n * 微信登录\n */\nKQNativeInvoke.wxLogin = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxLogin\"); //IOS\n  } else if (KQNativeInvoke.isNativeAndroid()) { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxLogin\", \"()V\");\n  }\n};\n\n\n/**\n * 分享大厅信息到微信好友\n * \n */\nKQNativeInvoke.shareHallToWeChatFriend = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxShareHallFriend\", );\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxShareHallFriend\", \"()V\");\n  }\n};\n\n\n/**\n * 分享大厅信息到朋友圈\n * \n */\nKQNativeInvoke.shareHallToWeChatTimeline = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxShareHallTimeline\", );\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxShareHallTimeline\", \"()V\");\n  }\n};\n\n/**\n * 强制退出 APP\n * \n */\nKQNativeInvoke.forceExitApp = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"exitApp\", );\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"exitApp\", \"()V\");\n  }\n};\n\n\n/**\n * 下载新版本\n * \n * @param {String} iosUrl      iOS 版本地址\n * @param {String} androidUrl  安卓版本地址\n */\nKQNativeInvoke.downloadNewVersion = function (iosUrl, androidUrl) {\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"downloadNewVersion:\", iosUrl);\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"downloadNewVersion\", \"(Ljava/lang/String;)V\", androidUrl);\n  }\n};\n\n\n/**\n * 分享房间给微信好友\n * \n * @param {String} roomId         房间 id 信息\n * @param {String} description    文本描述\n */\nKQNativeInvoke.shareRoomToWeChatFriend = function (roomId, description) {\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxShareFriend:description:\", id, description,title);\n  } else if (KQNativeInvoke.isNativeAndroid()) { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxShareFriend\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\", id, description,title);\n  }\n};\n\n/**\n * 分享房间到微信朋友圈\n * \n * @param {String} roomId         房间 id 信息\n * @param {String} description    文本描述\n */\nKQNativeInvoke.shareRoomToWeChatTimeline = function (roomId, description) {\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxShare:description:\", id, description,title);\n  } else if (KQNativeInvoke.isNativeAndroid()) { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxShare\", \"(Ljava/lang/String;Ljava/lang/String;Ljava/lang/String;)V\", id, description,title);\n  }\n};\n\n/**\n * 分享屏幕截图到微信好友\n */\nKQNativeInvoke.shareScreenToWeChatFriend = function () {\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxScreenShareFriend\", );\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxScreenShareFriend\", \"()V\");\n  }\n};\n\n/**\n * 分享屏幕截图到微信朋友圈\n */\nKQNativeInvoke.shareScreenToWeChatTimeline = function () {\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"wxScreenShare\", );\n  } else { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxScreenShare\", \"()V\");\n  }\n};\n\n/**\n * 开始录音\n */\nKQNativeInvoke.startRecord = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"record\");\n  } else if (KQNativeInvoke.isNativeAndroid()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"record\", \"()V\");\n  }\n};\n\n/**\n * 结束录音\n */\nKQNativeInvoke.endRecord = function () {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"endRecord\");\n  } else if (KQNativeInvoke.isNativeAndroid()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"endRecord\", \"()V\");\n  }\n};\n\nKQNativeInvoke.screenshotShare = function(strings = 'shareIMG') {\n        if(this._isCapturing){\n            return;\n        }\n        this._isCapturing = true;\n        var size = cc.director.getWinSize();\n        var fileName = \"result_share.jpg\";\n        var fullPath = jsb.fileUtils.getWritablePath() + fileName;\n        if(jsb.fileUtils.isFileExist(fullPath)){\n            jsb.fileUtils.removeFile(fullPath);\n        }\n        var texture = new cc.RenderTexture(Math.floor(size.width), Math.floor(size.height),cc.IMAGE_FORMAT_PNG,gl.DEPTH24_STENCIL8_OES);\n        texture.setPosition(cc.p(size.width/2, size.height/2));\n        texture.begin();\n        cc.director.getRunningScene().visit();\n        texture.end();\n        texture.saveToFile(fileName, cc.IMAGE_FORMAT_PNG);\n\n        var self = this;\n        var tryTimes = 0;\n        var fn = function(){\n            if(jsb.fileUtils.isFileExist(fullPath)){\n\n                if(cc.sys.os == cc.sys.OS_ANDROID){\n                    jsb.reflection.callStaticMethod(self.ANDRIODClassName, strings, \"(Ljava/lang/String;)V\",fullPath);\n                }\n                self._isCapturing = false;\n            }\n            else{\n                tryTimes++;\n                if(tryTimes > 10){\n                    console.log(\"time out...\");\n                    return;\n                }\n                setTimeout(fn,50);\n            }\n        }\n        setTimeout(fn,50);\n}\n\n\n/**\n * 播放网络语音\n * \n * @param {String} audioUrl 语音地址\n */\nKQNativeInvoke.playAudioWithUrl = function (audioUrl) {\n  if (!KQNativeInvoke.isNative()) {\n    return;\n  }\n\n  if (KQNativeInvoke.isNativeIOS()) {\n    jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName, \"playUrl:\", audioUrl);\n  } else if (KQNativeInvoke.isNativeAndroid()) { //Android\n    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"playUrl\", \"(Ljava/lang/String;)V\", audioUrl);\n  }\n};\n\n\n\nmodule.exports = KQNativeInvoke;"]}