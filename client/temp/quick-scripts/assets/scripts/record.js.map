{"version":3,"sources":["record.js"],"names":["KQGlobalEvent","require","Socket","cc","Class","extends","Component","properties","scrollView","Node","recordItem","Prefab","onLoad","scrollViewContent","getComponent","ScrollView","content","_registerSocketEvent","on","Event","GetRecord","_ReceiveRecordInfo","response","removeAllChildren","index","data","filter","record","playersInfo","length","forEach","recordInfo","item","instantiate","addChild","comp","setInfo","recordBtn","children","Button","clickEvents","customEventData","bind","closeAction","isSubPage","subScrollView","active","node","dismissAction"],"mappings":";;;;;;AAAA,IAAMA,gBAAgBC,QAAQ,eAAR,CAAtB;AACA,IAAMC,SAASD,QAAQ,QAAR,CAAf;AACAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,oBAAWL,GAAGM,IADN;AAERC,oBAAWP,GAAGQ;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAnBQ,KAHP;;AAyBL;AACAC,YAAQ,kBAAY;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAKC,iBAAL,GAAyB,KAAKL,UAAL,CAAgBM,YAAhB,CAA6BX,GAAGY,UAAhC,EAA4CC,OAArE;AACA,aAAKC,oBAAL;AACH,KApCI;;AAsCLA,0BAAsB,gCAAY;AAChCjB,sBAAckB,EAAd,CAAiBhB,OAAOiB,KAAP,CAAaC,SAA9B,EAAyC,KAAKC,kBAA9C,EAAkE,IAAlE;AACA;AACD,KAzCI;;AA2CLA,wBAAmB,4BAASC,QAAT,EAAmB;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,aAAKT,iBAAL,CAAuBU,iBAAvB;AACA,YAAIC,QAAQ,CAAZ;AACAF,iBAASG,IAAT,CAAcC,MAAd,CAAsB,UAAUC,MAAV,EAAkB;AAAC,mBAAOA,OAAOC,WAAP,CAAmBC,MAAnB,GAA4B,CAAnC;AAAsC,SAA/E,EAAiFC,OAAjF,CAAyF,UAAUC,UAAV,EAAsB;AAC3GP;AACA,gBAAIQ,OAAO7B,GAAG8B,WAAH,CAAe,KAAKvB,UAApB,CAAX;AACA,iBAAKG,iBAAL,CAAuBqB,QAAvB,CAAgCF,IAAhC;AACA,gBAAIG,OAAOH,KAAKlB,YAAL,CAAkB,YAAlB,CAAX;AACAqB,iBAAKC,OAAL,CAAaL,UAAb;AACA,gBAAIM,YAAYL,KAAKM,QAAL,CAAc,CAAd,EAAiBxB,YAAjB,CAA8BX,GAAGoC,MAAjC,CAAhB;AACAF,sBAAUG,WAAV,CAAsB,CAAtB,EAAyBC,eAAzB,GAA2CV,UAA3C;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SAdwF,CAcvFW,IAduF,CAclF,IAdkF,CAAzF;AAeH,KArEI;;AAuELC,iBAAY,uBAAW;AACnB,YAAI,KAAKC,SAAT,EAAoB;AAChB,iBAAKA,SAAL,GAAiB,KAAjB;AACA,iBAAKC,aAAL,CAAmBC,MAAnB,GAA4B,KAA5B;AACA,iBAAKtC,UAAL,CAAgBsC,MAAhB,GAAyB,IAAzB;AACH,SAJD,MAKK;AACD,iBAAKC,IAAL,CAAUjC,YAAV,CAAuB,OAAvB,EAAgCkC,aAAhC;AACH;AACJ;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAjFM,CAAT","file":"record.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["const KQGlobalEvent = require('KQGlobalEvent');\nconst Socket = require('socket');\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        scrollView:cc.Node,\n        recordItem:cc.Prefab,\n        //subScrollView:cc.Node,\n        //subRecordItem:cc.Node,\n        //splash:cc.Prefab,\n        //reordInfo:cc.Node,\n        //\n        //jifen:cc.Label,\n        //head:cc.Node,\n        //id:cc.Label,\n        //nickname:cc.Label,\n        //creat:cc.Label,        // 创房人\n        //createUser:cc.Node,     //  头像\n        //\n        //timeLabel:cc.Label,   // 时间\n        //jushuLabel:cc.Label,  // 局数\n        ////createUser:cc.Node,   // 房主\n        //roomId:cc.Label,      // 房间号\n        //_records:null,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n        //this.isSubPage = false;\n        //this.subScrollView.active = false;\n        //\n        //this.subScrollViewContent = this.subScrollView.getComponent(cc.ScrollView).content;\n        //console.log( this.subScrollViewContent );\n        //this.recordInfo = this.subScrollViewContent.children[0];\n        //this.reords = this.subScrollViewContent.children[0].children[3];\n        this.scrollViewContent = this.scrollView.getComponent(cc.ScrollView).content;\n        this._registerSocketEvent();\n    },\n\n    _registerSocketEvent: function () {\n      KQGlobalEvent.on(Socket.Event.GetRecord, this._ReceiveRecordInfo, this);\n      //KQGlobalEvent.on(Socket.Event.GetItemRecord, this._ReceiveRecordItem, this);\n    },\n\n    _ReceiveRecordInfo:function(response) {\n        //cc.log(response)\n        //cc.log('------78')\n        //console.log(response);\n        //this._records = response.data;\n        //this.isSubPage = false;\n        //this.subScrollView.active = false;\n        //this.scrollView.active = true;\n\n        this.scrollViewContent.removeAllChildren();\n        var index = 0;\n        response.data.filter( function (record) {return record.playersInfo.length > 0;}).forEach(function (recordInfo) {\n            index++;\n            var item = cc.instantiate(this.recordItem);\n            this.scrollViewContent.addChild(item);\n            var comp = item.getComponent('recordInfo');\n            comp.setInfo(recordInfo);\n            var recordBtn = item.children[7].getComponent(cc.Button);\n            recordBtn.clickEvents[0].customEventData = recordInfo;\n            // var eventHandler = new cc.Component.EventHandler();\n            // eventHandler.target = comp.node.children[7];\n            // eventHandler.component = \"btn\";\n            // eventHandler.handler = \"clickAction\";\n            //eventHandler.customEventData = \"my data\";\n            //console.log(comp.node.children[7]);\n        }.bind(this));\n    },\n\n    closeAction:function() {\n        if (this.isSubPage) {\n            this.isSubPage = false;\n            this.subScrollView.active = false;\n            this.scrollView.active = true;\n        }\n        else {\n            this.node.getComponent('alert').dismissAction();\n        }\n    },\n   /* clickAction:function( index ){\n        //_ReceiveRecordItem()\n    },\n    _ReceiveRecordItem:function(RecordItemInfo) {\n        cc.log(RecordItemInfo)\n        cc.log('------78')\n        //console.log(RecordItemInfo);return;\n        var index = RecordItemInfo.data\n        var playersInfo = JSON.parse(this._records[index].playersInfo);\n        \n        var players = playersInfo.players;                  // 玩家信息\n        var playersIndex = playersInfo.playersIndex;        // 玩家的位置\n        var createUserId = this._records[index].createUserId;   // 创房ID\n        var sendUserId = this._records[index].userid;           // 发送人ID\n\n        this.isSubPage = true;\n        this.subScrollView.active = true;\n        this.scrollView.active = false;\n\n        this.timeLabel.string = (this._records[index].createAt).substr(5,11);               // 时间\n        this.jushuLabel.string = this.js(JSON.parse(this._records[index].setting2));        // 局数\n        this.roomId.string = this._records[index].roomId;                                   // 房间号\n        this.creat.string = this.findCreator(this._records[index].createUserId,players);    // 房主\n\n        this.subScrollViewContent = this.subScrollView.getComponent(cc.ScrollView).content;\n        this.subScrollViewContent.removeAllChildren();\n\n        for(var i = 0; i < players.length; i++ ){\n            var item = cc.instantiate(this.splash);\n            this.subScrollViewContent.addChild(item);\n            var comp = item.getComponent('recordInfo');\n            var creator = 0;       \n            var self = 0;       // 表示自己，要对自己的比牌记录背景做处理\n            if(createUserId == players[i].id){\n                creator =1;\n            }\n            if( sendUserId == players[i].id){\n                self = 1;\n            }\n            this.records(comp,i,creator,self,index);\n        }\n\n    },\n    records:function(info,i,creator,self,index){\n        if(self){\n            info.node.color = new cc.Color(125, 126, 200);\n        }\n        cc.log(info)\n        cc.log('----119')\n        var players = JSON.parse(this._records[index].playersInfo).players;\n        var scores = this._records[index].scores ;\n        info.nicknameLabels.string = players[i].nickname;\n        info.id.string = players[i].id;\n        info.jifen.string = scores[i];\n\n        var headUrl = players[i].avatarUrl;   //头像连接\n        var sprite = info.avatarNode.getComponent(cc.Sprite);\n        cc.loader.load(headUrl+\".jpg\", function (err, tex) {\n          if (!err) {\n              var frame = new cc.SpriteFrame(tex);\n              sprite.spriteFrame=frame;\n          }\n        });\n        info.creatorImg.active = creator;\n    },\n    findCreator:function(createId,players){ //找房主\n        for(var i=0; i<players.length;i++){\n            if(createId == players[i].id){\n                return players[i].nickname;\n            }\n        }\n    },\n    js:function(num){\n        var J = 5;\n        switch(num){\n            case 0: J = 5;break;\n            case 1: J = 10;break;\n            case 2: J = 20;break;\n            case 3: J = 30;break;\n        }\n        return J;\n    },*/\n\n});\n"]}