{"version":3,"sources":["login.js"],"names":["manager","require","KQCard","Socket","KQCardFindTypeExtension","KQGlobalEvent","AudioManager","KQNativeInvoke","KQGlabolSocketEventHander","APPID","ROOMID","REDIRECT_URI","HREF","cc","Class","extends","Component","properties","alertPrefab","Prefab","canvasNode","Node","loadingNode","waitingPrefab","recordInfo","label","Label","goUpdateAction","isNativeIOS","jsb","reflection","callStaticMethod","iosUrl","androidUrl","checkVersion","vData","info1","version","versionEnable","self","info","getUserInfo","length","loginEnable","scheduleOnce","loginAction","isNativeAndroid","sys","isNative","recordId","getQueryString","sendGetRecrodFromId","roomId","data","JSON","parse","errcode","sendLoginRequest","setUserInfo","_get_HREF","e","code","obj","XMLHttpRequest","url","open","setRequestHeader","onreadystatechange","readyState","status","responseText","send","keyBackListen","_this","systemEvent","on","SystemEvent","EventType","KEY_DOWN","keyCode","KEY","back","ANDRIODClassName","onLoad","isMobile","canvas","find","cvs","getComponent","Canvas","start","socket","receviceMessage","response","action","result","userInfo","userId","id","exitInRoom","sendLoginJoin","_loadingLabel","director","loadScene","_registerSocketEvent","getWxInfo","Event","ReceiveLoginJoin","_LoginJoin","ReceiveRecordId","_ReceiveRecordId","ReceiveNoUionid","_ReceiveNoUionid","setTimeout","parent","active","stopAllActions","recordMsg","record","playersInfo","players","recordNode","instantiate","totalGameResult","sort","a","b","totalScore","setPlayerInfos","_clickBtn","alert","node","addChild","from","ma","maPai","joinDesk","reasonInfo","_joinReasonMap","reason","notExist","cardNumber","name","reg","RegExp","r","window","location","search","substr","match","unescape","agreements","agreementNode","agreementLabel","y","onDestroy","string","runAction","repeatForever","rotateBy","sendMessage","href","IOSClassName","loginYkAction","testDate","Date","time","toLocaleString","openid","Buffer","toString","testData","showWaitingMessage","msg","waitingNode","isValid","getMessage","removeFromParent","comp","setMessage","hiddenWaitingMessage","dismissAction","protocolAction","log"],"mappings":"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","file":"login.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["var manager = require('manager');\nconst KQCard = require('KQCard');\nconst Socket = require('socket');\nconst KQCardFindTypeExtension = require('KQCardFindTypeExtension');\nconst KQGlobalEvent = require('KQGlobalEvent');\nconst AudioManager = require('AudioManager');\nconst KQNativeInvoke = require('KQNativeInvoke');\nconst KQGlabolSocketEventHander = require('KQGlabolSocketEventHander');\n\nvar APPID = 'wxe8993f468b16fa5d';\nvar ROOMID = '';\n//授权地址\n//正式地址\n// var REDIRECT_URI = \"http%3A%2F%2Fwww.honggefeng.cn%2FsszWeb%2Findex.php\";\n// 测试地址\nvar REDIRECT_URI = \"http%3a%2f%2fo1o2.cn\";\n\nlet HREF = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+APPID+\"&redirect_uri=\"+REDIRECT_URI+\"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect\";\n\ncc.Class({\n\n    extends: cc.Component,\n    properties: {\n        //selectNode:cc.Node,\n        alertPrefab:cc.Prefab,\n        canvasNode:cc.Node,\n        loadingNode:cc.Node,\n        //err:cc.Node,\n        waitingPrefab:cc.Prefab,\n        recordInfo:cc.Prefab,\n        label:cc.Label,\n    },\n\n    goUpdateAction:function() {\n        if (KQNativeInvoke.isNativeIOS()) {\n            jsb.reflection.callStaticMethod(\"AppController\",\"downloadNewVersion:\",this.iosUrl);\n        }\n        else {//Android\n            jsb.reflection.callStaticMethod(\"com/gongpa/ssz/AppActivity\", \"downloadNewVersion\", \"(Ljava/lang/String;)V\", this.androidUrl);\n        }\n    },\n\n    checkVersion:function(vData) {\n        //var version = vData.version;\n        cc.info1 = vData.version;\n        this.iosUrl = vData.iosUrl;\n        this.androidUrl = vData.androidUrl;\n        //if (manager.version != version) {//更新版本\n        //    this.versionEnable = false;\n        //    this.goUpdateAction();\n        //    //this.versionLabel.string = '请到服务器更新到最新版本';\n        //}\n        //else {\n            //this.versionLabel.string = '当前版本 ' + manager.version;\n            if(KQNativeInvoke.isNativeIOS()) {\n                // if(iosVersion != manager.version) {\n                //     this.versionEnable = false;\n                //     var updateAlert = cc.find(\"Canvas/update\").getComponent(\"alert\");\n                //     updateAlert.alert();\n                // }\n                // else {\n                    this.versionEnable = true;\n                    var self = this;\n                    var info = manager.getUserInfo();\n                    if (info.length == 0) {\n                        this.loginEnable = true;\n                    }\n                    this.scheduleOnce(function(){\n                        if (info.length > 0) {\n                            this.loginEnable = true;\n                            self.loginAction();\n                        }\n                    },0.5);\n                //}\n            }\n            else if(KQNativeInvoke.isNativeAndroid()) {\n                // if(androidVersion != manager.version) {\n                //     this.versionEnable = false;\n                //     var updateAlert = cc.find(\"Canvas/update\").getComponent(\"alert\");\n                //     updateAlert.alert();\n                // }\n                // else {\n                    this.versionEnable = true;\n                    var self = this;\n                    var info = manager.getUserInfo();\n                    if (info.length == 0) {\n                        this.loginEnable = true;\n                    }\n                    this.scheduleOnce(function(){\n                        if (info.length > 0) {\n                            this.loginEnable = true;\n                            self.loginAction();\n                        }\n                    },0.5);\n                //}\n            }\n            else{\n              this.versionEnable = true;\n              var self = this;\n              // var info = manager.getUserInfo();\n              // if (info.length == 0) {\n              //     this.loginEnable = true;\n              // }\n              this.scheduleOnce(function(){\n                  if(!cc.sys.isNative){\n                      var recordId = self.getQueryString('recordId');\n                      if(recordId){\n                        Socket.sendGetRecrodFromId(recordId);\n                        return;\n                      }\n                      var roomId = self.getQueryString(\"roomId\");\n                      if(roomId){\n                          var info = manager.getUserInfo();\n                          if (info.length > 0) {\n                            var data = JSON.parse(info);\n                            if(!data.errcode){\n                              self.sendLoginRequest(data);\n                            }else{\n                              manager.setUserInfo(\"\");\n                            }\n                            return;\n                          }else{\n                            self._get_HREF(roomId);\n                          }\n                      }\n                  }\n                  var info = manager.getUserInfo();\n                  if (info.length > 0) {\n                    var data = null;\n                    try {\n                      data = JSON.parse(info);\n                    }\n                    catch (e){\n                      manager.setUserInfo(\"\");\n                      data = null;\n                    }\n                    if(!data || data.errcode){\n                      manager.setUserInfo(\"\");\n                    }else{\n                      this.loginEnable = true;\n                      self.loginAction();\n                    }\n                  }\n                  else{\n                    if(!cc.sys.isNative){\n                        var code = self.getQueryString(\"code\");\n                        var roomId = self.getQueryString(\"roomId\");\n                        if( roomId ){\n                            var info = manager.getUserInfo();\n                            if (info.length > 0) {\n                              var data = JSON.parse(info);\n                              if(!data.errcode){\n                                self.sendLoginRequest(data);\n                              }else{\n                                manager.setUserInfo(\"\");\n                              }\n                              return;\n                            }else{\n                              self._get_HREF(roomId);\n                            }\n                        }\n                        if( code ){\n                            try{\n                                var obj = new XMLHttpRequest();  // XMLHttpRequest对象用于在后台与服务器交换数据\n                                var url = \"./get_token.php\";       \n                                obj.open(\"POST\", url, true);\n                                obj.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");  // 添加http头，发送信息至服务器时内容编码类型\n                                obj.onreadystatechange = function() {\n                                  if (obj.readyState == 4 && (obj.status == 200 || obj.status == 304)) {  // 304未修改\n                                      //alert(obj.responseText);\n                                      var data = JSON.parse( obj.responseText );\n                                      if(!data.errcode){\n                                          manager.setUserInfo( obj.responseText );\n                                          self.sendLoginRequest( data );\n                                      }\n                                  }\n                                };\n                                obj.send(\"code=\"+code);\n                            }catch(e){\n                                //alert(e);\n                            }\n                        }\n                    }\n                  }\n              },0.5);\n            }\n        //}\n    },\n    keyBackListen:function () {\n        var _this = this;\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,function(e) {\n            if(e.keyCode == cc.KEY.back) {\n                if(!KQNativeInvoke.isNativeIOS()){\n                    jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"backToDesk\", \"()V\");\n                }\n            }\n        },this);\n    },\n    onLoad: function () {\n        this.keyBackListen();\n        if(!cc.sys.isNative && cc.sys.isMobile){\n            var canvas = cc.find(\"Canvas\");\n            var cvs = canvas.getComponent(cc.Canvas);\n        }\n        KQGlabolSocketEventHander.start();\n        this.socket = cc.find('GameSocket').getComponent('socket');\n        var self = this;\n        this.loginEnable = false;\n        this.socket.receviceMessage = function(response) {\n            var data = JSON.parse(response);\n            //console.log(data)\n            if (data.action == 'checkVersion') {\n              try{\n                self.checkVersion(data.data);\n              }catch(e){\n                //this.err.string = e;\n              }\n            }\n            else if (data.action == 'login') {\n               if (data.result) {//成功\n                   self.socket.userInfo = data.data;//运行时态信息\n                   if(!cc.sys.isNative){\n                      var roomId = self.getQueryString(\"roomId\");\n                      //console.log(roomId);\n                      if(roomId){\n                        var userId = data.data.id;\n                        var exitInRoom = data.data.roomId;\n                        if(exitInRoom != \"\"){\n                          roomId = exitInRoom;\n                        }\n                        Socket.sendLoginJoin(roomId, userId);\n                        return;\n                      }\n                    }\n                    self._loadingLabel(\"登录中\");\n                   if (data.data.roomId.length > 0) {\n                        cc.director.loadScene('play');\n                   }\n                   else {\n                        cc.director.loadScene('hall');\n                   }\n               }\n               else {\n                  // self.alertMessage('登录失败!');\n               }\n           }\n        };\n        this._registerSocketEvent();\n\n        this.socket.getWxInfo = function(info) {\n           manager.setUserInfo(info);//保存本地\n           var data = JSON.parse(info);//str -> json(obj)\n           self.scheduleOnce(function(){//延迟执行 1s\n               self.sendLoginRequest(data);//登录请求\n           },1);\n        };\n    \n        // let search = window.location.search;\n        // var openid = \"JzIwMTcvNi8xNiDkuIrljYgxMMzowOCc=\";\n        // var unionid = '8dOtAcDic5Sichv3lxtMXYJgmunTLOLv';\n        // var nickname = \"哇哈哈\";\n        // if (search) {\n        //     var url = window.location.search;\n        //     var loc = url.substring(url.lastIndexOf('=') + 1, url.length);\n        //     if (loc == 1) {\n        //         openid = 'JzIwMTctNi0xNiAwOTo0NTo1OSc=';\n        //         unionid = 'JzIwMTctNi0xNiAwOTo0NTo1OSc';\n        //         nickname = loc;\n        //     }\n        //     else if (loc == 2) {\n        //         openid = 'JzIwMTcvNi8xNiDkuIrljYg5OjM4OjMzJw==';\n        //         unionid = 'JzIwMTcvNi8xNiDkuIrljYg5OjM4OjMzJw';\n        //         nickname = loc;\n        //     }\n        //     else if (loc == 3) {\n        //         openid = 'JzIwMTctNi0xNiAwOTo0NToc=';\n        //         unionid = '8dOtAcDic5Sichv3lxtMXYmunTLOLv';\n        //         nickname = loc;\n        //     }\n        //     else if (loc == 4) {\n        //         openid = 'ozlXIwgv_QJT0ykdUihaABmsWp2A';\n        //         unionid = 'o-3911qWsQsW3wUodqFfUtbsAeNk';\n        //         nickname = loc;\n        //     }\n        //     else if (loc == 5) {\n        //         openid = 'JzIwMTcvNi8xNiDkuIrljYgxMDowMzowOCc=';\n        //          unionid = 'o-JzIwMTcvNi8xNiDkuIrljYgxMDowM';\n        //         nickname = loc;\n        //     }else if(loc == 6){\n        //         openid = 'JzIwMTcvNi8xNiDkuIrljYgxMMzoc=';\n        //          unionid = 'o-zIwMTcvNi8xNiDkuIrl';\n        //         nickname = loc;\n        //     }\n           \n        // }\n        // var testData = '{\"openid\":\"'+openid+'\",\"nickname\":\"'+nickname+'\",\"unionid\":\"'+unionid+'\",\"sex\":1,\"language\":\"zh_CN\",\"city\":\"Changsha\",\"province\":\"Hunan\",\"country\":\"CN\",\"headimgurl\":\"http:\\/\\/wx.qlogo.cn\\/mmopen\\/8D8dOtAcDic5Sichv3lxtMXYJgmunTLOLvTT5AFM4zaqKEthZibv8xdWkgjN9Yb4AQnwvSurz27UB29xx81XORwx55XanxqctdD\\/0\",\"privilege\":[]}';\n\n        // if (!cc.sys.isNative){\n        //     manager.setUserInfo(testData);\n        // }\n    },\n\n     _registerSocketEvent:function(){\n        KQGlobalEvent.on(Socket.Event.ReceiveLoginJoin, this._LoginJoin, this);\n        KQGlobalEvent.on(Socket.Event.ReceiveRecordId, this._ReceiveRecordId, this);\n        KQGlobalEvent.on(Socket.Event.ReceiveNoUionid, this._ReceiveNoUionid, this);\n    }, \n    _get_HREF:function(roomId){\n      if(roomId != ROOMID){\n        ROOMID = roomId;\n        roomId = \"%3froomId%3d\"+roomId ;\n        REDIRECT_URI = REDIRECT_URI+roomId;\n        HREF = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=\"+APPID+\"&redirect_uri=\"+REDIRECT_URI+\"&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect\";\n      }\n    },\n    _ReceiveNoUionid:function(response){\n      manager.setUserInfo(\"\");\n      var self = this;\n      var roomId = this.getQueryString(\"roomId\");\n      if(roomId){\n        //roomId = \"%3froomId%3d\"+roomId ;\n        //REDIRECT_URI = REDIRECT_URI+roomId;\n        this._get_HREF(roomId);\n      }\n      setTimeout(function(){\n        self.loadingNode.parent.active = false;\n        self.loadingNode.stopAllActions();\n      },2000)\n      this._loadingLabel(\"登录失败，请重新登录\");\n    },\n    _ReceiveRecordId:function(response){\n        var data = response.data;\n        if(data.recordMsg.length>0){\n          var record = data.recordMsg[0];\n          var playersInfo = JSON.parse(record.playersInfo).players;\n          var recordNode = cc.instantiate(this.recordInfo);\n          let totalGameResult = recordNode.getComponent(\"TotalGameResult\");\n          playersInfo.sort(function(a,b){return b.totalScore-a.totalScore});  // 排序\n          totalGameResult.setPlayerInfos(playersInfo,record);\n          totalGameResult._clickBtn();\n          recordNode.getComponent('alert').alert();\n          this.node.addChild(recordNode);\n        }\n    },\n    _LoginJoin: function(response){\n        this._loadingLabel(\"进入房间，正在为您请求数据\");\n        if (response.result){\n            if(cc.from == null) {\n                cc.from = {};\n            }\n            cc.from.ma = response.data.maPai;\n            cc.director.loadScene('play');\n        } else {\n            cc.joinDesk = {};\n            cc.director.loadScene('hall');\n            let reasonInfo = this._joinReasonMap(response.data.reason);\n            cc.joinDesk.result = response.result;\n            cc.joinDesk.reason = reasonInfo;\n        }\n    },\n    _joinReasonMap: function (reason) {\n      let reasonInfo = {\n        notExist: \"房间不存在!\",\n        cardNumber: \"您房卡不足!\",\n      };\n      let info = reasonInfo[reason] || \"房间已满!\";\n      return info;\n    },\n\n    getQueryString: function(name){\n        var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\", \"i\"); \n        var r = window.location.search.substr(1).match(reg); \n        if (r != null) return unescape(r[2]); return null; \n    },\n\n    agreements: function () {\n        this.agreementNode.active = true;\n        //this.agreementLabel.string = cc.info1;\n        this.agreementLabel.node.y = 0;\n    },\n\n    onDestroy: function () {\n      this.socket.receviceMessage = function () {};\n    },\n\n    _loadingLabel:function(label){\n        this.label.string = label;\n    },\n\n    sendLoginRequest:function(data) {\n        //this.showWaitingMessage('登录中...');\n        this.loadingNode.parent.active = true;\n        this.loadingNode.runAction(cc.repeatForever(cc.rotateBy(2, 360)));\n        //return;\n        this.socket.sendMessage('login',data);\n    },\n\n    loginAction:function() {\n        var info = manager.getUserInfo();\n        if (info.length > 0) {\n          var data = JSON.parse(info);\n          this.sendLoginRequest(data);\n          return;\n        }\n        if (!cc.sys.isNative){\n            // cc.sys.openURL(HREF);\n            window.location.href = HREF;\n        }else{\n          if (KQNativeInvoke.isNativeIOS()) {\n            jsb.reflection.callStaticMethod(KQNativeInvoke.IOSClassName,\"wxLogin\");//IOS\n          } else if (KQNativeInvoke.isNativeAndroid()) {//Android\n            jsb.reflection.callStaticMethod(KQNativeInvoke.ANDRIODClassName, \"wxLogin\", \"()V\");\n          }\n        }\n        \n    },\n\n    loginYkAction:function() {\n        //var comp = this.selectNode.getComponent('select');\n        //if (!comp.selected) {\n        //    this.showMsg = cc.instantiate(this.alertPrefab);\n        //    this.canvasNode.addChild(this.showMsg);\n        //    let comp = this.showMsg.getComponent('alert');\n        //    comp.setMessage('请同意用户协议');\n        //    return;\n        //}\n        var testDate = new Date();\n        var time = \"'\"+testDate.toLocaleString()+\"'\";\n        var openid = new Buffer(time).toString('base64');\n        var testData = '{\"openid\":\"'+openid+'\",\"nickname\":\"游客\",\"sex\":1,\"language\":\"zh_CN\",\"city\":\"Changsha\",\"province\":\"Hunan\",\"country\":\"CN\",\"headimgurl\":\"http:\\/\\/wx.qlogo.cn\\/mmopen\\/BVyz4R8q6puJibEv1hrsaTmIKQhkaTS9FyvcevvC5hlxFnfOuspDjicG0GtzyJXOhNT7g1WZDeCDQhnRdEOgz3QMnP0F9iboQGy\\/0\",\"privilege\":[]}';\n        var data = JSON.parse(testData);\n        this.sendLoginRequest(data);\n\n    },\n\n    showWaitingMessage:function(msg) {\n        if (this.waitingNode != null && cc.sys.isNative && cc.isValid(this.waitingNode)) {\n          if (msg == this.waitingNode.getComponent('alert').getMessage()) {\n            return;\n          }\n            this.waitingNode.removeFromParent();\n            this.waitingNode = null;\n        }\n        this.waitingNode = cc.instantiate(this.waitingPrefab);\n        this.canvasNode.addChild(this.waitingNode);\n        var comp = this.waitingNode.getComponent('alert');\n        //console.log(comp);\n\n        comp.setMessage(msg);\n        comp.alert();\n    },\n\n    hiddenWaitingMessage:function() {\n        if (this.waitingNode != null) {\n            this.waitingNode.getComponent('alert').dismissAction();\n        }\n    },\n\n    protocolAction:function() {\n        cc.log('protocol action');\n    },\n});\n"]}